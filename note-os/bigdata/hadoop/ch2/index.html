<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Zhenhua Wang">
        <link rel="canonical" href="http://larryim.cc/note-os/bigdata/hadoop/ch2/">
        <link rel="shortcut icon" href="../../../img/favicon.ico">
        <title>Chapter 2: MapReduce - Zhenhua's Notes</title>
        <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/docco.min.css">
        <link href="../../../extra_css/custom.css" rel="stylesheet">
        <link href="../../../extra_css/custom.js" rel="stylesheet">
        <link href="../../../extra_css/friendly.css" rel="stylesheet">
        <link href="../../../extra_css/theme.css" rel="stylesheet">
        <link href="../../../extra_css/mkdocs/js/lunr-0.5.7.min.js" rel="stylesheet">
        <link href="../../../extra_css/mkdocs/js/mustache.min.js" rel="stylesheet">
        <link href="../../../extra_css/mkdocs/js/require.js" rel="stylesheet">
        <link href="../../../extra_css/mkdocs/js/search.js" rel="stylesheet">
        <link href="../../../extra_css/mkdocs/js/text.js" rel="stylesheet">
        <link href="../../../extra_css/code-tab.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../../..">Zhenhua's Notes</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="../../..">Home</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Algorithm <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../algorithm/">Contents</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">AlgorithmPrinceton</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/">Contents</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/unionfind/">Topic 1: UnionFind</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/stackqueue/">Topic 2: StackQueue</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/sort/">Topic 3: Sort</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/priorityqueue/">Topic 4: PriorityQueues</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/symboltable/">Topic 5: Symbol Tables</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/bst/">Topic 6: Balanced Search Trees</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/hashtable/">Topic 7: Hash Table</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/graph/">Topic 8: Graph</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/mst_shortestpath/">Topic 9: Minimum Spanning Tree and Shortest Path</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/stringsort/">Topic 11: String Sort</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/tries/">Topic 12: Tries</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">AlgorithmStanford</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../algorithm/algorithmStanford/">Contents</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmStanford/dynamicprogramming/">Topic: Dynammic Programming</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmStanford/heap/">Topic: Heap</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmStanford/graph/">Topic: Graph</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmStanford/greedy/">Topic: Greedy Algorithm</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmStanford/hashtable/">Topic: Hash Table</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">CS61B</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../algorithm/cs61b/">Contents</a>
</li>
            
<li >
    <a href="../../../algorithm/cs61b/Lab1/">Lab1: javac, java, git</a>
</li>
            
<li >
    <a href="../../../algorithm/cs61b/Lab2/">Lab2: Unit Testing with JUnit and IntLists</a>
</li>
            
<li >
    <a href="../../../algorithm/cs61b/Lab3/">Lab3: Unit Testing with JUnit, Debugging</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Sword</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../algorithm/sword/">Contents</a>
</li>
            
<li >
    <a href="../../../algorithm/sword/ch2/">⾯试需要的基础知识</a>
</li>
            
<li >
    <a href="../../../algorithm/sword/ch3/">高质量的代码</a>
</li>
            
<li >
    <a href="../../../algorithm/sword/ch4/">二叉树的镜像</a>
</li>
            
<li >
    <a href="../../../algorithm/sword/ch5/">二叉树的镜像</a>
</li>
            
<li >
    <a href="../../../algorithm/sword/ch6/">二叉树的镜像</a>
</li>
            
<li >
    <a href="../../../algorithm/sword/ch7/">二叉树的镜像</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">OS <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../os/">Contents</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">OSC</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../os/osc/">Contents</a>
</li>
            
<li >
    <a href="../../../os/osc/ch1/">Chapter 1: Introduction </a>
</li>
            
<li >
    <a href="../../../os/osc/ch2/">Chapter 2: Operating System structures</a>
</li>
            
<li >
    <a href="../../../os/osc/ch3/">Chapter 3: Processes</a>
</li>
            
<li >
    <a href="../../../os/osc/ch4/">Chapter 4: Threads and Concurrency</a>
</li>
            
<li >
    <a href="../../../os/osc/ch5/">Chapter 5: CPU Scheduling</a>
</li>
            
<li >
    <a href="../../../os/osc/ch6/">Chapter 6: Synchronization Tools</a>
</li>
            
<li >
    <a href="../../../os/osc/ch7/">Chapter 7: Synchronization Examples</a>
</li>
            
<li >
    <a href="../../../os/osc/ch8/">Chapter 8: Deadlocks</a>
</li>
            
<li >
    <a href="../../../os/osc/ch9/">Chapter 9: Main Memory</a>
</li>
            
<li >
    <a href="../../../os/osc/ch10/">Chapter 10: Virtual Memory</a>
</li>
            
<li >
    <a href="../../../os/osc/ch11/">Chapter 11: Mass-Storage Structure</a>
</li>
            
<li >
    <a href="../../../os/osc/ch13/">Chapter 13: File-System Interfaces</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">CSAPP</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../os/csapp/">Contents</a>
</li>
            
<li >
    <a href="../../../os/csapp/ch1/">Chapter 1: 计算机系统漫游</a>
</li>
            
<li >
    <a href="../../../os/csapp/ch2/">Chapter 2: 信息的表示和处理</a>
</li>
            
<li >
    <a href="../../../os/csapp/ch3/">Chapter 3: 程序的机器级表示</a>
</li>
            
<li >
    <a href="../../../os/csapp/ch4/">Chapter 4: 处理器体系结构</a>
</li>
            
<li >
    <a href="../../../os/csapp/ch5/">Chapter 5: 优化程序性能</a>
</li>
            
<li >
    <a href="../../../os/csapp/ch6/">Chapter 6: 存储器层次结构</a>
</li>
            
<li >
    <a href="../../../os/csapp/ch7/">Chapter 7: 链接</a>
</li>
            
<li >
    <a href="../../../os/csapp/ch8/">Chapter 8: 异常控制流</a>
</li>
            
<li >
    <a href="../../../os/csapp/ch9/">Chapter 9: 虚拟内存</a>
</li>
            
<li >
    <a href="../../../os/csapp/ch10/">Chapter 10: 系统级I/O</a>
</li>
            
<li >
    <a href="../../../os/csapp/ch11/">Chapter 11: 网络编程</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">DataBase <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../database/">Contents</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">MySql</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../database/mysql/">Contents</a>
</li>
            
<li >
    <a href="../../../database/mysql/LearningMySQLandMariaDB/">Chapter Learning MySQL and MariaDB</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Java <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../java/">Contents</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">HFJ</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../java/hfj/">Contents</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch1/">Chapter 1: Dive in A Quick Dip</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch2/">Chapter 2: Classes and Objects</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch3/">Chapter 3: Primitives and References</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch4/">Chapter 4: Methods use Instance Variables</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch5/">Chapter 5: Writing a Program</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch6/">Chapter 6: Get to Know the Java API</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch7/">Chapter 7: Inheritance and Polymorphism</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch8/">Chapter 8: Interfaces and Abstract Classes</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch9/">Chapter 9: Constructors and Garbage Collection</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch10/">Chapter 10: Numbers and Statics</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch11/">Chapter 11: Exception Handling</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch12/">Chapter 12: Getting GUI</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch13/">Chapter 13: Using Swing</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch14/">Chapter 14: Serialization and File I/O</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch15/">Chapter 15: Networking and Threads</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch16/">Chapter 16: Collections and Generics</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch17/">Chapter 17: Packages, Jars and Deployment</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch18/">Chapter 18: Remote deploy with RMI</a>
</li>
            
<li >
    <a href="../../../java/hfj/Appendix/">Appendix: The Top Ten Topics</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">HFDP</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../java/hfdp/">Contents</a>
</li>
            
<li >
    <a href="../../../java/hfdp/ch1/">Chapter 1: Strategy Pattern </a>
</li>
            
<li >
    <a href="../../../java/hfdp/ch2/">Chapter 2: Observer Pattern</a>
</li>
            
<li >
    <a href="../../../java/hfdp/ch3/">Chapter 3: Decorator Pattern </a>
</li>
            
<li >
    <a href="../../../java/hfdp/ch4/">Chapter 4: Factory Pattern</a>
</li>
            
<li >
    <a href="../../../java/hfdp/ch5/">Chapter 5: Singleton Pattern</a>
</li>
            
<li >
    <a href="../../../java/hfdp/ch6/">Chapter 6: Command Pattern</a>
</li>
            
<li >
    <a href="../../../java/hfdp/ch7/">Chapter 7: Adapter and Facade Patterns</a>
</li>
            
<li >
    <a href="../../../java/hfdp/ch8/">Chapter 8: Template Method Pattern</a>
</li>
            
<li >
    <a href="../../../java/hfdp/ch9/">Chapter 9: Iterator and Composite Patterns</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">MultiThreading</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../java/multithreading/">Contents</a>
</li>
            
<li >
    <a href="../../../java/multithreading/pre1/">序章1 Java线程</a>
</li>
            
<li >
    <a href="../../../java/multithreading/pre2/">序章2 多线程程序的评价标准</a>
</li>
            
<li >
    <a href="../../../java/multithreading/ch1/">第1章 Single Threaded Execution模式</a>
</li>
            
<li >
    <a href="../../../java/multithreading/ch1/">第2章 Immutable模式</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">TIJ</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../java/tij/">Contents</a>
</li>
            
<li >
    <a href="../../../java/tij/ch1/">Chapter 1: Introduction</a>
</li>
            
<li >
    <a href="../../../java/tij/ch2/">Chapter 2: Introduction to Objects</a>
</li>
            
<li >
    <a href="../../../java/tij/ch3/">Chapter 3: Everything is an Object</a>
</li>
            
<li >
    <a href="../../../java/tij/ch4/">Chapter 4: Opertors</a>
</li>
            
<li >
    <a href="../../../java/tij/ch5/">Chapter 5: Controlling Execution</a>
</li>
            
<li >
    <a href="../../../java/tij/ch6/">Chapter 6: Initialization & Cleanup</a>
</li>
            
<li >
    <a href="../../../java/tij/ch7/">Chapter 7: Access Control</a>
</li>
            
<li >
    <a href="../../../java/tij/ch8/">Chapter 8: Reusing Clases</a>
</li>
            
<li >
    <a href="../../../java/tij/ch9/">Chapter 9: Polymorphism</a>
</li>
            
<li >
    <a href="../../../java/tij/ch10/">Chapter 10: Interfaces</a>
</li>
            
<li >
    <a href="../../../java/tij/ch11/">Chapter 11: Inner Classes</a>
</li>
            
<li >
    <a href="../../../java/tij/ch12/">Chapter 12: Holding Your Objects</a>
</li>
            
<li >
    <a href="../../../java/tij/ch13/">Chapter 13: Error Handling with Exceptions</a>
</li>
            
<li >
    <a href="../../../java/tij/ch14/">Chapter 14: Strings</a>
</li>
            
<li >
    <a href="../../../java/tij/ch15/">Chapter 15: Type Information</a>
</li>
            
<li >
    <a href="../../../java/tij/ch16/">Chapter 16: Generics</a>
</li>
            
<li >
    <a href="../../../java/tij/ch17/">Chapter 17: Arrays</a>
</li>
            
<li >
    <a href="../../../java/tij/ch18/">Chapter 18: Containers in Depth</a>
</li>
            
<li >
    <a href="../../../java/tij/ch19/">Chapter 19: I/O</a>
</li>
            
<li >
    <a href="../../../java/tij/ch20/">Chapter 20: Enumerated Types</a>
</li>
            
<li >
    <a href="../../../java/tij/ch21/">Chapter 21: Annotations</a>
</li>
            
<li >
    <a href="../../../java/tij/ch22/">Chapter 22: Concurrency</a>
</li>
            
<li >
    <a href="../../../java/tij/ch23/">Chapter 23: Graphical User Interfaces</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">UJVM</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../java/ujvm/">Contents</a>
</li>
            
<li >
    <a href="../../../java/ujvm/ch1/">Chapter 1 : 走进Java</a>
</li>
            
<li >
    <a href="../../../java/ujvm/ch2/">Chapter 2 : Java内存区域与内存溢出正常</a>
</li>
            
<li >
    <a href="../../../java/ujvm/ch3/">Chapter 3 : 垃圾收集器与内存分配策略</a>
</li>
            
<li >
    <a href="../../../java/ujvm/ch4/">Chapter 4 : 虚拟机性能监控与故障处理工具</a>
</li>
            
<li >
    <a href="../../../java/ujvm/ch5/">Chapter 5 : 调优案例分析与实战</a>
</li>
            
<li >
    <a href="../../../java/ujvm/ch6/">Chapter 6 : 类文件结构</a>
</li>
            
<li >
    <a href="../../../java/ujvm/ch7/">Chapter 7 : 虚拟机类加载机制</a>
</li>
            
<li >
    <a href="../../../java/ujvm/ch8/">Chapter 8 : 虚拟机字节码执行引擎</a>
</li>
            
<li >
    <a href="../../../java/ujvm/ch9/">Chapter 9 : 类加载及执行子系统的案例与实战</a>
</li>
            
<li >
    <a href="../../../java/ujvm/ch10/">Chapter 10 : 早期(编译期)优化</a>
</li>
            
<li >
    <a href="../../../java/ujvm/ch11/">Chapter 11 : 晚期(运行期)优化</a>
</li>
            
<li >
    <a href="../../../java/ujvm/ch12/">Chapter 12 : Java内存模型与线程</a>
</li>
            
<li >
    <a href="../../../java/ujvm/ch13/">Chapter 13 : 线程安全与锁优化</a>
</li>
            
<li >
    <a href="../../../java/ujvm/AppendixC/">Appendix HotSpot虚拟机主要参数列表</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">BigData <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../">Contents</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">HADOOP</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../">Contents</a>
</li>
            
<li >
    <a href="../ch1/">Chapter 1: Meet Hadoop</a>
</li>
            
<li class="active">
    <a href="./">Chapter 2: MapReduce</a>
</li>
            
<li >
    <a href="../ch3/">Chapter 3: The Hadoop Distributed FileSystem</a>
</li>
            
<li >
    <a href="../ch4/">Chapter 4: YARN</a>
</li>
            
<li >
    <a href="../ch5/">Chapter 5: Hadoop I/O</a>
</li>
            
<li >
    <a href="../ch6/">Chapter 6: Developing a MapReduce Application</a>
</li>
            
<li >
    <a href="../ch7/">Chapter 7: How MapReduce Works</a>
</li>
            
<li >
    <a href="../ch8/">Chapter 8: MapReduce Types and Formats</a>
</li>
            
<li >
    <a href="../ch9/">Chapter 9: MapReduce Features</a>
</li>
            
<li >
    <a href="../ch10/">Chapter 10: Setting Up a Hadoop Cluster</a>
</li>
            
<li >
    <a href="../ch11/">Chapter 11: Adminstering Hadoop</a>
</li>
            
<li >
    <a href="../ch12/">Chapter 12: Avro</a>
</li>
            
<li >
    <a href="../ch13/">Chapter 13: Parquet</a>
</li>
            
<li >
    <a href="../ch14/">Chapter 14: Flume</a>
</li>
            
<li >
    <a href="../ch15/">Chapter 15: Sqoop</a>
</li>
            
<li >
    <a href="../ch16/">Chapter 16: Pig</a>
</li>
            
<li >
    <a href="../ch17/">Chapter 17: Hive</a>
</li>
            
<li >
    <a href="../ch18/">Chapter 18: Crunch</a>
</li>
            
<li >
    <a href="../ch19/">Chapter 19: Spark</a>
</li>
            
<li >
    <a href="../ch20/">Chapter 20: HBase</a>
</li>
            
<li >
    <a href="../ch21/">Chapter 21: ZooKeeper</a>
</li>
            
<li >
    <a href="../ch22/">Chapter 22: Composable Data at Center</a>
</li>
            
<li >
    <a href="../ch23/">Chapter 23: Biological Data Science: Saving Lives with Software</a>
</li>
            
<li >
    <a href="../ch24/">Chapter 24: Cascading</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Spark</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../spark/">Contents</a>
</li>
            
<li >
    <a href="../../spark/ch1/">Chapter 1: Introduction to Data Analysis with Spark</a>
</li>
            
<li >
    <a href="../../spark/ch2/">Chapter 2: Downloading Spark and Getting Started</a>
</li>
            
<li >
    <a href="../../spark/ch3/">Chapter 3: Programming with RDDs</a>
</li>
            
<li >
    <a href="../../spark/ch4/">Chapter 4: Working with Key/Value Pairs</a>
</li>
            
<li >
    <a href="../../spark/ch5/">Chapter 5: Loading and Saving Your Data</a>
</li>
            
<li >
    <a href="../../spark/ch6/">Chapter 6: Advanced Spark Programming</a>
</li>
            
<li >
    <a href="../../spark/ch7/">Chapter 7: Running on a Cluster</a>
</li>
            
<li >
    <a href="../../spark/ch8/">Chapter 8: Tuning and Debugging Spark</a>
</li>
            
<li >
    <a href="../../spark/ch9/">Chapter 9: Spark SQL</a>
</li>
            
<li >
    <a href="../../spark/ch10/">Chapter 10: Spark Streaming</a>
</li>
            
<li >
    <a href="../../spark/ch11/">Chapter 11: Machine Learning with MLlib</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">GDM</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../gdm/">Contents</a>
</li>
            
<li >
    <a href="../../gdm/ch1/">Chapter 1: 推荐系统入门</a>
</li>
            
<li >
    <a href="../../gdm/ch2/">Chapter 2: 隐式评价和基于物品的过滤算法</a>
</li>
            
<li >
    <a href="../../gdm/ch3/">Chapter 3: 分类</a>
</li>
            
<li >
    <a href="../../gdm/ch4/">Chapter 4: 进一步探索分类</a>
</li>
            
<li >
    <a href="../../gdm/ch5/">Chapter 5: 概率和朴素贝叶斯</a>
</li>
            
<li >
    <a href="../../gdm/ch6/">Chapter 6: 朴素贝叶斯和文本数据</a>
</li>
            
<li >
    <a href="../../gdm/ch7/">Chapter 7: 聚类</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">MLIA</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../mlia/">Contents</a>
</li>
            
<li >
    <a href="../../mlia/ch1/">Chapter 1: 机器学习基础</a>
</li>
            
<li >
    <a href="../../mlia/ch2/">Chapter 2: k-近邻算法</a>
</li>
            
<li >
    <a href="../../mlia/ch3/">Chapter 3: 决策树</a>
</li>
            
<li >
    <a href="../../mlia/ch4/">Chapter 4: 基于概率论的分类方法：朴素贝叶斯</a>
</li>
            
<li >
    <a href="../../mlia/ch5/">Chapter 5: Logistic回归</a>
</li>
            
<li >
    <a href="../../mlia/ch6/">Chapter 6: 支持向量机</a>
</li>
            
<li >
    <a href="../../mlia/ch7/">Chapter 7: 利用AdaBoost元算法提高分类性能</a>
</li>
            
<li >
    <a href="../../mlia/ch8/">Chapter 8: 预测数值型数据：回归</a>
</li>
            
<li >
    <a href="../../mlia/ch9/">Chapter 9: 树回归</a>
</li>
            
<li >
    <a href="../../mlia/ch10/">Chapter 10: 利用Ｋ-均值聚类算法对未标注数据分组</a>
</li>
            
<li >
    <a href="../../mlia/ch11/">Chapter 11: 使用Apriori算法进行关联分析</a>
</li>
            
<li >
    <a href="../../mlia/ch11/">Chapter 12: 使用FP-growth算法来高效发现频繁项集</a>
</li>
            
<li >
    <a href="../../mlia/ch13/">Chapter 13: 利用PCA来简化数据</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Crawler</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../crawler/">Contents</a>
</li>
            
<li >
    <a href="../../crawler/ch1/">Chapter 1: 开发环境配置</a>
</li>
            
<li >
    <a href="../../crawler/ch2/">Chapter 2: 爬虫基础</a>
</li>
            
<li >
    <a href="../../crawler/ch3/">Chapter 3: 基本库的使用</a>
</li>
            
<li >
    <a href="../../crawler/ch4/">Chapter 4: 解析库的使用</a>
</li>
            
<li >
    <a href="../../crawler/ch5/">Chapter 5: 数据存储</a>
</li>
            
<li >
    <a href="../../crawler/ch7/">Chapter 7: 动态渲染页面爬取</a>
</li>
            
<li >
    <a href="../../crawler/ch13/">Chapter 13: Scrapy框架的使用</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Projects</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../projects/">Contents</a>
</li>
            
<li >
    <a href="../../projects/SparkStreaming实时流处理项目/">SparkStreaming实时流处理</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li >
                                <a href="../../../books/">Books</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>

                     <!--
                            <li >
                                <a rel="next" href="../ch1/">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../ch3/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    -->
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#hadoop-the-definitive-guide-2-mapreduce">Hadoop: The Definitive Guide 2 - MapReduce</a></li>
        <li class="main "><a href="#1-a-weather-dataset">1 A Weather Dataset</a></li>
            <li><a href="#analyzing-the-data-with-hadoop">Analyzing the Data with Hadoop</a></li>
            <li><a href="#java-mapreduce">Java MapReduce</a></li>
        <li class="main "><a href="#2-scaling-out">2 Scaling Out</a></li>
            <li><a href="#data-flow">Data Flow</a></li>
            <li><a href="#combiner-functions">Combiner Functions</a></li>
        <li class="main "><a href="#3-hadoop-streaming">3 Hadoop Streaming</a></li>
            <li><a href="#python">Python</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h3 id="hadoop-the-definitive-guide-2-mapreduce"><strong>Hadoop: The Definitive Guide 2 - MapReduce</strong><a class="headerlink" href="#hadoop-the-definitive-guide-2-mapreduce" title="Permanent link">&para;</a></h3>
<p>MapReduce is a programming model for data processing. MapReduce programs are inherently parallel, thus putting very large-scale data analysis into the hands of anyone with enough machines at their disposal.</p>
<h3 id="1-a-weather-dataset">1 A Weather Dataset<a class="headerlink" href="#1-a-weather-dataset" title="Permanent link">&para;</a></h3>
<p>For our example, we will write a program that mines weather data. The data we will use is from the National Climatic Data Center. It is stored using a line-oriented ASCII format, in which each line is a record.</p>
<h4 id="analyzing-the-data-with-hadoop">Analyzing the Data with Hadoop<a class="headerlink" href="#analyzing-the-data-with-hadoop" title="Permanent link">&para;</a></h4>
<p>MapReduce works by breaking the processing into two phases: the map phase and the reduce phase. Each phase has key-value pairs as input and output, the types of which may be chosen by the programmer. The programmer also specifies two functions: the map function and the reduce function.</p>
<p>MAPINPUT:</p>
<ul>
<li>Key: the offset of the beginning of the line from the beginning of the file. (no need here, just ignore it)</li>
<li>Value: raw NCDC data</li>
</ul>
<p> <div class=codehilite><pre>(0, 0067011990999991950051507004…9999999N9+00001+99999999999…) 
(106, 0043011990999991950051512004…9999999N9+00221+99999999999…) 
(212, 0043011990999991950051518004…9999999N9-00111+99999999999…) 
(318, 0043012650999991949032412004…0500001N9+01111+99999999999…) 
(424, 0043012650999991949032418004…0500001N9+00781+99999999999…)
</pre></div></p>
<p>MAPOUTPUT: </p>
<ul>
<li>The map function merely extracts the year and the air temperature , and emits them as output.</li>
<li>Key: year</li>
<li>Calue: air temperature</li>
</ul>
<p> <div class=codehilite><pre>(1950, 0)
(1950, 22) 
(1950, −11) 
(1949, 111) 
(1949, 78)
</pre></div></p>
<p>The output from the map function is processed by the MapReduce framework <em>before</em> being sent to the reduce function. This processing <strong><em>sorts</em></strong> and <strong><em>groups</em></strong> the key-value pairs by key.</p>
<p> <div class=codehilite><pre>(1949, [111, 78]) 
(1950, [0, 22, −11])
</pre></div></p>
<p>All the reduce function has to do now is iterate through the list and pick up the maximum reading:</p>
<p> <div class=codehilite><pre>(1949, 111) 
(1950, 22)
</pre></div></p>
<p><img alt="" src="../figures/MapReduceLogicalDataFlow.jpg" /></p>
<h4 id="java-mapreduce">Java MapReduce<a class="headerlink" href="#java-mapreduce" title="Permanent link">&para;</a></h4>
<p>We need three things: a map function, a reduce function, and some code to run the job. </p>
<p><hh>Map</hh></p>
<p>The map function is represented by the <C>Mapper</C> class, which declares an abstract <C>map()</C> method.</p>
<p>The <C>Mapper</C> class is a generic type, with four formal type parameters that specify the input key, input value, output key, and output value types of the map function.</p>
<p> <div class=codehilite><pre><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Mapper</span><span class=o>&lt;</span><span class=n>KEYIN</span><span class=o>,</span> <span class=n>VALUEIN</span><span class=o>,</span> <span class=n>KEYOUT</span><span class=o>,</span> <span class=n>VALUEOUT</span><span class=o>&gt;</span> <span class=o>{}</span>
</pre></div></p>
<p>Rather than using built-in Java types, Hadoop provides its own set of basic types that are optimized for network serialization. These are found in the <C>org.apache.hadoop.io</C> package.</p>
<p>Here we use <C>LongWritable</C>, which corresponds to a Java <C>Long</C>, <C>Text</C> (like Java <C>String</C>), and <C>IntWritable</C> (like Java <C>Integer</C>).</p>
<p> <div class=codehilite><pre><span class=kn>import</span> <span class=nn>org.apache.hadoop.io.IntWritable</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.apache.hadoop.io.LongWritable</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.apache.hadoop.io.Text</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.apache.hadoop.mapreduce.Mapper</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.io.IOException</span><span class=o>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>MaxTemperatureMapper</span>
        <span class=kd>extends</span> <span class=n>Mapper</span><span class=o>&lt;</span><span class=n>LongWritable</span><span class=o>,</span> <span class=n>Text</span><span class=o>,</span> <span class=n>Text</span><span class=o>,</span> <span class=n>IntWritable</span><span class=o>&gt;</span> <span class=o>{</span>

    <span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>MISSING</span> <span class=o>=</span> <span class=mi>9999</span><span class=o>;</span>

    <span class=nd>@Override</span>
    <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>map</span><span class=o>(</span><span class=n>LongWritable</span> <span class=n>key</span><span class=o>,</span> <span class=n>Text</span> <span class=n>value</span><span class=o>,</span> <span class=n>Context</span> <span class=n>context</span><span class=o>)</span>
            <span class=kd>throws</span> <span class=n>IOException</span><span class=o>,</span> <span class=n>InterruptedException</span> <span class=o>{</span>
        <span class=n>String</span> <span class=n>line</span> <span class=o>=</span> <span class=n>value</span><span class=o>.</span><span class=na>toString</span><span class=o>();</span>
        <span class=n>String</span> <span class=n>year</span> <span class=o>=</span> <span class=n>line</span><span class=o>.</span><span class=na>substring</span><span class=o>(</span><span class=mi>15</span><span class=o>,</span> <span class=mi>19</span><span class=o>);</span>
        <span class=kt>int</span> <span class=n>airTemperature</span><span class=o>;</span>
        <span class=k>if</span> <span class=o>(</span><span class=n>line</span><span class=o>.</span><span class=na>charAt</span><span class=o>(</span><span class=mi>87</span><span class=o>)</span> <span class=o>==</span> <span class=sc>&#39;+&#39;</span><span class=o>){</span> <span class=c1>//parseInt doesn&#39;t like leading plus signs</span>
            <span class=n>airTemperature</span> <span class=o>=</span> <span class=n>Integer</span><span class=o>.</span><span class=na>parseInt</span><span class=o>(</span><span class=n>line</span><span class=o>.</span><span class=na>substring</span><span class=o>(</span><span class=mi>88</span><span class=o>,</span> <span class=mi>92</span><span class=o>));</span>
        <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
            <span class=n>airTemperature</span> <span class=o>=</span> <span class=n>Integer</span><span class=o>.</span><span class=na>parseInt</span><span class=o>(</span><span class=n>line</span><span class=o>.</span><span class=na>substring</span><span class=o>(</span><span class=mi>87</span><span class=o>,</span> <span class=mi>92</span><span class=o>));</span>
        <span class=o>}</span>

        <span class=n>String</span> <span class=n>quality</span> <span class=o>=</span> <span class=n>line</span><span class=o>.</span><span class=na>substring</span><span class=o>(</span><span class=mi>92</span><span class=o>,</span> <span class=mi>93</span><span class=o>);</span>
        <span class=k>if</span> <span class=o>(</span><span class=n>airTemperature</span> <span class=o>!=</span> <span class=n>MISSING</span> <span class=o>&amp;&amp;</span> <span class=n>quality</span><span class=o>.</span><span class=na>matches</span><span class=o>(</span><span class=s>&quot;[01459]]&quot;</span><span class=o>))</span> <span class=o>{</span>
            <span class=n>context</span><span class=o>.</span><span class=na>write</span><span class=o>(</span><span class=k>new</span> <span class=n>Text</span><span class=o>(</span><span class=n>year</span><span class=o>),</span> <span class=k>new</span> <span class=n>IntWritable</span><span class=o>(</span><span class=n>airTemperature</span><span class=o>));</span>
        <span class=o>}</span>
    <span class=o>}</span>
<span class=o>}</span>
</pre></div></p>
<p><hh>Reduce</hh></p>
<p>The reduce function is similarly defined using a <C>Reducer</C>.</p>
<p> <div class=codehilite><pre><span class=kn>import</span> <span class=nn>org.apache.hadoop.io.IntWritable</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.apache.hadoop.io.Text</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.apache.hadoop.mapreduce.Reducer</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>java.io.IOException</span><span class=o>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>MaxTemperatureReducer</span>
        <span class=kd>extends</span> <span class=n>Reducer</span><span class=o>&lt;</span><span class=n>Text</span><span class=o>,</span> <span class=n>IntWritable</span><span class=o>,</span> <span class=n>Text</span><span class=o>,</span> <span class=n>IntWritable</span><span class=o>&gt;</span> <span class=o>{</span>

    <span class=nd>@Override</span>
    <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>reduce</span><span class=o>(</span><span class=n>Text</span> <span class=n>key</span><span class=o>,</span> <span class=n>Iterable</span><span class=o>&lt;</span><span class=n>IntWritable</span><span class=o>&gt;</span> <span class=n>values</span><span class=o>,</span> <span class=n>Context</span> <span class=n>context</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>IOException</span><span class=o>,</span> <span class=n>InterruptedException</span> <span class=o>{</span>
        <span class=kt>int</span> <span class=n>maxValue</span> <span class=o>=</span> <span class=n>Integer</span><span class=o>.</span><span class=na>MIN_VALUE</span><span class=o>;</span>
        <span class=k>for</span> <span class=o>(</span><span class=n>IntWritable</span> <span class=n>value</span> <span class=o>:</span> <span class=n>values</span><span class=o>)</span> <span class=o>{</span>
            <span class=n>maxValue</span> <span class=o>=</span> <span class=n>Math</span><span class=o>.</span><span class=na>max</span><span class=o>(</span><span class=n>maxValue</span><span class=o>,</span> <span class=n>value</span><span class=o>.</span><span class=na>get</span><span class=o>());</span>
        <span class=o>}</span>
        <span class=n>context</span><span class=o>.</span><span class=na>write</span><span class=o>(</span><span class=n>key</span><span class=o>,</span> <span class=k>new</span> <span class=n>IntWritable</span><span class=o>(</span><span class=n>maxValue</span><span class=o>));</span>

    <span class=o>}</span>
<span class=o>}</span>
</pre></div></p>
<p><hh>MapReduce Job</hh></p>
<p>The third piece of code runs the MapReduce job</p>
<p> <div class=codehilite><pre><span class=kn>import</span> <span class=nn>org.apache.hadoop.fs.Path</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.apache.hadoop.io.IntWritable</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.apache.hadoop.io.Text</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.apache.hadoop.mapreduce.Job</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.apache.hadoop.mapreduce.lib.input.FileInputFormat</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.apache.hadoop.mapreduce.lib.output.FileOutputFormat</span><span class=o>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>MaxTemperature</span> <span class=o>{</span>

    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span>
        <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
        <span class=k>if</span> <span class=o>(</span><span class=n>args</span><span class=o>.</span><span class=na>length</span> <span class=o>!=</span> <span class=mi>2</span><span class=o>)</span> <span class=o>{</span>
            <span class=n>System</span><span class=o>.</span><span class=na>err</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&quot;Usage: MaxTempeature &lt;intput path&gt; &lt;output path&gt;&quot;</span><span class=o>);</span>
            <span class=n>System</span><span class=o>.</span><span class=na>exit</span><span class=o>(-</span><span class=mi>1</span><span class=o>);</span>
        <span class=o>}</span>

        <span class=n>Job</span> <span class=n>job</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Job</span><span class=o>();</span>
        <span class=n>job</span><span class=o>.</span><span class=na>setJarByClass</span><span class=o>(</span><span class=n>MaxTemperature</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
        <span class=n>job</span><span class=o>.</span><span class=na>setJobName</span><span class=o>(</span><span class=s>&quot;Max Temperature&quot;</span><span class=o>);</span>
        <span class=n>FileInputFormat</span><span class=o>.</span><span class=na>addInputPath</span><span class=o>(</span><span class=n>job</span><span class=o>,</span> <span class=k>new</span> <span class=n>Path</span><span class=o>(</span><span class=n>args</span><span class=o>[</span><span class=mi>0</span><span class=o>]));</span>
        <span class=n>FileOutputFormat</span><span class=o>.</span><span class=na>setOutputPath</span><span class=o>(</span><span class=n>job</span><span class=o>,</span> <span class=k>new</span> <span class=n>Path</span><span class=o>(</span><span class=n>args</span><span class=o>[</span><span class=mi>1</span><span class=o>]));</span>
        <span class=n>job</span><span class=o>.</span><span class=na>setMapperClass</span><span class=o>(</span><span class=n>MaxTemperatureMapper</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
        <span class=n>job</span><span class=o>.</span><span class=na>setReducerClass</span><span class=o>(</span><span class=n>MaxTemperatureReducer</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
        <span class=n>job</span><span class=o>.</span><span class=na>setOutputKeyClass</span><span class=o>(</span><span class=n>Text</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
        <span class=n>job</span><span class=o>.</span><span class=na>setOutputValueClass</span><span class=o>(</span><span class=n>IntWritable</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
        <span class=n>System</span><span class=o>.</span><span class=na>exit</span><span class=o>(</span><span class=n>job</span><span class=o>.</span><span class=na>waitForCompletion</span><span class=o>(</span><span class=kc>true</span><span class=o>)</span> <span class=o>?</span> <span class=mi>0</span> <span class=o>:</span> <span class=mi>1</span><span class=o>);</span>
    <span class=o>}</span>
<span class=o>}</span>
</pre></div></p>
<p>A <C>Job</C> object forms the specification of the job and gives you control over how the job is run.</p>
<p>Rather than explicitly specifying the name of the JAR file, we can pass a class in the Job’s <C>setJarByClass()</C> method, which Hadoop will use to locate the relevant JAR file by looking for the JAR file containing this class.</p>
<p><hh>A test run</hh></p>
<p> <div class=codehilite><pre>$ <span class=nb>export</span> <span class=nv>HADOOP_CLASSPATH</span><span class=o>=</span>/Users/larry/JavaProject/out/artifacts/MaxTemperature/MaxTemperature.jar 
$ hadoop com.definitivehadoop.weatherdata.MaxTemperature resources/HadoopBook/ncdc/sample.txt output
</pre></div></p>
<p>When the <C>hadoop</C> command is invoked with a classname as the first argument, it launches a Java virtual machine (JVM) to run the class. The <C>hadoop</C> command adds the Hadoop libraries (and their dependencies) to the classpath and picks up the Hadoop configuration, too. To add the application classes to the classpath, we’ve defined an environment variable called <C>HADOOP_CLASSPATH</C>, which the <C>hadoop</C> script picks up.</p>
<p><font size=0.6em></p>
<p> <div class=codehilite><pre>//OUTPUT 
18:20:18,944 INFO mapreduce.Job: Counters: 30
        File System Counters
                FILE: Number of bytes read=148485300
                FILE: Number of bytes written=150614384
                FILE: Number of read operations=0
                FILE: Number of large read operations=0
                FILE: Number of write operations=0
        Map-Reduce Framework
                Map input records=5
                Map output records=0
                Map output bytes=0
                Map output materialized bytes=6
                Input split bytes=131
                Combine input records=0
                Combine output records=0
                Reduce input groups=0
                Reduce shuffle bytes=6
                Reduce input records=0
                Reduce output records=0
                Spilled Records=0
                Shuffled Maps =1
                Failed Shuffles=0
                Merged Map outputs=1
                GC time elapsed (ms)=5
                Total committed heap usage (bytes)=406847488
        Shuffle Errors
                BAD_ID=0
                CONNECTION=0
                IO_ERROR=0
                WRONG_LENGTH=0
                WRONG_MAP=0
                WRONG_REDUCE=0
        File Input Format Counters 
                Bytes Read=529
        File Output Format Counters 
                Bytes Written=8
</pre></div></p>
<p></font></p>
<p>The last section of the output, titled “Counters,” shows the statistics that Hadoop generates for each job it runs. These are very useful for checking whether the amount of data processed is what you expected.</p>
<h3 id="2-scaling-out">2 Scaling Out<a class="headerlink" href="#2-scaling-out" title="Permanent link">&para;</a></h3>
<p>To scale out, we need to store the data in a distributed filesystem (typically HDFS). This allows Hadoop to move the MapReduce computation to each machine hosting a part of the data, using Hadoop’s resource management system, YARN.</p>
<h4 id="data-flow">Data Flow<a class="headerlink" href="#data-flow" title="Permanent link">&para;</a></h4>
<p>A MapReduce <strong><em>job</em></strong> (作业) is a unit of work that the client wants to be performed: it consists of the input data, the MapReduce program, and configuration information. Hadoop runs the job by dividing it into <strong><em>tasks</em></strong> (任务), of which there are two types: <strong><em>map tasks</em></strong> and <strong><em>reduce tasks</em></strong>. The tasks are scheduled using YARN and run on nodes in the cluster.</p>
<p>Hadoop divides the input to a MapReduce job into fixed-size pieces called <strong><em>input splits</em></strong> (输入分片), or just <strong><em>splits</em></strong> (分片). Hadoop creates one map task for each split, which runs the user-defined map function for each record in the split.</p>
<p>So if we are processing the splits in parallel, the processing is better load balanced when the splits are small. On the other hand, if splits are too small, the overhead of managing the splits and map task creation begins to dominate the total job execution time.</p>
<p>Hadoop does its best to run the map task on a node where the input data resides in HDFS, because it doesn’t use valuable cluster bandwidth. This is called the <strong><em>data locality optimization</em></strong> (数据本地优化).</p>
<p><img alt="Data-local-a-rack-local-b-off-rack-c-mapTasks" src="../figures/Data-local-a-rack-local-b-off-rack-c-mapTasks.jpg" /></p>
<p>Map tasks write their output to the local disk, not to HDFS. Why is this? <strong><em>Map output is intermediate output:</em></strong> it’s processed by reduce tasks to produce the final output, and once the job is complete, the map output can be thrown away. So, storing it in HDFS <em>with replication</em> would be overkill.</p>
<p>The data flow for the general case of multiple reduce tasks is illustrated in figure below. This diagram makes it clear why the data flow between map and reduce tasks is colloquially known as “the shuffle,” as each reduce task is fed by many map tasks.</p>
<p><img alt="" src="../figures/MapReduceDataFlowWithMultipleReduceTask.jpg" /></p>
<h4 id="combiner-functions">Combiner Functions<a class="headerlink" href="#combiner-functions" title="Permanent link">&para;</a></h4>
<p>Many MapReduce jobs are limited by the bandwidth available on the cluster, so it pays to minimize the data transferred between map and reduce tasks. Hadoop allows the user to specify a <strong><em>combiner</em></strong> function to be run on the map output, and the combiner function’s output forms the input to the reduce function.</p>
<p>For max temperature problem described above, the combiner function is the same implementation as the reduce function in <C>MaxTemperatureReducer</C>. The only change we need to make is to set the combiner class on the Job.</p>
<p> <div class=codehilite><pre><span class=n>job</span><span class=o>.</span><span class=na>setMapperClass</span><span class=o>(</span><span class=n>MaxTemperatureMapper</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
<span class=n>job</span><span class=o>.</span><span class=na>setCombinerClass</span><span class=o>(</span><span class=n>MaxTemperatureReducer</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
<span class=n>job</span><span class=o>.</span><span class=na>setReducerClass</span><span class=o>(</span><span class=n>MaxTemperatureReducer</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</pre></div></p>
<p>A part of output information for running <C>MaxTemperatureReducer</C> is:</p>
<p> <div class=codehilite><pre>Map input records=5
                Map output records=5
                Map output bytes=45
                Map output materialized bytes=28
                Input split bytes=131
                Combine input records=5
                Combine output records=2
                Reduce input groups=2
                Reduce shuffle bytes=28
                Reduce input records=2
                Reduce output records=2
</pre></div></p>
<h3 id="3-hadoop-streaming">3 Hadoop Streaming<a class="headerlink" href="#3-hadoop-streaming" title="Permanent link">&para;</a></h3>
<p>Hadoop provides an API to MapReduce that allows you to write your map and reduce functions in languages other than Java. Hadoop Streaming uses Unix standard streams (Unix标准流) as the interface between Hadoop and your program, so you can use any language that can read standard input and write to standard output to write your MapReduce program.</p>
<p>Streaming is naturally suited for text processing. Map input data is passed over standard input to map function. A map output key-value pair is written as a single tab-delimited line. The reduce function reads lines from standard input, which the framework guarantees are sorted by key, and writes its results to standard output.</p>
<p>Here, We take Python as an example.</p>
<h4 id="python">Python<a class="headerlink" href="#python" title="Permanent link">&para;</a></h4>
<div class=md-fenced-code-tabs id=tab-tab-group-12><input name=tab-group-12 type=radio id=tab-group-12-0_Python checked=checked class=code-tab data-lang=Python aria-controls=tab-group-12-0_Python-panel role=tab><label for=tab-group-12-0_Python class=code-tab-label data-lang=Python id=tab-group-12-0_Python-label>Map</label><div class=code-tabpanel role=tabpanel data-lang=Python id=tab-group-12-0_Python-panel aria-labelledby=tab-group-12-0_Python-label><div class=codehilite><pre><span class=ch>#!/Users/larry/anaconda3/bin/python</span>
<span class=kn>import</span> <span class=nn>re</span>
<span class=kn>import</span> <span class=nn>sys</span>

<span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>sys</span><span class=o>.</span><span class=n>stdin</span><span class=p>:</span>
  <span class=n>val</span> <span class=o>=</span> <span class=n>line</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
  <span class=p>(</span><span class=n>year</span><span class=p>,</span> <span class=n>temp</span><span class=p>,</span> <span class=n>q</span><span class=p>)</span> <span class=o>=</span> <span class=p>(</span><span class=n>val</span><span class=p>[</span><span class=mi>15</span><span class=p>:</span><span class=mi>19</span><span class=p>],</span> <span class=n>val</span><span class=p>[</span><span class=mi>87</span><span class=p>:</span><span class=mi>92</span><span class=p>],</span> <span class=n>val</span><span class=p>[</span><span class=mi>92</span><span class=p>:</span><span class=mi>93</span><span class=p>])</span>
  <span class=k>if</span> <span class=p>(</span><span class=n>temp</span> <span class=o>!=</span> <span class=s2>&quot;+9999&quot;</span> <span class=ow>and</span> <span class=n>re</span><span class=o>.</span><span class=n>match</span><span class=p>(</span><span class=s2>&quot;[01459]&quot;</span><span class=p>,</span> <span class=n>q</span><span class=p>)):</span>
    <span class=k>print</span><span class=p>(</span><span class=s2>&quot;</span><span class=si>%s</span><span class=se>\t</span><span class=si>%s</span><span class=s2>&quot;</span><span class=o>%</span><span class=p>(</span><span class=n>year</span><span class=p>,</span> <span class=n>temp</span><span class=p>))</span>
</pre></div></div><input name=tab-group-12 type=radio id=tab-group-12-1_Python class=code-tab data-lang=Python aria-controls=tab-group-12-1_Python-panel role=tab><label for=tab-group-12-1_Python class=code-tab-label data-lang=Python id=tab-group-12-1_Python-label>Reduce</label><div class=code-tabpanel role=tabpanel data-lang=Python id=tab-group-12-1_Python-panel aria-labelledby=tab-group-12-1_Python-label><div class=codehilite><pre><span class=ch>#!/Users/larry/anaconda3/bin/python</span>

<span class=kn>import</span> <span class=nn>sys</span>

<span class=p>(</span><span class=n>last_key</span><span class=p>,</span> <span class=n>max_val</span><span class=p>)</span> <span class=o>=</span> <span class=p>(</span><span class=bp>None</span><span class=p>,</span> <span class=o>-</span><span class=n>sys</span><span class=o>.</span><span class=n>maxsize</span><span class=p>)</span>
<span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>sys</span><span class=o>.</span><span class=n>stdin</span><span class=p>:</span>
  <span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>val</span><span class=p>)</span> <span class=o>=</span> <span class=n>line</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\t</span><span class=s2>&quot;</span><span class=p>)</span>
  <span class=k>if</span> <span class=n>last_key</span> <span class=ow>and</span> <span class=n>last_key</span> <span class=o>!=</span> <span class=n>key</span><span class=p>:</span>
    <span class=k>print</span><span class=p>(</span><span class=s2>&quot;</span><span class=si>%s</span><span class=se>\t</span><span class=si>%s</span><span class=s2>&quot;</span><span class=o>%</span><span class=p>(</span><span class=n>last_key</span><span class=p>,</span> <span class=n>max_val</span><span class=p>))</span>
    <span class=p>(</span><span class=n>last_key</span><span class=p>,</span> <span class=n>max_val</span><span class=p>)</span> <span class=o>=</span> <span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=nb>int</span><span class=p>(</span><span class=n>val</span><span class=p>))</span>
  <span class=k>else</span><span class=p>:</span>
    <span class=p>(</span><span class=n>last_key</span><span class=p>,</span> <span class=n>max_val</span><span class=p>)</span> <span class=o>=</span> <span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=nb>max</span><span class=p>(</span><span class=n>max_val</span><span class=p>,</span> <span class=nb>int</span><span class=p>(</span><span class=n>val</span><span class=p>)))</span>

<span class=k>if</span> <span class=n>last_key</span><span class=p>:</span>
  <span class=k>print</span><span class=p>(</span><span class=s2>&quot;</span><span class=si>%s</span><span class=se>\t</span><span class=si>%s</span><span class=s2>&quot;</span><span class=o>%</span><span class=p>(</span><span class=n>last_key</span><span class=p>,</span> <span class=n>max_val</span><span class=p>))</span>
</pre></div></div></div>

<p>For example, to run a test:</p>
<p> <div class=codehilite><pre>$ cat sample.txt <span class=p>|</span> ./max_temperature_map.py <span class=p>|</span> sort <span class=p>|</span> ./max_temperature_reduce.py
<span class=m>1949</span> <span class=m>111</span> 
<span class=m>1950</span> 22
</pre></div></p>
<p>The <C>hadoop</C> command doesn’t support a Streaming option; instead, you specify the Streaming JAR file along with the <C>jar</C> option. Options to the Streaming program specify the input and output paths and the map and reduce scripts.</p>
<p> <div class=codehilite><pre>$hadoop jar $HADOOP_HOME/share/hadoop/tools/lib/hadoop-streaming-3.1.0.jar <span class=se>\</span>
-input sample.txt <span class=se>\</span>
-output output <span class=se>\</span>
-mapper max_temperature_map.py <span class=se>\</span>
-reducer max_temperature_reduce.py
</pre></div></p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../../..",
                shortcuts = {"search": 83, "next": 78, "help": 191, "previous": 80};
        </script>
        <script src="../../../js/base.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
        <script src="../../../extra_javascript/tabhack.js" defer></script>
        <script src="../../../extra_javascript/baidu.js" defer></script>
        <script src="../../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
