<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Zhenhua Wang">
        <link rel="canonical" href="http://larryim.cc/note-os/bigdata/hadoop/ch12/">
        <link rel="shortcut icon" href="../../../img/favicon.ico">
        <title>Chapter 12: Avro - Zhenhua's Notes</title>
        <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/docco.min.css">
        <link href="../../../extra_css/custom.css" rel="stylesheet">
        <link href="../../../extra_css/custom.js" rel="stylesheet">
        <link href="../../../extra_css/friendly.css" rel="stylesheet">
        <link href="../../../extra_css/theme.css" rel="stylesheet">
        <link href="../../../extra_css/mkdocs/js/lunr-0.5.7.min.js" rel="stylesheet">
        <link href="../../../extra_css/mkdocs/js/mustache.min.js" rel="stylesheet">
        <link href="../../../extra_css/mkdocs/js/require.js" rel="stylesheet">
        <link href="../../../extra_css/mkdocs/js/search.js" rel="stylesheet">
        <link href="../../../extra_css/mkdocs/js/text.js" rel="stylesheet">
        <link href="../../../extra_css/code-tab.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../../..">Zhenhua's Notes</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="../../..">Home</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Algorithm <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../algorithm/">Contents</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">AlgorithmPrinceton</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/">Contents</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/unionfind/">Topic 1: UnionFind</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/stackqueue/">Topic 2: StackQueue</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/sort/">Topic 3: Sort</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/priorityqueue/">Topic 4: PriorityQueues</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/symboltable/">Topic 5: Symbol Tables</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/bst/">Topic 6: Balanced Search Trees</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/hashtable/">Topic 7: Hash Table</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/graph/">Topic 8: Graph</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/mst_shortestpath/">Topic 9: Minimum Spanning Tree and Shortest Path</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/stringsort/">Topic 11: String Sort</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/tries/">Topic 12: Tries</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">AlgorithmStanford</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../algorithm/algorithmStanford/">Contents</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmStanford/dynamicprogramming/">Topic: Dynammic Programming</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmStanford/heap/">Topic: Heap</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmStanford/graph/">Topic: Graph</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmStanford/greedy/">Topic: Greedy Algorithm</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmStanford/hashtable/">Topic: Hash Table</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">CS61B</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../algorithm/cs61b/">Contents</a>
</li>
            
<li >
    <a href="../../../algorithm/cs61b/Lab1/">Lab1: javac, java, git</a>
</li>
            
<li >
    <a href="../../../algorithm/cs61b/Lab2/">Lab2: Unit Testing with JUnit and IntLists</a>
</li>
            
<li >
    <a href="../../../algorithm/cs61b/Lab3/">Lab3: Unit Testing with JUnit, Debugging</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">SWORD</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../algorithm/sword/">Contents</a>
</li>
            
<li >
    <a href="../../../algorithm/sword/solution/">剑指Offer题解</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">OS <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../os/">Contents</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">OSC</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../os/osc/">Contents</a>
</li>
            
<li >
    <a href="../../../os/osc/ch1/">Chapter 1: Introduction </a>
</li>
            
<li >
    <a href="../../../os/osc/ch2/">Chapter 2: Operating System structures</a>
</li>
            
<li >
    <a href="../../../os/osc/ch3/">Chapter 3: Processes</a>
</li>
            
<li >
    <a href="../../../os/osc/ch4/">Chapter 4: Threads and Concurrency</a>
</li>
            
<li >
    <a href="../../../os/osc/ch5/">Chapter 5: CPU Scheduling</a>
</li>
            
<li >
    <a href="../../../os/osc/ch6/">Chapter 6: Synchronization Tools</a>
</li>
            
<li >
    <a href="../../../os/osc/ch7/">Chapter 7: Synchronization Examples</a>
</li>
            
<li >
    <a href="../../../os/osc/ch8/">Chapter 8: Deadlocks</a>
</li>
            
<li >
    <a href="../../../os/osc/ch9/">Chapter 9: Main Memory</a>
</li>
            
<li >
    <a href="../../../os/osc/ch10/">Chapter 10: Virtual Memory</a>
</li>
            
<li >
    <a href="../../../os/osc/ch11/">Chapter 11: Mass-Storage Structure</a>
</li>
            
<li >
    <a href="../../../os/osc/ch13/">Chapter 13: File-System Interfaces</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">CSAPP</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../os/csapp/">Contents</a>
</li>
            
<li >
    <a href="../../../os/csapp/ch1/">Chapter 1: 计算机系统漫游</a>
</li>
            
<li >
    <a href="../../../os/csapp/ch2/">Chapter 2: 信息的表示和处理</a>
</li>
            
<li >
    <a href="../../../os/csapp/ch3/">Chapter 3: 程序的机器级表示</a>
</li>
            
<li >
    <a href="../../../os/csapp/ch4/">Chapter 4: 处理器体系结构</a>
</li>
            
<li >
    <a href="../../../os/csapp/ch5/">Chapter 5: 优化程序性能</a>
</li>
            
<li >
    <a href="../../../os/csapp/ch6/">Chapter 6: 存储器层次结构</a>
</li>
            
<li >
    <a href="../../../os/csapp/ch7/">Chapter 7: 链接</a>
</li>
            
<li >
    <a href="../../../os/csapp/ch8/">Chapter 8: 异常控制流</a>
</li>
            
<li >
    <a href="../../../os/csapp/ch9/">Chapter 9: 虚拟内存</a>
</li>
            
<li >
    <a href="../../../os/csapp/ch10/">Chapter 10: 系统级I/O</a>
</li>
            
<li >
    <a href="../../../os/csapp/ch11/">Chapter 11: 网络编程</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">DataBase <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../database/">Contents</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">MySql</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../database/mysql/">Contents</a>
</li>
            
<li >
    <a href="../../../database/mysql/LearningMySQLandMariaDB/">Chapter Learning MySQL and MariaDB</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Java <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../java/">Contents</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">HFJ</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../java/hfj/">Contents</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch1/">Chapter 1: Dive in A Quick Dip</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch2/">Chapter 2: Classes and Objects</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch3/">Chapter 3: Primitives and References</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch4/">Chapter 4: Methods use Instance Variables</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch5/">Chapter 5: Writing a Program</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch6/">Chapter 6: Get to Know the Java API</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch7/">Chapter 7: Inheritance and Polymorphism</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch8/">Chapter 8: Interfaces and Abstract Classes</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch9/">Chapter 9: Constructors and Garbage Collection</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch10/">Chapter 10: Numbers and Statics</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch11/">Chapter 11: Exception Handling</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch12/">Chapter 12: Getting GUI</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch13/">Chapter 13: Using Swing</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch14/">Chapter 14: Serialization and File I/O</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch15/">Chapter 15: Networking and Threads</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch16/">Chapter 16: Collections and Generics</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch17/">Chapter 17: Packages, Jars and Deployment</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch18/">Chapter 18: Remote deploy with RMI</a>
</li>
            
<li >
    <a href="../../../java/hfj/Appendix/">Appendix: The Top Ten Topics</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">HFDP</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../java/hfdp/">Contents</a>
</li>
            
<li >
    <a href="../../../java/hfdp/ch1/">Chapter 1: Strategy Pattern </a>
</li>
            
<li >
    <a href="../../../java/hfdp/ch2/">Chapter 2: Observer Pattern</a>
</li>
            
<li >
    <a href="../../../java/hfdp/ch3/">Chapter 3: Decorator Pattern </a>
</li>
            
<li >
    <a href="../../../java/hfdp/ch4/">Chapter 4: Factory Pattern</a>
</li>
            
<li >
    <a href="../../../java/hfdp/ch5/">Chapter 5: Singleton Pattern</a>
</li>
            
<li >
    <a href="../../../java/hfdp/ch6/">Chapter 6: Command Pattern</a>
</li>
            
<li >
    <a href="../../../java/hfdp/ch7/">Chapter 7: Adapter and Facade Patterns</a>
</li>
            
<li >
    <a href="../../../java/hfdp/ch8/">Chapter 8: Template Method Pattern</a>
</li>
            
<li >
    <a href="../../../java/hfdp/ch9/">Chapter 9: Iterator and Composite Patterns</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">MultiThreading</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../java/multithreading/">Contents</a>
</li>
            
<li >
    <a href="../../../java/multithreading/pre1/">序章1 Java线程</a>
</li>
            
<li >
    <a href="../../../java/multithreading/pre2/">序章2 多线程程序的评价标准</a>
</li>
            
<li >
    <a href="../../../java/multithreading/ch1/">第1章 Single Threaded Execution模式</a>
</li>
            
<li >
    <a href="../../../java/multithreading/ch1/">第2章 Immutable模式</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">TIJ</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../java/tij/">Contents</a>
</li>
            
<li >
    <a href="../../../java/tij/ch1/">Chapter 1: Introduction</a>
</li>
            
<li >
    <a href="../../../java/tij/ch2/">Chapter 2: Introduction to Objects</a>
</li>
            
<li >
    <a href="../../../java/tij/ch3/">Chapter 3: Everything is an Object</a>
</li>
            
<li >
    <a href="../../../java/tij/ch4/">Chapter 4: Opertors</a>
</li>
            
<li >
    <a href="../../../java/tij/ch5/">Chapter 5: Controlling Execution</a>
</li>
            
<li >
    <a href="../../../java/tij/ch6/">Chapter 6: Initialization & Cleanup</a>
</li>
            
<li >
    <a href="../../../java/tij/ch7/">Chapter 7: Access Control</a>
</li>
            
<li >
    <a href="../../../java/tij/ch8/">Chapter 8: Reusing Clases</a>
</li>
            
<li >
    <a href="../../../java/tij/ch9/">Chapter 9: Polymorphism</a>
</li>
            
<li >
    <a href="../../../java/tij/ch10/">Chapter 10: Interfaces</a>
</li>
            
<li >
    <a href="../../../java/tij/ch11/">Chapter 11: Inner Classes</a>
</li>
            
<li >
    <a href="../../../java/tij/ch12/">Chapter 12: Holding Your Objects</a>
</li>
            
<li >
    <a href="../../../java/tij/ch13/">Chapter 13: Error Handling with Exceptions</a>
</li>
            
<li >
    <a href="../../../java/tij/ch14/">Chapter 14: Strings</a>
</li>
            
<li >
    <a href="../../../java/tij/ch15/">Chapter 15: Type Information</a>
</li>
            
<li >
    <a href="../../../java/tij/ch16/">Chapter 16: Generics</a>
</li>
            
<li >
    <a href="../../../java/tij/ch17/">Chapter 17: Arrays</a>
</li>
            
<li >
    <a href="../../../java/tij/ch18/">Chapter 18: Containers in Depth</a>
</li>
            
<li >
    <a href="../../../java/tij/ch19/">Chapter 19: I/O</a>
</li>
            
<li >
    <a href="../../../java/tij/ch20/">Chapter 20: Enumerated Types</a>
</li>
            
<li >
    <a href="../../../java/tij/ch21/">Chapter 21: Annotations</a>
</li>
            
<li >
    <a href="../../../java/tij/ch22/">Chapter 22: Concurrency</a>
</li>
            
<li >
    <a href="../../../java/tij/ch23/">Chapter 23: Graphical User Interfaces</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">UJVM</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../java/ujvm/">Contents</a>
</li>
            
<li >
    <a href="../../../java/ujvm/ch1/">Chapter 1 : 走进Java</a>
</li>
            
<li >
    <a href="../../../java/ujvm/ch2/">Chapter 2 : Java内存区域与内存溢出正常</a>
</li>
            
<li >
    <a href="../../../java/ujvm/ch3/">Chapter 3 : 垃圾收集器与内存分配策略</a>
</li>
            
<li >
    <a href="../../../java/ujvm/ch4/">Chapter 4 : 虚拟机性能监控与故障处理工具</a>
</li>
            
<li >
    <a href="../../../java/ujvm/ch5/">Chapter 5 : 调优案例分析与实战</a>
</li>
            
<li >
    <a href="../../../java/ujvm/ch6/">Chapter 6 : 类文件结构</a>
</li>
            
<li >
    <a href="../../../java/ujvm/ch7/">Chapter 7 : 虚拟机类加载机制</a>
</li>
            
<li >
    <a href="../../../java/ujvm/ch8/">Chapter 8 : 虚拟机字节码执行引擎</a>
</li>
            
<li >
    <a href="../../../java/ujvm/ch9/">Chapter 9 : 类加载及执行子系统的案例与实战</a>
</li>
            
<li >
    <a href="../../../java/ujvm/ch10/">Chapter 10 : 早期(编译期)优化</a>
</li>
            
<li >
    <a href="../../../java/ujvm/ch11/">Chapter 11 : 晚期(运行期)优化</a>
</li>
            
<li >
    <a href="../../../java/ujvm/ch12/">Chapter 12 : Java内存模型与线程</a>
</li>
            
<li >
    <a href="../../../java/ujvm/ch13/">Chapter 13 : 线程安全与锁优化</a>
</li>
            
<li >
    <a href="../../../java/ujvm/AppendixC/">Appendix HotSpot虚拟机主要参数列表</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">BigData <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../">Contents</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">HADOOP</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../">Contents</a>
</li>
            
<li >
    <a href="../ch1/">Chapter 1: Meet Hadoop</a>
</li>
            
<li >
    <a href="../ch2/">Chapter 2: MapReduce</a>
</li>
            
<li >
    <a href="../ch3/">Chapter 3: The Hadoop Distributed FileSystem</a>
</li>
            
<li >
    <a href="../ch4/">Chapter 4: YARN</a>
</li>
            
<li >
    <a href="../ch5/">Chapter 5: Hadoop I/O</a>
</li>
            
<li >
    <a href="../ch6/">Chapter 6: Developing a MapReduce Application</a>
</li>
            
<li >
    <a href="../ch7/">Chapter 7: How MapReduce Works</a>
</li>
            
<li >
    <a href="../ch8/">Chapter 8: MapReduce Types and Formats</a>
</li>
            
<li >
    <a href="../ch9/">Chapter 9: MapReduce Features</a>
</li>
            
<li >
    <a href="../ch10/">Chapter 10: Setting Up a Hadoop Cluster</a>
</li>
            
<li >
    <a href="../ch11/">Chapter 11: Adminstering Hadoop</a>
</li>
            
<li class="active">
    <a href="./">Chapter 12: Avro</a>
</li>
            
<li >
    <a href="../ch13/">Chapter 13: Parquet</a>
</li>
            
<li >
    <a href="../ch14/">Chapter 14: Flume</a>
</li>
            
<li >
    <a href="../ch15/">Chapter 15: Sqoop</a>
</li>
            
<li >
    <a href="../ch16/">Chapter 16: Pig</a>
</li>
            
<li >
    <a href="../ch17/">Chapter 17: Hive</a>
</li>
            
<li >
    <a href="../ch18/">Chapter 18: Crunch</a>
</li>
            
<li >
    <a href="../ch19/">Chapter 19: Spark</a>
</li>
            
<li >
    <a href="../ch20/">Chapter 20: HBase</a>
</li>
            
<li >
    <a href="../ch21/">Chapter 21: ZooKeeper</a>
</li>
            
<li >
    <a href="../ch22/">Chapter 22: Composable Data at Center</a>
</li>
            
<li >
    <a href="../ch23/">Chapter 23: Biological Data Science: Saving Lives with Software</a>
</li>
            
<li >
    <a href="../ch24/">Chapter 24: Cascading</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Spark</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../spark/">Contents</a>
</li>
            
<li >
    <a href="../../spark/ch1/">Chapter 1: Introduction to Data Analysis with Spark</a>
</li>
            
<li >
    <a href="../../spark/ch2/">Chapter 2: Downloading Spark and Getting Started</a>
</li>
            
<li >
    <a href="../../spark/ch3/">Chapter 3: Programming with RDDs</a>
</li>
            
<li >
    <a href="../../spark/ch4/">Chapter 4: Working with Key/Value Pairs</a>
</li>
            
<li >
    <a href="../../spark/ch5/">Chapter 5: Loading and Saving Your Data</a>
</li>
            
<li >
    <a href="../../spark/ch6/">Chapter 6: Advanced Spark Programming</a>
</li>
            
<li >
    <a href="../../spark/ch7/">Chapter 7: Running on a Cluster</a>
</li>
            
<li >
    <a href="../../spark/ch8/">Chapter 8: Tuning and Debugging Spark</a>
</li>
            
<li >
    <a href="../../spark/ch9/">Chapter 9: Spark SQL</a>
</li>
            
<li >
    <a href="../../spark/ch10/">Chapter 10: Spark Streaming</a>
</li>
            
<li >
    <a href="../../spark/ch11/">Chapter 11: Machine Learning with MLlib</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">GDM</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../gdm/">Contents</a>
</li>
            
<li >
    <a href="../../gdm/ch1/">Chapter 1: 推荐系统入门</a>
</li>
            
<li >
    <a href="../../gdm/ch2/">Chapter 2: 隐式评价和基于物品的过滤算法</a>
</li>
            
<li >
    <a href="../../gdm/ch3/">Chapter 3: 分类</a>
</li>
            
<li >
    <a href="../../gdm/ch4/">Chapter 4: 进一步探索分类</a>
</li>
            
<li >
    <a href="../../gdm/ch5/">Chapter 5: 概率和朴素贝叶斯</a>
</li>
            
<li >
    <a href="../../gdm/ch6/">Chapter 6: 朴素贝叶斯和文本数据</a>
</li>
            
<li >
    <a href="../../gdm/ch7/">Chapter 7: 聚类</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">MLIA</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../mlia/">Contents</a>
</li>
            
<li >
    <a href="../../mlia/ch1/">Chapter 1: 机器学习基础</a>
</li>
            
<li >
    <a href="../../mlia/ch2/">Chapter 2: k-近邻算法</a>
</li>
            
<li >
    <a href="../../mlia/ch3/">Chapter 3: 决策树</a>
</li>
            
<li >
    <a href="../../mlia/ch4/">Chapter 4: 基于概率论的分类方法：朴素贝叶斯</a>
</li>
            
<li >
    <a href="../../mlia/ch5/">Chapter 5: Logistic回归</a>
</li>
            
<li >
    <a href="../../mlia/ch6/">Chapter 6: 支持向量机</a>
</li>
            
<li >
    <a href="../../mlia/ch7/">Chapter 7: 利用AdaBoost元算法提高分类性能</a>
</li>
            
<li >
    <a href="../../mlia/ch8/">Chapter 8: 预测数值型数据：回归</a>
</li>
            
<li >
    <a href="../../mlia/ch9/">Chapter 9: 树回归</a>
</li>
            
<li >
    <a href="../../mlia/ch10/">Chapter 10: 利用Ｋ-均值聚类算法对未标注数据分组</a>
</li>
            
<li >
    <a href="../../mlia/ch11/">Chapter 11: 使用Apriori算法进行关联分析</a>
</li>
            
<li >
    <a href="../../mlia/ch11/">Chapter 12: 使用FP-growth算法来高效发现频繁项集</a>
</li>
            
<li >
    <a href="../../mlia/ch13/">Chapter 13: 利用PCA来简化数据</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Crawler</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../crawler/">Contents</a>
</li>
            
<li >
    <a href="../../crawler/ch1/">Chapter 1: 开发环境配置</a>
</li>
            
<li >
    <a href="../../crawler/ch2/">Chapter 2: 爬虫基础</a>
</li>
            
<li >
    <a href="../../crawler/ch3/">Chapter 3: 基本库的使用</a>
</li>
            
<li >
    <a href="../../crawler/ch4/">Chapter 4: 解析库的使用</a>
</li>
            
<li >
    <a href="../../crawler/ch5/">Chapter 5: 数据存储</a>
</li>
            
<li >
    <a href="../../crawler/ch7/">Chapter 7: 动态渲染页面爬取</a>
</li>
            
<li >
    <a href="../../crawler/ch13/">Chapter 13: Scrapy框架的使用</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Projects</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../projects/">Contents</a>
</li>
            
<li >
    <a href="../../projects/SparkStreaming实时流处理项目/">SparkStreaming实时流处理</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li >
                                <a href="../../../books/">Books</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>

                     <!--
                            <li >
                                <a rel="next" href="../ch11/">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../ch13/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    -->
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#hadoop-the-definitive-guide-12-avro">Hadoop: The Definitive Guide 12 - Avro</a></li>
        <li class="main "><a href="#geting-start">Geting start</a></li>
            <li><a href="#defining-a-schema">Defining a schema</a></li>
            <li><a href="#serializing-and-deserializing">Serializing and deserializing</a></li>
        <li class="main "><a href="#sort-order">Sort Order</a></li>
        <li class="main "><a href="#avro-mapreduce">Avro MapReduce</a></li>
            <li><a href="#sorting-using-avro-mapreduce">Sorting Using Avro MapReduce</a></li>
        <li class="main "><a href="#useful-resources">Useful resources</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h3 id="hadoop-the-definitive-guide-12-avro"><strong>Hadoop: The Definitive Guide 12 - Avro</strong><a class="headerlink" href="#hadoop-the-definitive-guide-12-avro" title="Permanent link">&para;</a></h3>
<p>Apache Avro is a language-neutral data serialization system. The project was created by Doug Cutting to address the major downside of Hadoop <C>Writables</C>: <strong>lack of language portability</strong> [see <a href="../ch5/#3-serialization">Chapter5</a>]. Having a data format that can be processed by many languages makes it easier to share datasets with a wider audience.</p>
<p>Avro data is described using a language-independent <strong>schema</strong>(模式). Schemas are usually written in JSON, and data is usually encoded using a binary format.</p>
<h3 id="geting-start">Geting start<a class="headerlink" href="#geting-start" title="Permanent link">&para;</a></h3>
<p>This section based on <a href="http://avro.apache.org/docs/current/gettingstartedjava.html">Apache Avro™ Getting Started (Java)</a>.</p>
<h4 id="defining-a-schema">Defining a schema<a class="headerlink" href="#defining-a-schema" title="Permanent link">&para;</a></h4>
<p>Avro schemas are defined using JSON. Schemas are composed of primitive types (null, boolean, int, long, float, double, bytes, and string) and complex types (record, enum, array, map, union, and fixed).</p>
<p>Let's start with a simple schema example, <code class="codehilite">user.avsc</code>:</p>
<p> <div class=codehilite><pre>{&quot;namespace&quot;: &quot;example.avro&quot;,
 &quot;type&quot;: &quot;record&quot;,
 &quot;name&quot;: &quot;User&quot;,
 &quot;fields&quot;: [
     {&quot;name&quot;: &quot;name&quot;, &quot;type&quot;: &quot;string&quot;},
     {&quot;name&quot;: &quot;favorite_number&quot;,  &quot;type&quot;: [&quot;int&quot;, &quot;null&quot;]},
     {&quot;name&quot;: &quot;favorite_color&quot;, &quot;type&quot;: [&quot;string&quot;, &quot;null&quot;]}
 ]
}
</pre></div></p>
<p>This schema defines a record representing a hypothetical user. (Note that a schema file can only contain a single schema definition.) At minimum, a record definition must include its type, a name, and fields. Fields are defined via an array of objects, each of which defines a name and type; The type attribute of a field is another schema object, which can be either a primitive or complex type.</p>
<h4 id="serializing-and-deserializing">Serializing and deserializing<a class="headerlink" href="#serializing-and-deserializing" title="Permanent link">&para;</a></h4>
<p>Let's  create some users, serialize them to a data file on disk, and then read back the file and deserialize the users objects.</p>
<p><hh>Creating users</hh></p>
<p>First, we use a <C>Parser</C> to read our schema definition and create a <C>Schema</C> object.</p>
<p> <div class=codehilite><pre><span class=n>Schema</span> <span class=n>schema</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Schema</span><span class=o>.</span><span class=na>Parser</span><span class=o>().</span><span class=na>parse</span><span class=o>(</span><span class=k>new</span> <span class=n>File</span><span class=o>(</span><span class=s>&quot;user.avsc&quot;</span><span class=o>));</span>
</pre></div></p>
<p>Using this schema, let's create some users.</p>
<p> <div class=codehilite><pre><span class=n>GenericRecord</span> <span class=n>user1</span> <span class=o>=</span> <span class=k>new</span> <span class=n>GenericData</span><span class=o>.</span><span class=na>Record</span><span class=o>(</span><span class=n>schema</span><span class=o>);</span>
<span class=n>user1</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&quot;name&quot;</span><span class=o>,</span> <span class=s>&quot;Alyssa&quot;</span><span class=o>);</span>
<span class=n>user1</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&quot;favorite_number&quot;</span><span class=o>,</span> <span class=mi>256</span><span class=o>);</span>
<span class=c1>// Leave favorite color null</span>

<span class=n>GenericRecord</span> <span class=n>user2</span> <span class=o>=</span> <span class=k>new</span> <span class=n>GenericData</span><span class=o>.</span><span class=na>Record</span><span class=o>(</span><span class=n>schema</span><span class=o>);</span>
<span class=n>user2</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&quot;name&quot;</span><span class=o>,</span> <span class=s>&quot;Ben&quot;</span><span class=o>);</span>
<span class=n>user2</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&quot;favorite_number&quot;</span><span class=o>,</span> <span class=mi>7</span><span class=o>);</span>
<span class=n>user2</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&quot;favorite_color&quot;</span><span class=o>,</span> <span class=s>&quot;red&quot;</span><span class=o>);</span>
</pre></div></p>
<p>We use <C>GenericRecords</C> to represent users. <C>GenericRecords</C>  uses the schema to verify that we only specify valid fields. If we try to set a non-existent field (e.g., user1.put("favorite_animal", "cat")), we'll get an <C>AvroRuntimeException</C> when we run the program.</p>
<p>Note that we do not set user1's favorite color. Since that record is of type ["string", "null"], we can either set it to a string or leave it null; it is essentially optional.</p>
<p><hh>Serializing</hh></p>
<p>Now that we've created our user objects, we use generic readers and writers to serialize and deserialize them.</p>
<p>First we'll serialize our users to a data file on disk.</p>
<p> <div class=codehilite><pre><span class=c1>// Serialize user1 and user2 to disk</span>
<span class=n>File</span> <span class=n>file</span> <span class=o>=</span> <span class=k>new</span> <span class=n>File</span><span class=o>(</span><span class=s>&quot;users.avro&quot;</span><span class=o>);</span>
<span class=n>DatumWriter</span><span class=o>&lt;</span><span class=n>GenericRecord</span><span class=o>&gt;</span> <span class=n>datumWriter</span> <span class=o>=</span> 
    <span class=k>new</span> <span class=n>GenericDatumWriter</span><span class=o>&lt;</span><span class=n>GenericRecord</span><span class=o>&gt;(</span><span class=n>schema</span><span class=o>);</span>
<span class=n>DataFileWriter</span><span class=o>&lt;</span><span class=n>GenericRecord</span><span class=o>&gt;</span> <span class=n>dataFileWriter</span> <span class=o>=</span> 
    <span class=k>new</span> <span class=n>DataFileWriter</span><span class=o>&lt;</span><span class=n>GenericRecord</span><span class=o>&gt;(</span><span class=n>datumWriter</span><span class=o>);</span>
<span class=n>dataFileWriter</span><span class=o>.</span><span class=na>create</span><span class=o>(</span><span class=n>schema</span><span class=o>,</span> <span class=n>file</span><span class=o>);</span>
<span class=n>dataFileWriter</span><span class=o>.</span><span class=na>append</span><span class=o>(</span><span class=n>user1</span><span class=o>);</span>
<span class=n>dataFileWriter</span><span class=o>.</span><span class=na>append</span><span class=o>(</span><span class=n>user2</span><span class=o>);</span>
<span class=n>dataFileWriter</span><span class=o>.</span><span class=na>close</span><span class=o>();</span>
</pre></div></p>
<p>We create a <C>DatumWriter</C>, which converts Java objects into an in-memory serialized format. <C>GenericDatumWriter</C> requires the schema both to determine how to write the <C>GenericRecords</C> and to verify that all non-nullable fields are present.</p>
<p>We also create a <C>DataFileWriter</C>, which writes the serialized records, as well as the schema, to the file specified in the <C>dataFileWriter.create</C> call. We write our users to the file via calls to the <C>dataFileWriter.append</C> method. When we are done writing, we close the data file.</p>
<p><hh>Deserializing</hh></p>
<p>Finally, we'll deserialize the data file we just created.</p>
<p> <div class=codehilite><pre><span class=c1>// Deserialize users from disk</span>
<span class=n>DatumReader</span><span class=o>&lt;</span><span class=n>GenericRecord</span><span class=o>&gt;</span> <span class=n>datumReader</span> <span class=o>=</span> <span class=k>new</span> <span class=n>GenericDatumReader</span><span class=o>&lt;</span><span class=n>GenericRecord</span><span class=o>&gt;(</span><span class=n>schema</span><span class=o>);</span>
<span class=n>DataFileReader</span><span class=o>&lt;</span><span class=n>GenericRecord</span><span class=o>&gt;</span> <span class=n>dataFileReader</span> <span class=o>=</span> <span class=k>new</span> <span class=n>DataFileReader</span><span class=o>&lt;</span><span class=n>GenericRecord</span><span class=o>&gt;(</span><span class=n>file</span><span class=o>,</span> <span class=n>datumReader</span><span class=o>);</span>
<span class=n>GenericRecord</span> <span class=n>user</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
<span class=k>while</span> <span class=o>(</span><span class=n>dataFileReader</span><span class=o>.</span><span class=na>hasNext</span><span class=o>())</span> <span class=o>{</span>
    <span class=c1>// Reuse user object by passing it to next(). This saves us from</span>
    <span class=c1>// allocating and garbage collecting many objects for files with</span>
    <span class=c1>// many items.</span>
    <span class=n>user</span> <span class=o>=</span> <span class=n>dataFileReader</span><span class=o>.</span><span class=na>next</span><span class=o>(</span><span class=n>user</span><span class=o>);</span>
    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>user</span><span class=o>);</span>
<span class=o>}</span>
</pre></div></p>
<p>This outputs:</p>
<p> <div class=codehilite><pre>{&quot;name&quot;: &quot;Alyssa&quot;, &quot;favorite_number&quot;: 256, &quot;favorite_color&quot;: null}
{&quot;name&quot;: &quot;Ben&quot;, &quot;favorite_number&quot;: 7, &quot;favorite_color&quot;: &quot;red&quot;}
</pre></div></p>
<p>Deserializing is very similar to serializing. We create a <C>GenericDatumReader</C>, analogous to the <C>GenericDatumWriter</C> we used in serialization, which converts in-memory serialized items into <C>GenericRecords</C>. We pass the <C>DatumReader</C> and the previously created File to a <C>DataFileReader</C>, analogous to the <C>DataFileWriter</C>, which reads the data file on disk.</p>
<p>Next, we use the <C>DataFileReader</C> to iterate through the serialized users and print the deserialized object to stdout. Note how we perform the iteration: we create a single <C>GenericRecord</C> object which we store the current deserialized user in, and pass this record object to every call of <C>dataFileReader.next</C>. This is a performance optimization that allows the <C>DataFileReader</C> to reuse the same record object rather than allocating a new <C>GenericRecord</C> for every iteration, which can be very expensive in terms of object allocation and garbage collection if we deserialize a large data file. While this technique is the standard way to iterate through a data file, it's also possible to use <code class="codehilite"><span class="k">for</span> <span class="o">(</span><span class="n">GenericRecord</span> <span class="n">user</span> <span class="o">:</span> <span class="n">dataFileReader</span><span class="o">)</span></code> if performance is not a concern.</p>
<h3 id="sort-order">Sort Order<a class="headerlink" href="#sort-order" title="Permanent link">&para;</a></h3>
<p>Avro defines a sort order for objects. All types except <C>record</C> have preordained rules for their sort order, as described in the Avro specification, that cannot be overridden by the user. For records, however, you can control the sort order by specifying the order attribute for a field. It takes one of three values: <C>ascending</C>(the default), <C>descending</C>(to reverse the order), or <C>ignore</C>(so the field is skipped for comparison purposes)</p>
<p>For example, the following schema (<code class="codehilite">SortedStringPair.avsc</code>) defines an ordering of <C>StringPair</C> records by the right field in descending order. The left field is ignored for the purposes of ordering, but it is still present in the projection:</p>
<p> <div class=codehilite><pre>{
&quot;type&quot;: &quot;record&quot;, 
&quot;name&quot;: &quot;StringPair&quot;,
&quot;doc&quot;: &quot;A pair of strings, sorted by right field descending.&quot;, 
&quot;fields&quot;: [
    {&quot;name&quot;: &quot;left&quot;, &quot;type&quot;: &quot;string&quot;, &quot;order&quot;: &quot;ignore&quot;},
    {&quot;name&quot;: &quot;right&quot;, &quot;type&quot;: &quot;string&quot;, &quot;order&quot;: &quot;descending&quot;} ]
}
</pre></div></p>
<p>Avro implements efficient binary comparisons. That is to say, Avro does not have to deserialize binary data into objects to perform the comparison, because it can instead work directly on the byte streams. Avro provides the comparator for us.</p>
<h3 id="avro-mapreduce">Avro MapReduce<a class="headerlink" href="#avro-mapreduce" title="Permanent link">&para;</a></h3>
<p>Avro provides a number of classes for making it easy to run MapReduce programs on Avro data. </p>
<p>Let’s rework the MapReduce program for finding the maximum temperature for each year in the weather dataset, this time using the Avro MapReduce API. We will represent weather records using the following schema:</p>
<p> <div class=codehilite><pre>{
    &quot;type&quot;: &quot;record&quot;,
    &quot;name&quot;: &quot;WeatherRecord&quot;, 
    &quot;doc&quot;: &quot;A weather reading.&quot;, 
    &quot;fields&quot;: [
        {&quot;name&quot;: &quot;year&quot;, &quot;type&quot;: &quot;int&quot;},
        {&quot;name&quot;: &quot;temperature&quot;, &quot;type&quot;: &quot;int&quot;},
        {&quot;name&quot;: &quot;stationId&quot;, &quot;type&quot;: &quot;string&quot;} ]
}
</pre></div></p>
<p>There are a couple of differences from the regular Hadoop MapReduce API. The first is the use of wrappers around Avro Java types. The second major difference from regular MapReduce is the use of <C>AvroJob</C> for configuring the <C>job</C>. <C>AvroJob</C> is a convenience class for specifying the Avro schemas for the input, map output, and final output data.</p>
<p><details>
<summary>Avro Mapreduce
</summary></p>
<p> <div class=codehilite><pre><span class=c1>//vv AvroGenericMaxTemperature</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>AvroGenericMaxTemperature</span> <span class=kd>extends</span> <span class=n>Configured</span> <span class=kd>implements</span> <span class=n>Tool</span> <span class=o>{</span>

  <span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>Schema</span> <span class=n>SCHEMA</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Schema</span><span class=o>.</span><span class=na>Parser</span><span class=o>().</span><span class=na>parse</span><span class=o>(</span>
      <span class=s>&quot;{&quot;</span> <span class=o>+</span>
      <span class=s>&quot;  \&quot;type\&quot;: \&quot;record\&quot;,&quot;</span> <span class=o>+</span>
      <span class=s>&quot;  \&quot;name\&quot;: \&quot;WeatherRecord\&quot;,&quot;</span> <span class=o>+</span>
      <span class=s>&quot;  \&quot;doc\&quot;: \&quot;A weather reading.\&quot;,&quot;</span> <span class=o>+</span>
      <span class=s>&quot;  \&quot;fields\&quot;: [&quot;</span> <span class=o>+</span>
      <span class=s>&quot;    {\&quot;name\&quot;: \&quot;year\&quot;, \&quot;type\&quot;: \&quot;int\&quot;},&quot;</span> <span class=o>+</span>
      <span class=s>&quot;    {\&quot;name\&quot;: \&quot;temperature\&quot;, \&quot;type\&quot;: \&quot;int\&quot;},&quot;</span> <span class=o>+</span>
      <span class=s>&quot;    {\&quot;name\&quot;: \&quot;stationId\&quot;, \&quot;type\&quot;: \&quot;string\&quot;}&quot;</span> <span class=o>+</span>
      <span class=s>&quot;  ]&quot;</span> <span class=o>+</span>
      <span class=s>&quot;}&quot;</span>
  <span class=o>);</span>

  <span class=kd>public</span> <span class=kd>static</span> <span class=kd>class</span> <span class=nc>MaxTemperatureMapper</span>
      <span class=kd>extends</span> <span class=n>Mapper</span><span class=o>&lt;</span><span class=n>LongWritable</span><span class=o>,</span> <span class=n>Text</span><span class=o>,</span> <span class=n>AvroKey</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;,</span>
            <span class=n>AvroValue</span><span class=o>&lt;</span><span class=n>GenericRecord</span><span class=o>&gt;&gt;</span> <span class=o>{</span>
    <span class=kd>private</span> <span class=n>NcdcRecordParser</span> <span class=n>parser</span> <span class=o>=</span> <span class=k>new</span> <span class=n>NcdcRecordParser</span><span class=o>();</span>
    <span class=kd>private</span> <span class=n>GenericRecord</span> <span class=n>record</span> <span class=o>=</span> <span class=k>new</span> <span class=n>GenericData</span><span class=o>.</span><span class=na>Record</span><span class=o>(</span><span class=n>SCHEMA</span><span class=o>);</span>

    <span class=nd>@Override</span>
    <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>map</span><span class=o>(</span><span class=n>LongWritable</span> <span class=n>key</span><span class=o>,</span> <span class=n>Text</span> <span class=n>value</span><span class=o>,</span> <span class=n>Context</span> <span class=n>context</span><span class=o>)</span>
        <span class=kd>throws</span> <span class=n>IOException</span><span class=o>,</span> <span class=n>InterruptedException</span> <span class=o>{</span>
      <span class=n>parser</span><span class=o>.</span><span class=na>parse</span><span class=o>(</span><span class=n>value</span><span class=o>.</span><span class=na>toString</span><span class=o>());</span>
      <span class=k>if</span> <span class=o>(</span><span class=n>parser</span><span class=o>.</span><span class=na>isValidTemperature</span><span class=o>())</span> <span class=o>{</span>
        <span class=n>record</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&quot;year&quot;</span><span class=o>,</span> <span class=n>parser</span><span class=o>.</span><span class=na>getYearInt</span><span class=o>());</span>
        <span class=n>record</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&quot;temperature&quot;</span><span class=o>,</span> <span class=n>parser</span><span class=o>.</span><span class=na>getAirTemperature</span><span class=o>());</span>
        <span class=n>record</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&quot;stationId&quot;</span><span class=o>,</span> <span class=n>parser</span><span class=o>.</span><span class=na>getStationId</span><span class=o>());</span>
        <span class=n>context</span><span class=o>.</span><span class=na>write</span><span class=o>(</span><span class=k>new</span> <span class=n>AvroKey</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;(</span><span class=n>parser</span><span class=o>.</span><span class=na>getYearInt</span><span class=o>()),</span>
            <span class=k>new</span> <span class=n>AvroValue</span><span class=o>&lt;</span><span class=n>GenericRecord</span><span class=o>&gt;(</span><span class=n>record</span><span class=o>));</span>
      <span class=o>}</span>
    <span class=o>}</span>
  <span class=o>}</span>

  <span class=kd>public</span> <span class=kd>static</span> <span class=kd>class</span> <span class=nc>MaxTemperatureReducer</span>
      <span class=kd>extends</span> <span class=n>Reducer</span><span class=o>&lt;</span><span class=n>AvroKey</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;,</span> <span class=n>AvroValue</span><span class=o>&lt;</span><span class=n>GenericRecord</span><span class=o>&gt;,</span>
            <span class=n>AvroKey</span><span class=o>&lt;</span><span class=n>GenericRecord</span><span class=o>&gt;,</span> <span class=n>NullWritable</span><span class=o>&gt;</span> <span class=o>{</span>

    <span class=nd>@Override</span>
    <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>reduce</span><span class=o>(</span><span class=n>AvroKey</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span> <span class=n>key</span><span class=o>,</span> <span class=n>Iterable</span><span class=o>&lt;</span><span class=n>AvroValue</span><span class=o>&lt;</span><span class=n>GenericRecord</span><span class=o>&gt;&gt;</span>
        <span class=n>values</span><span class=o>,</span> <span class=n>Context</span> <span class=n>context</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>IOException</span><span class=o>,</span> <span class=n>InterruptedException</span> <span class=o>{</span>
      <span class=n>GenericRecord</span> <span class=n>max</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
      <span class=k>for</span> <span class=o>(</span><span class=n>AvroValue</span><span class=o>&lt;</span><span class=n>GenericRecord</span><span class=o>&gt;</span> <span class=n>value</span> <span class=o>:</span> <span class=n>values</span><span class=o>)</span> <span class=o>{</span>
        <span class=n>GenericRecord</span> <span class=n>record</span> <span class=o>=</span> <span class=n>value</span><span class=o>.</span><span class=na>datum</span><span class=o>();</span>
        <span class=k>if</span> <span class=o>(</span><span class=n>max</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>||</span> 
            <span class=o>(</span><span class=n>Integer</span><span class=o>)</span> <span class=n>record</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=s>&quot;temperature&quot;</span><span class=o>)</span> <span class=o>&gt;</span> <span class=o>(</span><span class=n>Integer</span><span class=o>)</span> <span class=n>max</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=s>&quot;temperature&quot;</span><span class=o>))</span> <span class=o>{</span>
          <span class=n>max</span> <span class=o>=</span> <span class=n>newWeatherRecord</span><span class=o>(</span><span class=n>record</span><span class=o>);</span>
        <span class=o>}</span>
      <span class=o>}</span>
      <span class=n>context</span><span class=o>.</span><span class=na>write</span><span class=o>(</span><span class=k>new</span> <span class=n>AvroKey</span><span class=o>(</span><span class=n>max</span><span class=o>),</span> <span class=n>NullWritable</span><span class=o>.</span><span class=na>get</span><span class=o>());</span>
    <span class=o>}</span>

    <span class=kd>private</span> <span class=n>GenericRecord</span> <span class=nf>newWeatherRecord</span><span class=o>(</span><span class=n>GenericRecord</span> <span class=n>value</span><span class=o>)</span> <span class=o>{</span>
      <span class=n>GenericRecord</span> <span class=n>record</span> <span class=o>=</span> <span class=k>new</span> <span class=n>GenericData</span><span class=o>.</span><span class=na>Record</span><span class=o>(</span><span class=n>SCHEMA</span><span class=o>);</span>
      <span class=n>record</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&quot;year&quot;</span><span class=o>,</span> <span class=n>value</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=s>&quot;year&quot;</span><span class=o>));</span>
      <span class=n>record</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&quot;temperature&quot;</span><span class=o>,</span> <span class=n>value</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=s>&quot;temperature&quot;</span><span class=o>));</span>
      <span class=n>record</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&quot;stationId&quot;</span><span class=o>,</span> <span class=n>value</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=s>&quot;stationId&quot;</span><span class=o>));</span>
      <span class=k>return</span> <span class=n>record</span><span class=o>;</span>
    <span class=o>}</span>
  <span class=o>}</span>

  <span class=nd>@Override</span>
  <span class=kd>public</span> <span class=kt>int</span> <span class=nf>run</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
    <span class=k>if</span> <span class=o>(</span><span class=n>args</span><span class=o>.</span><span class=na>length</span> <span class=o>!=</span> <span class=mi>2</span><span class=o>)</span> <span class=o>{</span>
      <span class=n>System</span><span class=o>.</span><span class=na>err</span><span class=o>.</span><span class=na>printf</span><span class=o>(</span><span class=s>&quot;Usage: %s [generic options] &lt;input&gt; &lt;output&gt;\n&quot;</span><span class=o>,</span>
          <span class=n>getClass</span><span class=o>().</span><span class=na>getSimpleName</span><span class=o>());</span>
      <span class=n>ToolRunner</span><span class=o>.</span><span class=na>printGenericCommandUsage</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>err</span><span class=o>);</span>
      <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=o>;</span>
    <span class=o>}</span>

    <span class=n>Job</span> <span class=n>job</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Job</span><span class=o>(</span><span class=n>getConf</span><span class=o>(),</span> <span class=s>&quot;Max temperature&quot;</span><span class=o>);</span>
    <span class=n>job</span><span class=o>.</span><span class=na>setJarByClass</span><span class=o>(</span><span class=n>getClass</span><span class=o>());</span>

    <span class=n>job</span><span class=o>.</span><span class=na>getConfiguration</span><span class=o>().</span><span class=na>setBoolean</span><span class=o>(</span>
        <span class=n>Job</span><span class=o>.</span><span class=na>MAPREDUCE_JOB_USER_CLASSPATH_FIRST</span><span class=o>,</span> <span class=kc>true</span><span class=o>);</span>

    <span class=n>FileInputFormat</span><span class=o>.</span><span class=na>addInputPath</span><span class=o>(</span><span class=n>job</span><span class=o>,</span> <span class=k>new</span> <span class=n>Path</span><span class=o>(</span><span class=n>args</span><span class=o>[</span><span class=mi>0</span><span class=o>]));</span>
    <span class=n>FileOutputFormat</span><span class=o>.</span><span class=na>setOutputPath</span><span class=o>(</span><span class=n>job</span><span class=o>,</span> <span class=k>new</span> <span class=n>Path</span><span class=o>(</span><span class=n>args</span><span class=o>[</span><span class=mi>1</span><span class=o>]));</span>
    <span class=n>AvroJob</span><span class=o>.</span><span class=na>setMapOutputKeySchema</span><span class=o>(</span><span class=n>job</span><span class=o>,</span> <span class=n>Schema</span><span class=o>.</span><span class=na>create</span><span class=o>(</span><span class=n>Schema</span><span class=o>.</span><span class=na>Type</span><span class=o>.</span><span class=na>INT</span><span class=o>));</span>
    <span class=n>AvroJob</span><span class=o>.</span><span class=na>setMapOutputValueSchema</span><span class=o>(</span><span class=n>job</span><span class=o>,</span> <span class=n>SCHEMA</span><span class=o>);</span>
    <span class=n>AvroJob</span><span class=o>.</span><span class=na>setOutputKeySchema</span><span class=o>(</span><span class=n>job</span><span class=o>,</span> <span class=n>SCHEMA</span><span class=o>);</span>

    <span class=n>job</span><span class=o>.</span><span class=na>setInputFormatClass</span><span class=o>(</span><span class=n>TextInputFormat</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
    <span class=n>job</span><span class=o>.</span><span class=na>setOutputFormatClass</span><span class=o>(</span><span class=n>AvroKeyOutputFormat</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>

    <span class=n>job</span><span class=o>.</span><span class=na>setMapperClass</span><span class=o>(</span><span class=n>MaxTemperatureMapper</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
    <span class=n>job</span><span class=o>.</span><span class=na>setReducerClass</span><span class=o>(</span><span class=n>MaxTemperatureReducer</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>

    <span class=k>return</span> <span class=n>job</span><span class=o>.</span><span class=na>waitForCompletion</span><span class=o>(</span><span class=kc>true</span><span class=o>)</span> <span class=o>?</span> <span class=mi>0</span> <span class=o>:</span> <span class=mi>1</span><span class=o>;</span>
  <span class=o>}</span>

  <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
    <span class=kt>int</span> <span class=n>exitCode</span> <span class=o>=</span> <span class=n>ToolRunner</span><span class=o>.</span><span class=na>run</span><span class=o>(</span><span class=k>new</span> <span class=n>AvroGenericMaxTemperature</span><span class=o>(),</span> <span class=n>args</span><span class=o>);</span>
    <span class=n>System</span><span class=o>.</span><span class=na>exit</span><span class=o>(</span><span class=n>exitCode</span><span class=o>);</span>
  <span class=o>}</span>
<span class=o>}</span>
</pre></div></p>
<p></details></p>
<h4 id="sorting-using-avro-mapreduce">Sorting Using Avro MapReduce<a class="headerlink" href="#sorting-using-avro-mapreduce" title="Permanent link">&para;</a></h4>
<p>To sort an Avro datafile, it is simple. The mapper simply emits the input key wrapped in an <C>AvroKey</C> and an <C>AvroValue</C>. The reducer acts as an identity, passing the values through as output keys, which will get written to an Avro datafile.</p>
<p>The sorting happens in the MapReduce shuffle, and the sort function is determined by the Avro schema that is passed to the program. See Chapter 7, section <a href="ch7/#shuffle-and-sort">Shuffle and Sort</a> for details.</p>
<h3 id="useful-resources">Useful resources<a class="headerlink" href="#useful-resources" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="http://avro.apache.org/">Apache Avro project page</a></li>
<li><a href="http://www.cloudera.com/content/cloudera-content/cloudera-docs/CDH5/5.0/CDH5-Installation-Guide/cdh5ig_avro_usage.html">CDH usage page for Avro</a></li>
<li><a href="http://avro.apache.org/docs/current/spec.html">Avro Specification</a></li>
</ul></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../../..",
                shortcuts = {"search": 83, "next": 78, "help": 191, "previous": 80};
        </script>
        <script src="../../../js/base.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
        <script src="../../../extra_javascript/tabhack.js" defer></script>
        <script src="../../../extra_javascript/baidu.js" defer></script>
        <script src="../../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
