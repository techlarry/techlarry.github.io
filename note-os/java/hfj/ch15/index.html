<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Zhenhua Wang">
        <link rel="canonical" href="http://larryim.cc/note-os/java/hfj/ch15/">
        <link rel="shortcut icon" href="../../../img/favicon.ico">
        <title>Chapter 15: Networking and Threads - Zhenhua's Notes</title>
        <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/docco.min.css">
        <link href="../../../extra_css/custom.css" rel="stylesheet">
        <link href="../../../extra_css/custom.js" rel="stylesheet">
        <link href="../../../extra_css/friendly.css" rel="stylesheet">
        <link href="../../../extra_css/theme.css" rel="stylesheet">
        <link href="../../../extra_css/mkdocs/js/lunr-0.5.7.min.js" rel="stylesheet">
        <link href="../../../extra_css/mkdocs/js/mustache.min.js" rel="stylesheet">
        <link href="../../../extra_css/mkdocs/js/require.js" rel="stylesheet">
        <link href="../../../extra_css/mkdocs/js/search.js" rel="stylesheet">
        <link href="../../../extra_css/mkdocs/js/text.js" rel="stylesheet">
        <link href="../../../extra_css/code-tab.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../../..">Zhenhua's Notes</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="../../..">Home</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Algorithm <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../algorithm/">Contents</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">AlgorithmPrinceton</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/">Contents</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/unionfind/">Topic 1: UnionFind</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/stackqueue/">Topic 2: StackQueue</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/sort/">Topic 3: Sort</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/priorityqueue/">Topic 4: PriorityQueues</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/symboltable/">Topic 5: Symbol Tables</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/bst/">Topic 6: Balanced Search Trees</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/hashtable/">Topic 7: Hash Table</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/graph/">Topic 8: Graph</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/mst_shortestpath/">Topic 9: Minimum Spanning Tree and Shortest Path</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/stringsort/">Topic 11: String Sort</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/tries/">Topic 12: Tries</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">AlgorithmStanford</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../algorithm/algorithmStanford/">Contents</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmStanford/dynamicprogramming/">Topic: Dynammic Programming</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmStanford/heap/">Topic: Heap</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmStanford/graph/">Topic: Graph</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmStanford/greedy/">Topic: Greedy Algorithm</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmStanford/hashtable/">Topic: Hash Table</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">CS61B</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../calgorithm/cs61b/index.md">Contents</a>
</li>
            
<li >
    <a href="../../../algorithm/cs61b/Lab1/">Lab1: javac, java, git</a>
</li>
            
<li >
    <a href="../../../algorithm/cs61b/Lab2/">Lab2: Unit Testing with JUnit and IntLists</a>
</li>
            
<li >
    <a href="../../../algorithm/cs61b/Lab3/">Lab3: Unit Testing with JUnit, Debugging</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">OS <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../os/">Contents</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">OSC</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../os/osc/">Contents</a>
</li>
            
<li >
    <a href="../../../os/osc/ch1/">Chapter 1: Introduction </a>
</li>
            
<li >
    <a href="../../../os/osc/ch2/">Chapter 2: Operating System structures</a>
</li>
            
<li >
    <a href="../../../os/osc/ch3/">Chapter 3: Processes</a>
</li>
            
<li >
    <a href="../../../os/osc/ch4/">Chapter 4: Threads and Concurrency</a>
</li>
            
<li >
    <a href="../../../os/osc/ch5/">Chapter 5: CPU Scheduling</a>
</li>
            
<li >
    <a href="../../../os/osc/ch6/">Chapter 6: Synchronization Tools</a>
</li>
            
<li >
    <a href="../../../os/osc/ch7/">Chapter 7: Synchronization Examples</a>
</li>
            
<li >
    <a href="../../../os/osc/ch8/">Chapter 8: Deadlocks</a>
</li>
            
<li >
    <a href="../../../os/osc/ch9/">Chapter 9: Main Memory</a>
</li>
            
<li >
    <a href="../../../os/osc/ch10/">Chapter 10: Virtual Memory</a>
</li>
            
<li >
    <a href="../../../os/osc/ch11/">Chapter 11: Mass-Storage Structure</a>
</li>
            
<li >
    <a href="../../../os/osc/ch13/">Chapter 13: File-System Interfaces</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">CSAPP</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../os/csapp/">Contents</a>
</li>
            
<li >
    <a href="../../../os/csapp/ch1/">Chapter 1: 计算机系统漫游</a>
</li>
            
<li >
    <a href="../../../os/csapp/ch2/">Chapter 2: 信息的表示和处理</a>
</li>
            
<li >
    <a href="../../../os/csapp/ch3/">Chapter 3: 程序的机器级表示</a>
</li>
            
<li >
    <a href="../../../os/csapp/ch4/">Chapter 4: 处理器体系结构</a>
</li>
            
<li >
    <a href="../../../os/csapp/ch5/">Chapter 5: 优化程序性能</a>
</li>
            
<li >
    <a href="../../../os/csapp/ch6/">Chapter 6: 存储器层次结构</a>
</li>
            
<li >
    <a href="../../../os/csapp/ch7/">Chapter 7: 链接</a>
</li>
            
<li >
    <a href="../../../os/csapp/ch8/">Chapter 8: 异常控制流</a>
</li>
            
<li >
    <a href="../../../os/csapp/ch9/">Chapter 9: 虚拟内存</a>
</li>
            
<li >
    <a href="../../../os/csapp/ch10/">Chapter 10: 系统级I/O</a>
</li>
            
<li >
    <a href="../../../os/csapp/ch11/">Chapter 11: 网络编程</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">DataBase <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../database/">Contents</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">MySql</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../database/mysql/">Contents</a>
</li>
            
<li >
    <a href="../../../database/mysql/LearningMySQLandMariaDB/">Chapter Learning MySQL and MariaDB</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Java <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../">Contents</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">HFJ</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../">Contents</a>
</li>
            
<li >
    <a href="../ch1/">Chapter 1: Dive in A Quick Dip</a>
</li>
            
<li >
    <a href="../ch2/">Chapter 2: Classes and Objects</a>
</li>
            
<li >
    <a href="../ch3/">Chapter 3: Primitives and References</a>
</li>
            
<li >
    <a href="../ch4/">Chapter 4: Methods use Instance Variables</a>
</li>
            
<li >
    <a href="../ch5/">Chapter 5: Writing a Program</a>
</li>
            
<li >
    <a href="../ch6/">Chapter 6: Get to Know the Java API</a>
</li>
            
<li >
    <a href="../ch7/">Chapter 7: Inheritance and Polymorphism</a>
</li>
            
<li >
    <a href="../ch8/">Chapter 8: Interfaces and Abstract Classes</a>
</li>
            
<li >
    <a href="../ch9/">Chapter 9: Constructors and Garbage Collection</a>
</li>
            
<li >
    <a href="../ch10/">Chapter 10: Numbers and Statics</a>
</li>
            
<li >
    <a href="../ch11/">Chapter 11: Exception Handling</a>
</li>
            
<li >
    <a href="../ch12/">Chapter 12: Getting GUI</a>
</li>
            
<li >
    <a href="../ch13/">Chapter 13: Using Swing</a>
</li>
            
<li >
    <a href="../ch14/">Chapter 14: Serialization and File I/O</a>
</li>
            
<li class="active">
    <a href="./">Chapter 15: Networking and Threads</a>
</li>
            
<li >
    <a href="../ch16/">Chapter 16: Collections and Generics</a>
</li>
            
<li >
    <a href="../ch17/">Chapter 17: Packages, Jars and Deployment</a>
</li>
            
<li >
    <a href="../ch18/">Chapter 18: Remote deploy with RMI</a>
</li>
            
<li >
    <a href="../Appendix/">Appendix: The Top Ten Topics</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">HFDP</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../hfdp/">Contents</a>
</li>
            
<li >
    <a href="../../hfdp/ch1/">Chapter 1: Strategy Pattern </a>
</li>
            
<li >
    <a href="../../hfdp/ch2/">Chapter 2: Observer Pattern</a>
</li>
            
<li >
    <a href="../../hfdp/ch3/">Chapter 3: Decorator Pattern </a>
</li>
            
<li >
    <a href="../../hfdp/ch4/">Chapter 4: Factory Pattern</a>
</li>
            
<li >
    <a href="../../hfdp/ch5/">Chapter 5: Singleton Pattern</a>
</li>
            
<li >
    <a href="../../hfdp/ch6/">Chapter 6: Command Pattern</a>
</li>
            
<li >
    <a href="../../hfdp/ch7/">Chapter 7: Adapter and Facade Patterns</a>
</li>
            
<li >
    <a href="../../hfdp/ch8/">Chapter 8: Template Method Pattern</a>
</li>
            
<li >
    <a href="../../hfdp/ch9/">Chapter 9: Iterator and Composite Patterns</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">MultiThreading</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../multithreading/">Contents</a>
</li>
            
<li >
    <a href="../../multithreading/pre1/">序章1 Java线程</a>
</li>
            
<li >
    <a href="../../multithreading/pre2/">序章2 多线程程序的评价标准</a>
</li>
            
<li >
    <a href="../../multithreading/ch1/">第1章 Single Threaded Execution模式</a>
</li>
            
<li >
    <a href="../../multithreading/ch1/">第2章 Immutable模式</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">TIJ</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../tij/">Contents</a>
</li>
            
<li >
    <a href="../../tij/ch1/">Chapter 1: Introduction</a>
</li>
            
<li >
    <a href="../../tij/ch2/">Chapter 2: Introduction to Objects</a>
</li>
            
<li >
    <a href="../../tij/ch3/">Chapter 3: Everything is an Object</a>
</li>
            
<li >
    <a href="../../tij/ch4/">Chapter 4: Opertors</a>
</li>
            
<li >
    <a href="../../tij/ch5/">Chapter 5: Controlling Execution</a>
</li>
            
<li >
    <a href="../../tij/ch6/">Chapter 6: Initialization & Cleanup</a>
</li>
            
<li >
    <a href="../../tij/ch7/">Chapter 7: Access Control</a>
</li>
            
<li >
    <a href="../../tij/ch8/">Chapter 8: Reusing Clases</a>
</li>
            
<li >
    <a href="../../tij/ch9/">Chapter 9: Polymorphism</a>
</li>
            
<li >
    <a href="../../tij/ch10/">Chapter 10: Interfaces</a>
</li>
            
<li >
    <a href="../../tij/ch11/">Chapter 11: Inner Classes</a>
</li>
            
<li >
    <a href="../../tij/ch12/">Chapter 12: Holding Your Objects</a>
</li>
            
<li >
    <a href="../../tij/ch13/">Chapter 13: Error Handling with Exceptions</a>
</li>
            
<li >
    <a href="../../tij/ch14/">Chapter 14: Strings</a>
</li>
            
<li >
    <a href="../../tij/ch15/">Chapter 15: Type Information</a>
</li>
            
<li >
    <a href="../../tij/ch16/">Chapter 16: Generics</a>
</li>
            
<li >
    <a href="../../tij/ch17/">Chapter 17: Arrays</a>
</li>
            
<li >
    <a href="../../tij/ch18/">Chapter 18: Containers in Depth</a>
</li>
            
<li >
    <a href="../../tij/ch19/">Chapter 19: I/O</a>
</li>
            
<li >
    <a href="../../tij/ch20/">Chapter 20: Enumerated Types</a>
</li>
            
<li >
    <a href="../../tij/ch21/">Chapter 21: Annotations</a>
</li>
            
<li >
    <a href="../../tij/ch22/">Chapter 22: Concurrency</a>
</li>
            
<li >
    <a href="../../tij/ch23/">Chapter 23: Graphical User Interfaces</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">UJVM</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../ujvm/">Contents</a>
</li>
            
<li >
    <a href="../../ujvm/ch1/">Chapter 1 : 走进Java</a>
</li>
            
<li >
    <a href="../../ujvm/ch2/">Chapter 2 : Java内存区域与内存溢出正常</a>
</li>
            
<li >
    <a href="../../ujvm/ch3/">Chapter 3 : 垃圾收集器与内存分配策略</a>
</li>
            
<li >
    <a href="../../ujvm/ch4/">Chapter 4 : 虚拟机性能监控与故障处理工具</a>
</li>
            
<li >
    <a href="../../ujvm/ch5/">Chapter 5 : 调优案例分析与实战</a>
</li>
            
<li >
    <a href="../../ujvm/ch6/">Chapter 6 : 类文件结构</a>
</li>
            
<li >
    <a href="../../ujvm/ch7/">Chapter 7 : 虚拟机类加载机制</a>
</li>
            
<li >
    <a href="../../ujvm/ch8/">Chapter 8 : 虚拟机字节码执行引擎</a>
</li>
            
<li >
    <a href="../../ujvm/ch9/">Chapter 9 : 类加载及执行子系统的案例与实战</a>
</li>
            
<li >
    <a href="../../ujvm/ch10/">Chapter 10 : 早期(编译期)优化</a>
</li>
            
<li >
    <a href="../../ujvm/ch11/">Chapter 11 : 晚期(运行期)优化</a>
</li>
            
<li >
    <a href="../../ujvm/ch12/">Chapter 12 : Java内存模型与线程</a>
</li>
            
<li >
    <a href="../../ujvm/ch13/">Chapter 13 : 线程安全与锁优化</a>
</li>
            
<li >
    <a href="../../ujvm/AppendixC/">Appendix HotSpot虚拟机主要参数列表</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">BigData <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../bigdata/">Contents</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">HADOOP</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../bigdata/hadoop/">Contents</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch1/">Chapter 1: Meet Hadoop</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch2/">Chapter 2: MapReduce</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch3/">Chapter 3: The Hadoop Distributed FileSystem</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch4/">Chapter 4: YARN</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch5/">Chapter 5: Hadoop I/O</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch6/">Chapter 6: Developing a MapReduce Application</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch7/">Chapter 7: How MapReduce Works</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch8/">Chapter 8: MapReduce Types and Formats</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch9/">Chapter 9: MapReduce Features</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch10/">Chapter 10: Setting Up a Hadoop Cluster</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch11/">Chapter 11: Adminstering Hadoop</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch12/">Chapter 12: Avro</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch13/">Chapter 13: Parquet</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch14/">Chapter 14: Flume</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch15/">Chapter 15: Sqoop</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch16/">Chapter 16: Pig</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch17/">Chapter 17: Hive</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch18/">Chapter 18: Crunch</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch19/">Chapter 19: Spark</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch20/">Chapter 20: HBase</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch21/">Chapter 21: ZooKeeper</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch22/">Chapter 22: Composable Data at Center</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch23/">Chapter 23: Biological Data Science: Saving Lives with Software</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch24/">Chapter 24: Cascading</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Spark</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../bigdata/spark/">Contents</a>
</li>
            
<li >
    <a href="../../../bigdata/spark/ch1/">Chapter 1: Introduction to Data Analysis with Spark</a>
</li>
            
<li >
    <a href="../../../bigdata/spark/ch2/">Chapter 2: Downloading Spark and Getting Started</a>
</li>
            
<li >
    <a href="../../../bigdata/spark/ch3/">Chapter 3: Programming with RDDs</a>
</li>
            
<li >
    <a href="../../../bigdata/spark/ch4/">Chapter 4: Working with Key/Value Pairs</a>
</li>
            
<li >
    <a href="../../../bigdata/spark/ch5/">Chapter 5: Loading and Saving Your Data</a>
</li>
            
<li >
    <a href="../../../bigdata/spark/ch6/">Chapter 6: Advanced Spark Programming</a>
</li>
            
<li >
    <a href="../../../bigdata/spark/ch7/">Chapter 7: Running on a Cluster</a>
</li>
            
<li >
    <a href="../../../bigdata/spark/ch8/">Chapter 8: Tuning and Debugging Spark</a>
</li>
            
<li >
    <a href="../../../bigdata/spark/ch9/">Chapter 9: Spark SQL</a>
</li>
            
<li >
    <a href="../../../bigdata/spark/ch10/">Chapter 10: Spark Streaming</a>
</li>
            
<li >
    <a href="../../../bigdata/spark/ch11/">Chapter 11: Machine Learning with MLlib</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">GDM</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../bigdata/gdm/">Contents</a>
</li>
            
<li >
    <a href="../../../bigdata/gdm/ch1/">Chapter 1: 推荐系统入门</a>
</li>
            
<li >
    <a href="../../../bigdata/gdm/ch2/">Chapter 2: 隐式评价和基于物品的过滤算法</a>
</li>
            
<li >
    <a href="../../../bigdata/gdm/ch3/">Chapter 3: 分类</a>
</li>
            
<li >
    <a href="../../../bigdata/gdm/ch4/">Chapter 4: 进一步探索分类</a>
</li>
            
<li >
    <a href="../../../bigdata/gdm/ch5/">Chapter 5: 概率和朴素贝叶斯</a>
</li>
            
<li >
    <a href="../../../bigdata/gdm/ch6/">Chapter 6: 朴素贝叶斯和文本数据</a>
</li>
            
<li >
    <a href="../../../bigdata/gdm/ch7/">Chapter 7: 聚类</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">MLIA</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../bigdata/mlia/">Contents</a>
</li>
            
<li >
    <a href="../../../bigdata/mlia/ch1/">Chapter 1: 机器学习基础</a>
</li>
            
<li >
    <a href="../../../bigdata/mlia/ch2/">Chapter 2: k-近邻算法</a>
</li>
            
<li >
    <a href="../../../bigdata/mlia/ch3/">Chapter 3: 决策树</a>
</li>
            
<li >
    <a href="../../../bigdata/mlia/ch4/">Chapter 4: 基于概率论的分类方法：朴素贝叶斯</a>
</li>
            
<li >
    <a href="../../../bigdata/mlia/ch5/">Chapter 5: Logistic回归</a>
</li>
            
<li >
    <a href="../../../bigdata/mlia/ch6/">Chapter 6: 支持向量机</a>
</li>
            
<li >
    <a href="../../../bigdata/mlia/ch7/">Chapter 7: 利用AdaBoost元算法提高分类性能</a>
</li>
            
<li >
    <a href="../../../bigdata/mlia/ch8/">Chapter 8: 预测数值型数据：回归</a>
</li>
            
<li >
    <a href="../../../bigdata/mlia/ch9/">Chapter 9: 树回归</a>
</li>
            
<li >
    <a href="../../../bigdata/mlia/ch10/">Chapter 10: 利用Ｋ-均值聚类算法对未标注数据分组</a>
</li>
            
<li >
    <a href="../../../bigdata/mlia/ch11/">Chapter 11: 使用Apriori算法进行关联分析</a>
</li>
            
<li >
    <a href="../../../bigdata/mlia/ch11/">Chapter 12: 使用FP-growth算法来高效发现频繁项集</a>
</li>
            
<li >
    <a href="../../../bigdata/mlia/ch13/">Chapter 13: 利用PCA来简化数据</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Crawler</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../bigdata/crawler/">Contents</a>
</li>
            
<li >
    <a href="../../../bigdata/crawler/ch1/">Chapter 1: 开发环境配置</a>
</li>
            
<li >
    <a href="../../../bigdata/crawler/ch2/">Chapter 2: 爬虫基础</a>
</li>
            
<li >
    <a href="../../../bigdata/crawler/ch3/">Chapter 3: 基本库的使用</a>
</li>
            
<li >
    <a href="../../../bigdata/crawler/ch4/">Chapter 4: 解析库的使用</a>
</li>
            
<li >
    <a href="../../../bigdata/crawler/ch5/">Chapter 5: 数据存储</a>
</li>
            
<li >
    <a href="../../../bigdata/crawler/ch7/">Chapter 7: 动态渲染页面爬取</a>
</li>
            
<li >
    <a href="../../../bigdata/crawler/ch13/">Chapter 13: Scrapy框架的使用</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Projects</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../bigdata/projects/">Contents</a>
</li>
            
<li >
    <a href="../../../bigdata/projects/SparkStreaming实时流处理项目/">SparkStreaming实时流处理</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li >
                                <a href="../../../books/">Books</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>

                     <!--
                            <li >
                                <a rel="next" href="../ch14/">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../ch16/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    -->
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#chapter-15-networking-and-threads">Chapter 15 Networking and Threads</a></li>
        <li class="main "><a href="#1-socket-connections">1 Socket Connections</a></li>
            <li><a href="#make-a-network-socket-connection">Make a Network Socket Connection</a></li>
            <li><a href="#readingwriting-fromto-a-socket">Reading/Writing From/To a Socket</a></li>
            <li><a href="#writing-a-client">Writing a client</a></li>
            <li><a href="#writing-a-simple-server">Writing a Simple Server</a></li>
        <li class="main "><a href="#2-threads">2 Threads</a></li>
            <li><a href="#launching-a-thread">Launching a thread</a></li>
            <li><a href="#runnable-interface">Runnable interface</a></li>
            <li><a href="#thread-scheduler">Thread Scheduler</a></li>
            <li><a href="#lock">Lock</a></li>
        <li class="main "><a href="#3-example-a-simple-chatapp">3 Example: A Simple ChatApp</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h3 id="chapter-15-networking-and-threads"><strong>Chapter 15 Networking and Threads</strong><a class="headerlink" href="#chapter-15-networking-and-threads" title="Permanent link">&para;</a></h3>
<p>All the low-level networking details are taken care of by classes in the <C>java.net</C> library. One of Java's big benefits is that sending and receiving data over a network is just I/O with a slightly different connection stream at the end of the chain.</p>
<h3 id="1-socket-connections">1 Socket Connections<a class="headerlink" href="#1-socket-connections" title="Permanent link">&para;</a></h3>
<p><img alt="Connect:Send:Receive" src="../figures/Connect:Send:Receive.png" /></p>
<h4 id="make-a-network-socket-connection">Make a Network Socket Connection<a class="headerlink" href="#make-a-network-socket-connection" title="Permanent link">&para;</a></h4>
<p>To connect to another machine, We need a <C>Socket</C> connection. A <C>Socket</C> (<C>java.net.Socket</C> is an object that represents a network connection between two machines. A connection is a <em>relationship</em> between two machines, where two pieces of software know about each other.</p>
<p>To make a Socket connection, you need to know two things about the server: who it is, and which port it’s running on. In other words, <strong>IP address</strong> and <strong>TCP port number</strong>.</p>
<p> <div class=codehilite><pre><span class=c1>// 196.164.1.103 is the IP address for the sever</span>
<span class=c1>// 5000 is TCP port number</span>
<span class=n>Socket</span> <span class=n>chatSocket</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Socket</span><span class=o>(</span><span class=s>&quot;196.164.1.103&quot;</span><span class=o>,</span> <span class=mi>3000</span><span class=o>);</span>
</pre></div></p>
<p><strong>A TCP port is just a 16-bit number that identifies a specific program on the server</strong>.</p>
<p>The TCP port numbers from 0 to 1023 are reserved for well-known services. Don’t use them for your own server programs!</p>
<p>Well-known TCP port numbers for common server applications:</p>
<p><img alt="well-known TCP port numbers for common server applications" src="../figures/TCPPortNumber.png" /></p>
<h4 id="readingwriting-fromto-a-socket">Reading/Writing From/To a Socket<a class="headerlink" href="#readingwriting-fromto-a-socket" title="Permanent link">&para;</a></h4>
<p><strong>To read data from a <C>Socket</C>, use a <C>BufferedReader</C></strong>.</p>
<p>To communicate over a <C>Socket</C> connection, you use regular I/O streams. One of the coolest features in Java is that the most of you I/O work won't care what you high-level chain stream is actually connected to.</p>
<ul>
<li>Make a <C>Socket</C> connection to the server<ul>
<li><code class="codehilite"><span class="n">Socket</span> <span class="n">chatSocket</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Socket</span><span class="o">(</span><span class="s">&quot;127.0.0.1&quot;</span><span class="o">,</span> <span class="mi">3000</span><span class="o">);</span></code></li>
</ul>
</li>
<li>Make an <C>InputStreamReader</C> chained to the <C>Socket</C>’s low-level (connection) input stream<ul>
<li><code class="codehilite"><span class="n">InputStreamReader</span> <span class="n">stream</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">chatSocket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">());</span></code></li>
</ul>
</li>
<li>Make a <C>BufferedReader</C> and read!<ul>
<li><code class="codehilite"><span class="n">BufferedReader</span> <span class="n">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="n">stream</span><span class="o">);</span> <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span></code> </li>
</ul>
</li>
</ul>
<p><img alt="read data from a Socket" src="../figures/READFROMSOCKETS.png" /></p>
<p><strong>To write data to a Socket, use a <C>PrintWriter</C></strong></p>
<ul>
<li>Make a <C>Socket</C> connection to the server<ul>
<li><code class="codehilite">::Java Socket chatSocket = new Socket(&quot;127.0.0.1&quot;, 5000);</code></li>
</ul>
</li>
<li>Make an <C>PrintWriter</C> chained to the <C>Socket</C>’s low-level (connection) input stream<ul>
<li><code class="codehilite"><span class="n">PrintWriter</span> <span class="n">writer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PrintWriter</span><span class="o">(</span><span class="n">chatSocket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">());</span></code></li>
</ul>
</li>
<li>Write (print) Something!<ul>
<li><code class="codehilite"><span class="n">writer</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;message to send); writer.print(&quot;</span><span class="n">another</span> <span class="n">message</span><span class="err">&quot;</span><span class="o">);</span></code> </li>
</ul>
</li>
</ul>
<p><img alt="WRITETOSOCKETS" src="../figures/WRITETOSOCKETS.png" /></p>
<h4 id="writing-a-client">Writing a client<a class="headerlink" href="#writing-a-client" title="Permanent link">&para;</a></h4>
<ul>
<li>Client connects to the server and gets an input stream from it<ul>
<li><code class="codehilite"><span class="n">Socket</span> <span class="n">socket</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Socket</span><span class="o">(</span><span class="s">&quot;127.0.0.1&quot;</span><span class="o">,</span> <span class="mi">3000</span><span class="o">)</span></code></li>
<li><code class="codehilite"><span class="n">InputStreamReader</span> <span class="n">streamReader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">socket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">());</span></code></li>
<li><code class="codehilite"><span class="n">BufferedReader</span> <span class="n">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="n">streamReader</span><span class="o">)</span></code></li>
</ul>
</li>
<li>Client reads a message from the server<ul>
<li><code class="codehilite"><span class="n">message</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span></code> </li>
</ul>
</li>
</ul>
<p>A simple demo program, which reads <code class="codehilite">index.html</code> from my personal blog "larryim.cc", is illustrated below. The format of HTTP Request is discussed in <a href="../csapp/ch11.md/#5-web">CSAPP</a>.</p>
<p> <div class=codehilite><pre><span class=kn>import</span> <span class=nn>java.io.BufferedReader</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.io.InputStreamReader</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.io.PrintWriter</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.net.Socket</span><span class=o>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>MyBlog</span> <span class=o>{</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>http_request</span><span class=o>(){</span>
        <span class=k>try</span><span class=o>{</span>
            <span class=n>Socket</span> <span class=n>s</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Socket</span><span class=o>(</span><span class=s>&quot;192.30.252.153&quot;</span><span class=o>,</span> <span class=mi>80</span><span class=o>);</span>
            <span class=n>InputStreamReader</span> <span class=n>streamReader</span> <span class=o>=</span> <span class=k>new</span> <span class=n>InputStreamReader</span><span class=o>(</span><span class=n>s</span><span class=o>.</span><span class=na>getInputStream</span><span class=o>());</span>
            <span class=n>BufferedReader</span> <span class=n>br</span> <span class=o>=</span> <span class=k>new</span> <span class=n>BufferedReader</span><span class=o>(</span><span class=n>streamReader</span><span class=o>);</span>

            <span class=c1>//注意换行符是\r\n</span>
            <span class=n>writer</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&quot;GET /index.html HTTP/1.0 \r\n Host: larryim.cc  \r\n   \r\n &quot;</span><span class=o>);</span>

            <span class=n>String</span> <span class=n>line</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>

            <span class=k>while</span> <span class=o>((</span><span class=n>line</span><span class=o>=</span> <span class=n>br</span><span class=o>.</span><span class=na>readLine</span><span class=o>())!=</span> <span class=kc>null</span><span class=o>){</span>
                <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>line</span><span class=o>);</span>
            <span class=o>}</span>
            <span class=n>br</span><span class=o>.</span><span class=na>close</span><span class=o>();</span>
        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>Exception</span> <span class=n>ex</span><span class=o>){</span>
            <span class=n>ex</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span>
        <span class=o>}</span>
    <span class=o>}</span>

    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>){</span>
        <span class=n>MyBlog</span> <span class=n>client</span> <span class=o>=</span> <span class=k>new</span> <span class=n>MyBlog</span><span class=o>();</span>
        <span class=n>client</span><span class=o>.</span><span class=na>http_request</span><span class=o>();</span>
    <span class=o>}</span>
<span class=o>}</span>
</pre></div></p>
<h4 id="writing-a-simple-server">Writing a Simple Server<a class="headerlink" href="#writing-a-simple-server" title="Permanent link">&para;</a></h4>
<ul>
<li>Server application makes a ServerSocket, on a specific port<ul>
<li><code class="codehilite">ServerSocket serverSock = new ServerSocket(4242);</code></li>
</ul>
</li>
<li>Client makes a Socket connection to the server application<ul>
<li><code class="codehilite">Socket sock = new Socket(“190.165.1.103”, 4242);</code></li>
</ul>
</li>
<li>Server makes a new Socket to communicate with this client<ul>
<li><code class="codehilite">Socket sock = serverSock.accept();</code></li>
</ul>
</li>
</ul>
<h3 id="2-threads">2 Threads<a class="headerlink" href="#2-threads" title="Permanent link">&para;</a></h3>
<p>To make a thread, make a <C>Thread</C>. A <C>Thread</C> is a java class that represents a thread. You'll create an instance of class <C>Thread</C> each time you want to start up a new <em>thread</em> of execution.</p>
<p>A thread is a separate thread of execution. That means a separate stack. Remember, Java is just a process running on your underlying OS. <strong>The JVM switches between the new thread (user thread) and the original main thread, until both threads complete</strong>.</p>
<h4 id="launching-a-thread">Launching a thread<a class="headerlink" href="#launching-a-thread" title="Permanent link">&para;</a></h4>
<ul>
<li>Make a <C>Runnable</C> object (the thread’s job)<ul>
<li><code class="codehilite"><span class="n">Runnable</span> <span class="n">threadJob</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyRunnable</span><span class="o">();</span></code></li>
<li><C>Runnable</C> is an interface you’ll learn about on the next page. You’ll write a class that implements the <C>Runnable</C> interface, and that class is where you’ll define the work that a thread will perform. In other words, the method that will be run from the thread’s new call stack.</li>
</ul>
</li>
<li>Make a <C>Thread object</C>(the worker) and give it a <C>Runnable</C>(the job)<ul>
<li><code class="codehilite"><span class="n">Thread</span> <span class="n">myThread</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">threadJob</span><span class="o">);</span></code></li>
<li>Pass the new <C>Runnable</C> object to the <C>Thread</C> constructor. This tells the new <C>Thread</C> object which method to put on the bottom of the new stack—the <C>Runnable</C>’s <C>run()</C> method.</li>
</ul>
</li>
<li>Start the Thread<ul>
<li><code class="codehilite"><span class="n">myThread</span><span class="o">.</span><span class="na">start</span><span class="o">();</span></code></li>
<li>Nothing happens until you call the <C>Thread</C>’s <C>start()</C> method. That’s when you go from having just a <C>Thread</C> instance to having a new thread of execution. When the new thread starts up, it takes the <C>Runnable</C> object’s <C>run()</C> method and puts it on the bottom of the new thread’s stack.</li>
</ul>
</li>
</ul>
<p><strong><C>Runnable</C> is to a <C>Thread</C> what a job is to a worker</strong>. A <C>Runnable</C> is the job a thread is supposed to run.</p>
<h4 id="runnable-interface">Runnable interface<a class="headerlink" href="#runnable-interface" title="Permanent link">&para;</a></h4>
<p>To make a job for your thread, implement the <C>Runnable</C> interface.</p>
<p> <div class=codehilite><pre><span class=c1>// Runnable is in the java.lang package, so you don&#39;t need to import it.</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>RunThreads</span> <span class=kd>implements</span> <span class=n>Runnable</span> <span class=o>{</span>

    <span class=nd>@Override</span>
    <span class=c1>// Runnable has only one method to implement: public void run() (with no arguments)</span>
    <span class=c1>// This is where you put the JOB the thread is suposed to run.</span>
    <span class=c1>// This is the method that goes at the bottom of the new stack()</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>run</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=o>;</span> <span class=n>i</span><span class=o>&lt;</span><span class=mi>20</span><span class=o>;</span> <span class=n>i</span><span class=o>++){</span>
            <span class=n>String</span> <span class=n>threadName</span> <span class=o>=</span> <span class=n>Thread</span><span class=o>.</span><span class=na>currentThread</span><span class=o>().</span><span class=na>getName</span><span class=o>();</span>
            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>threadName</span> <span class=o>+</span> <span class=s>&quot; is running.&quot;</span><span class=o>);</span>
        <span class=o>}</span>
    <span class=o>}</span>

    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>){</span>
        <span class=n>RunThreads</span> <span class=n>jobs</span> <span class=o>=</span> <span class=k>new</span> <span class=n>RunThreads</span><span class=o>();</span>
        <span class=c1>// Pass the new Runnable instance into the new Thread constructor.</span>
        <span class=c1>// This tells the thread what method to put on the bottom of the new stack.</span>
        <span class=c1>// In other words, the first method that the new thread will run.</span>
        <span class=n>Thread</span> <span class=n>threadA</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Thread</span><span class=o>(</span><span class=n>jobs</span><span class=o>);</span>
        <span class=n>Thread</span> <span class=n>threadB</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Thread</span><span class=o>(</span><span class=n>jobs</span><span class=o>);</span>

        <span class=n>threadA</span><span class=o>.</span><span class=na>setName</span><span class=o>(</span><span class=s>&quot;Thread A&quot;</span><span class=o>);</span>
        <span class=n>threadB</span><span class=o>.</span><span class=na>setName</span><span class=o>(</span><span class=s>&quot;Thread B&quot;</span><span class=o>);</span>

        <span class=c1>// You won&#39;t get a new thread of execution until you call start() on the Thread instance.</span>
        <span class=n>threadA</span><span class=o>.</span><span class=na>start</span><span class=o>();</span>
        <span class=n>threadB</span><span class=o>.</span><span class=na>start</span><span class=o>();</span>

    <span class=o>}</span>
<span class=o>}</span>
</pre></div></p>
<p><strong>The three states of a new thread</strong>:</p>
<p><img alt="TheThreeStatesOfANewThread" src="../figures/TheThreeStatesOfANewThread.png" /></p>
<p>Once the thread becomes runnable, it can move back and forth between runnable, running, and an additional state: temporarily not runnable (also known as 'blocked').</p>
<p>Typically, a thread moves back and forth between runnable and running, as the JVM thread scheduler selects a thread to run and then kicks it back out so another thread gets a chance.</p>
<p><img alt="Typical runnable:running loopS" src="../figures/TypicalRunnableRunningLoopS.png" /></p>
<p>A thread scheduler can move a running thread into a blocked state, for a variety of reasons. See <a href="../ujvm/ch12.md/#_8">Understanding JVM</a>.</p>
<h4 id="thread-scheduler">Thread Scheduler<a class="headerlink" href="#thread-scheduler" title="Permanent link">&para;</a></h4>
<p>The thread scheduler makes all the decisions about who runs and who doesn’t.</p>
<p>Most importantly, there are no guarantees about scheduling! So DO NOT base your program's correctness on the scheduler working in a particular way! You multi-threaded program must work no matter <em>how</em> the thread scheduler behaves.</p>
<p>The thread's <C>sleep()</C> method does come with <em>one</em> guarantee: a sleeping thread will <em>not</em> become the currently-running thread before the length of its sleep time has expired.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Another way of making a thread is to, make a subclass of <C>Thread</C> and override the <C>Thread</C>'s <C>run()</C> method, instead of <C>Runnable</C>  implementation. However, it's rarely a good idea - not a good OO design.</p>
</div>
<h4 id="lock">Lock<a class="headerlink" href="#lock" title="Permanent link">&para;</a></h4>
<p>The lock works like this:</p>
<p><img alt="lock" src="../figures/lock.png" /></p>
<p>Use the <C>synchronized</C> keyword to modify a method so that only one thread at a time can access it. The <C>synchronized</C> keyword means that a thread needs a key in order to access the synchronized code.</p>
<p>Every Java object has a lock. A lock has only one key. Most of the time, the lock is unlocked and nobody cares. But if an object has <C>synchronized</C> methods, a thread can enter one of the synchronized methods ONLY if the key for the object’s lock is available. In other words, only if another thread hasn’t already grabbed the one key.</p>
<h3 id="3-example-a-simple-chatapp">3 Example: A Simple ChatApp<a class="headerlink" href="#3-example-a-simple-chatapp" title="Permanent link">&para;</a></h3>
<div class=md-fenced-code-tabs id=tab-tab-group-3><input name=tab-group-3 type=radio id=tab-group-3-0_Java checked=checked class=code-tab data-lang=Java aria-controls=tab-group-3-0_Java-panel role=tab><label for=tab-group-3-0_Java class=code-tab-label data-lang=Java id=tab-group-3-0_Java-label>Client</label><div class=code-tabpanel role=tabpanel data-lang=Java id=tab-group-3-0_Java-panel aria-labelledby=tab-group-3-0_Java-label><div class=codehilite><pre><span class=kn>package</span> <span class=nn>com.headfirstjava.chat</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>javax.swing.*</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.awt.*</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.awt.event.ActionEvent</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.awt.event.ActionListener</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.io.*</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.net.Socket</span><span class=o>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>ChatClient</span> <span class=o>{</span>
    <span class=n>JFrame</span> <span class=n>frame</span><span class=o>;</span>
    <span class=n>String</span> <span class=n>out_message</span><span class=o>;</span>     <span class=c1>// message sent to a server</span>
    <span class=n>ScrollPane</span> <span class=n>scroll</span><span class=o>;</span>
    <span class=n>JTextArea</span> <span class=n>inMessage</span><span class=o>;</span>      <span class=c1>// incoming message from a server</span>
    <span class=n>JTextField</span> <span class=n>outTextField</span><span class=o>;</span>
    <span class=n>JButton</span> <span class=n>button</span><span class=o>;</span>         <span class=c1>// a button to send message</span>
    <span class=n>PrintWriter</span> <span class=n>writer</span><span class=o>;</span>
    <span class=n>BufferedReader</span> <span class=n>reader</span><span class=o>;</span>
    <span class=n>Thread</span> <span class=n>backgroundJob</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Thread</span><span class=o>(</span><span class=k>new</span> <span class=n>ReceiveMessage</span><span class=o>());</span>

    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>establishConnection</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>try</span> <span class=o>{</span>
            <span class=n>Socket</span> <span class=n>socket</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Socket</span><span class=o>(</span><span class=s>&quot;127.0.0.1&quot;</span><span class=o>,</span> <span class=mi>3000</span><span class=o>);</span>
            <span class=n>writer</span> <span class=o>=</span> <span class=k>new</span> <span class=n>PrintWriter</span><span class=o>(</span><span class=n>socket</span><span class=o>.</span><span class=na>getOutputStream</span><span class=o>());</span>
            <span class=n>InputStreamReader</span> <span class=n>streamReader</span> <span class=o>=</span> <span class=k>new</span> <span class=n>InputStreamReader</span><span class=o>(</span><span class=n>socket</span><span class=o>.</span><span class=na>getInputStream</span><span class=o>());</span>
            <span class=n>reader</span> <span class=o>=</span> <span class=k>new</span> <span class=n>BufferedReader</span><span class=o>(</span><span class=n>streamReader</span><span class=o>);</span>
        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>IOException</span> <span class=n>ex</span><span class=o>)</span> <span class=o>{</span>
            <span class=n>ex</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span>
        <span class=o>}</span>
    <span class=o>}</span>

    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>gui</span><span class=o>()</span> <span class=o>{</span>
        <span class=n>frame</span> <span class=o>=</span> <span class=k>new</span> <span class=n>JFrame</span><span class=o>(</span><span class=s>&quot;Ludirously Simple Chat Client&quot;</span><span class=o>);</span>

        <span class=n>inMessage</span> <span class=o>=</span> <span class=k>new</span> <span class=n>JTextArea</span><span class=o>(</span><span class=mi>7</span><span class=o>,</span> <span class=mi>14</span><span class=o>);</span>
        <span class=n>outTextField</span> <span class=o>=</span> <span class=k>new</span> <span class=n>JTextField</span><span class=o>(</span><span class=mi>18</span><span class=o>);</span>
        <span class=n>button</span> <span class=o>=</span> <span class=k>new</span> <span class=n>JButton</span><span class=o>(</span><span class=s>&quot;Send&quot;</span><span class=o>);</span>
        <span class=n>button</span><span class=o>.</span><span class=na>setSize</span><span class=o>(</span><span class=mi>300</span><span class=o>,</span> <span class=mi>40</span><span class=o>);</span>
        <span class=n>scroll</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ScrollPane</span><span class=o>();</span>
        <span class=n>scroll</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>inMessage</span><span class=o>);</span>
        <span class=n>inMessage</span><span class=o>.</span><span class=na>setLineWrap</span><span class=o>(</span><span class=kc>true</span><span class=o>);</span>
        <span class=n>frame</span><span class=o>.</span><span class=na>setDefaultCloseOperation</span><span class=o>(</span><span class=n>JFrame</span><span class=o>.</span><span class=na>EXIT_ON_CLOSE</span><span class=o>);</span>

        <span class=n>frame</span><span class=o>.</span><span class=na>getContentPane</span><span class=o>().</span><span class=na>add</span><span class=o>(</span><span class=n>BorderLayout</span><span class=o>.</span><span class=na>NORTH</span><span class=o>,</span> <span class=n>scroll</span><span class=o>);</span>
        <span class=n>frame</span><span class=o>.</span><span class=na>getContentPane</span><span class=o>().</span><span class=na>add</span><span class=o>(</span><span class=n>BorderLayout</span><span class=o>.</span><span class=na>WEST</span><span class=o>,</span> <span class=n>outTextField</span><span class=o>);</span>
        <span class=n>frame</span><span class=o>.</span><span class=na>getContentPane</span><span class=o>().</span><span class=na>add</span><span class=o>(</span><span class=n>BorderLayout</span><span class=o>.</span><span class=na>EAST</span><span class=o>,</span> <span class=n>button</span><span class=o>);</span>
        <span class=n>button</span><span class=o>.</span><span class=na>addActionListener</span><span class=o>(</span><span class=k>new</span> <span class=n>ButtonListener</span><span class=o>());</span>
        <span class=n>frame</span><span class=o>.</span><span class=na>setSize</span><span class=o>(</span><span class=mi>300</span><span class=o>,</span> <span class=mi>200</span><span class=o>);</span>
        <span class=n>frame</span><span class=o>.</span><span class=na>setVisible</span><span class=o>(</span><span class=kc>true</span><span class=o>);</span>
    <span class=o>}</span>


    <span class=kd>class</span> <span class=nc>ButtonListener</span> <span class=kd>implements</span> <span class=n>ActionListener</span> <span class=o>{</span>

        <span class=nd>@Override</span>
        <span class=kd>public</span> <span class=kt>void</span> <span class=nf>actionPerformed</span><span class=o>(</span><span class=n>ActionEvent</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
            <span class=n>out_message</span> <span class=o>=</span> <span class=n>outTextField</span><span class=o>.</span><span class=na>getText</span><span class=o>();</span>
            <span class=n>outTextField</span><span class=o>.</span><span class=na>setText</span><span class=o>(</span><span class=s>&quot;&quot;</span><span class=o>);</span>
            <span class=n>outTextField</span><span class=o>.</span><span class=na>requestFocus</span><span class=o>();</span>
            <span class=n>writer</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>out_message</span><span class=o>);</span>
            <span class=n>writer</span><span class=o>.</span><span class=na>flush</span><span class=o>();</span>
        <span class=o>}</span>
    <span class=o>}</span>


    <span class=kd>class</span> <span class=nc>ReceiveMessage</span> <span class=kd>implements</span> <span class=n>Runnable</span> <span class=o>{</span>

        <span class=nd>@Override</span>
        <span class=kd>public</span> <span class=kt>void</span> <span class=nf>run</span><span class=o>()</span> <span class=o>{</span>
            <span class=k>while</span> <span class=o>(</span><span class=kc>true</span><span class=o>)</span> <span class=o>{</span>
                <span class=n>String</span> <span class=n>line</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
                <span class=k>try</span> <span class=o>{</span>
                    <span class=k>while</span> <span class=o>((</span><span class=n>line</span> <span class=o>=</span> <span class=n>reader</span><span class=o>.</span><span class=na>readLine</span><span class=o>())!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
                        <span class=n>inMessage</span><span class=o>.</span><span class=na>append</span><span class=o>(</span><span class=n>line</span><span class=o>);</span>
                    <span class=o>}</span>
                <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>IOException</span> <span class=n>ex</span><span class=o>)</span> <span class=o>{</span>
                    <span class=n>ex</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span>
                <span class=o>}</span>
            <span class=o>}</span><span class=c1>// end while</span>
        <span class=o>}</span> <span class=c1>// end run</span>
    <span class=o>}</span> <span class=c1>// end class</span>

    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>start</span><span class=o>()</span> <span class=o>{</span>
        <span class=n>gui</span><span class=o>();</span>
        <span class=n>establishConnection</span><span class=o>();</span>
        <span class=n>backgroundJob</span><span class=o>.</span><span class=na>start</span><span class=o>();</span>


    <span class=o>}</span>

    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>){</span>
        <span class=n>ChatClient</span> <span class=n>client</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ChatClient</span><span class=o>();</span>
        <span class=n>client</span><span class=o>.</span><span class=na>start</span><span class=o>();</span>
    <span class=o>}</span>


<span class=o>}</span>
</pre></div></div><input name=tab-group-3 type=radio id=tab-group-3-1_Java class=code-tab data-lang=Java aria-controls=tab-group-3-1_Java-panel role=tab><label for=tab-group-3-1_Java class=code-tab-label data-lang=Java id=tab-group-3-1_Java-label>Server</label><div class=code-tabpanel role=tabpanel data-lang=Java id=tab-group-3-1_Java-panel aria-labelledby=tab-group-3-1_Java-label><div class=codehilite><pre><span class=kn>package</span> <span class=nn>com.headfirstjava.chat</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>java.io.*</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.net.*</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>


<span class=kd>public</span> <span class=kd>class</span> <span class=nc>ChatServer</span>
<span class=o>{</span>
    <span class=n>ArrayList</span> <span class=n>clientOutputStreams</span><span class=o>;</span>

    <span class=kd>public</span> <span class=kd>class</span> <span class=nc>ClientHandler</span> <span class=kd>implements</span> <span class=n>Runnable</span> <span class=o>{</span>
        <span class=n>BufferedReader</span> <span class=n>reader</span><span class=o>;</span>
        <span class=n>Socket</span> <span class=n>sock</span><span class=o>;</span>

        <span class=kd>public</span> <span class=nf>ClientHandler</span><span class=o>(</span><span class=n>Socket</span> <span class=n>clientSocket</span><span class=o>)</span> <span class=o>{</span>
            <span class=k>try</span> <span class=o>{</span>
                <span class=n>sock</span> <span class=o>=</span> <span class=n>clientSocket</span><span class=o>;</span>
                <span class=n>InputStreamReader</span> <span class=n>isReader</span> <span class=o>=</span> <span class=k>new</span> <span class=n>InputStreamReader</span><span class=o>(</span><span class=n>sock</span><span class=o>.</span><span class=na>getInputStream</span><span class=o>());</span>
                <span class=n>reader</span> <span class=o>=</span> <span class=k>new</span> <span class=n>BufferedReader</span><span class=o>(</span><span class=n>isReader</span><span class=o>);</span>

            <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>Exception</span> <span class=n>ex</span><span class=o>)</span> <span class=o>{</span> <span class=n>ex</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span> <span class=o>}</span>
        <span class=o>}</span>

        <span class=kd>public</span> <span class=kt>void</span> <span class=nf>run</span><span class=o>()</span> <span class=o>{</span>
            <span class=n>String</span> <span class=n>message</span><span class=o>;</span>
            <span class=k>try</span> <span class=o>{</span>
                <span class=k>while</span> <span class=o>((</span><span class=n>message</span> <span class=o>=</span> <span class=n>reader</span><span class=o>.</span><span class=na>readLine</span><span class=o>())</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
                    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&quot;read &quot;</span> <span class=o>+</span> <span class=n>message</span><span class=o>);</span>
                    <span class=n>tellEveryone</span><span class=o>(</span><span class=n>message</span><span class=o>);</span>
                <span class=o>}</span>
            <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>Exception</span> <span class=n>ex</span><span class=o>)</span> <span class=o>{</span> <span class=n>ex</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span> <span class=o>}</span>
        <span class=o>}</span>
    <span class=o>}</span>

    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>new</span> <span class=n>ChatServer</span><span class=o>().</span><span class=na>go</span><span class=o>();</span>
    <span class=o>}</span>

    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>go</span><span class=o>()</span> <span class=o>{</span>
        <span class=n>clientOutputStreams</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>();</span>
        <span class=k>try</span> <span class=o>{</span>
            <span class=n>ServerSocket</span> <span class=n>serverSock</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ServerSocket</span><span class=o>(</span><span class=mi>3000</span><span class=o>);</span>
            <span class=k>while</span><span class=o>(</span><span class=kc>true</span><span class=o>)</span> <span class=o>{</span>
                <span class=n>Socket</span> <span class=n>clientSocket</span> <span class=o>=</span> <span class=n>serverSock</span><span class=o>.</span><span class=na>accept</span><span class=o>();</span>
                <span class=n>PrintWriter</span> <span class=n>writer</span> <span class=o>=</span> <span class=k>new</span> <span class=n>PrintWriter</span><span class=o>(</span><span class=n>clientSocket</span><span class=o>.</span><span class=na>getOutputStream</span><span class=o>());</span>
                <span class=n>clientOutputStreams</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>writer</span><span class=o>);</span>

                <span class=n>Thread</span> <span class=n>t</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Thread</span><span class=o>(</span><span class=k>new</span> <span class=n>ClientHandler</span><span class=o>(</span><span class=n>clientSocket</span><span class=o>));</span>
                <span class=n>t</span><span class=o>.</span><span class=na>start</span><span class=o>();</span>
                <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&quot;got a connection&quot;</span><span class=o>);</span>
            <span class=o>}</span>
        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>Exception</span> <span class=n>ex</span><span class=o>)</span> <span class=o>{</span> <span class=n>ex</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span> <span class=o>}</span>
    <span class=o>}</span>

    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>tellEveryone</span><span class=o>(</span><span class=n>String</span> <span class=n>message</span><span class=o>)</span> <span class=o>{</span>
        <span class=n>Iterator</span> <span class=n>it</span> <span class=o>=</span> <span class=n>clientOutputStreams</span><span class=o>.</span><span class=na>iterator</span><span class=o>();</span>
        <span class=k>while</span> <span class=o>(</span><span class=n>it</span><span class=o>.</span><span class=na>hasNext</span><span class=o>())</span> <span class=o>{</span>
            <span class=k>try</span> <span class=o>{</span>
                <span class=n>PrintWriter</span> <span class=n>writer</span> <span class=o>=</span> <span class=o>(</span><span class=n>PrintWriter</span><span class=o>)</span> <span class=n>it</span><span class=o>.</span><span class=na>next</span><span class=o>();</span>
                <span class=n>writer</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>message</span><span class=o>);</span>
                <span class=n>writer</span><span class=o>.</span><span class=na>flush</span><span class=o>();</span>
            <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>Exception</span> <span class=n>ex</span><span class=o>)</span> <span class=o>{</span> <span class=n>ex</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span> <span class=o>}</span>
        <span class=o>}</span>
    <span class=o>}</span>
<span class=o>}</span>
</pre></div></div></div></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../../..",
                shortcuts = {"search": 83, "next": 78, "help": 191, "previous": 80};
        </script>
        <script src="../../../js/base.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
        <script src="../../../extra_javascript/tabhack.js" defer></script>
        <script src="../../../extra_javascript/baidu.js" defer></script>
        <script src="../../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
