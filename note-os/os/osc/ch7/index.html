<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Zhenhua Wang">
        <link rel="canonical" href="http://larryim.cc/note/os/osc/ch7/">
        <link rel="shortcut icon" href="../../../img/favicon.ico">
        <title>Chapter 7: Synchronization Examples - Zhenhua's Notes</title>
        <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/docco.min.css">
        <link href="../../../extra_css/custom.css" rel="stylesheet">
        <link href="../../../extra_css/custom.js" rel="stylesheet">
        <link href="../../../extra_css/friendly.css" rel="stylesheet">
        <link href="../../../extra_css/theme.css" rel="stylesheet">
        <link href="../../../extra_css/mkdocs/js/lunr-0.5.7.min.js" rel="stylesheet">
        <link href="../../../extra_css/mkdocs/js/mustache.min.js" rel="stylesheet">
        <link href="../../../extra_css/mkdocs/js/require.js" rel="stylesheet">
        <link href="../../../extra_css/mkdocs/js/search.js" rel="stylesheet">
        <link href="../../../extra_css/mkdocs/js/text.js" rel="stylesheet">
        <link href="../../../extra_css/code-tab.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../../..">Zhenhua's Notes</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="../../..">Home</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Algorithm <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../algorithm/">Contents</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">AlgorithmPrinceton</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/">Contents</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/unionfind/">Topic 1: UnionFind</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/stackqueue/">Topic 2: StackQueue</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/sort/">Topic 3: Sort</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/priorityqueue/">Topic 4: PriorityQueues</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/symboltable/">Topic 5: Symbol Tables</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/bst/">Topic 6: Balanced Search Trees</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/hashtable/">Topic 7: Hash Table</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/graph/">Topic 8: Graph</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmPrinceton/mst_shortestpath/">Topic 9: Minimum Spanning Tree and Shortest Path</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">AlgorithmStanford</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../algorithm/algorithmStanford/">Contents</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmStanford/dynamicprogramming/">Topic: Dynammic Programming</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmStanford/heap/">Topic: Heap</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmStanford/graph/">Topic: Graph</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmStanford/greedy/">Topic: Greedy Algorithm</a>
</li>
            
<li >
    <a href="../../../algorithm/algorithmStanford/hashtable/">Topic: Hash Table</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">CS61B</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../calgorithm/s61b/index.md">Contents</a>
</li>
            
<li >
    <a href="../../../algorithm/cs61b/Lab1/">Lab1: javac, java, git</a>
</li>
            
<li >
    <a href="../../../algorithm/cs61b/Lab2/">Lab2: Unit Testing with JUnit and IntLists</a>
</li>
            
<li >
    <a href="../../../algorithm/cs61b/Lab3/">Lab3: Unit Testing with JUnit, Debugging</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">OS <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../">Contents</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">OSC</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../">Contents</a>
</li>
            
<li >
    <a href="../ch1/">Chapter 1: Introduction </a>
</li>
            
<li >
    <a href="../ch2/">Chapter 2: Operating System structures</a>
</li>
            
<li >
    <a href="../ch3/">Chapter 3: Processes</a>
</li>
            
<li >
    <a href="../ch4/">Chapter 4: Threads and Concurrency</a>
</li>
            
<li >
    <a href="../ch5/">Chapter 5: CPU Scheduling</a>
</li>
            
<li >
    <a href="../ch6/">Chapter 6: Synchronization Tools</a>
</li>
            
<li class="active">
    <a href="./">Chapter 7: Synchronization Examples</a>
</li>
            
<li >
    <a href="../ch8/">Chapter 8: Deadlocks</a>
</li>
            
<li >
    <a href="../ch9/">Chapter 9: Main Memory</a>
</li>
            
<li >
    <a href="../ch10/">Chapter 10: Virtual Memory</a>
</li>
            
<li >
    <a href="../ch11/">Chapter 11: Mass-Storage Structure</a>
</li>
            
<li >
    <a href="../ch13/">Chapter 13: File-System Interfaces</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">CSAPP</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../csapp/">Contents</a>
</li>
            
<li >
    <a href="../../csapp/ch1/">Chapter 1: 计算机系统漫游</a>
</li>
            
<li >
    <a href="../../csapp/ch2/">Chapter 2: 信息的表示和处理</a>
</li>
            
<li >
    <a href="../../csapp/ch3/">Chapter 3: 程序的机器级表示</a>
</li>
            
<li >
    <a href="../../csapp/ch4/">Chapter 4: 处理器体系结构</a>
</li>
            
<li >
    <a href="../../csapp/ch5/">Chapter 5: 优化程序性能</a>
</li>
            
<li >
    <a href="../../csapp/ch6/">Chapter 6: 存储器层次结构</a>
</li>
            
<li >
    <a href="../../csapp/ch7/">Chapter 7: 链接</a>
</li>
            
<li >
    <a href="../../csapp/ch8/">Chapter 8: 异常控制流</a>
</li>
            
<li >
    <a href="../../csapp/ch9/">Chapter 9: 虚拟内存</a>
</li>
            
<li >
    <a href="../../csapp/ch10/">Chapter 10: 系统级I/O</a>
</li>
            
<li >
    <a href="../../../csapp/ch11.md">Chapter 11: 网络编程</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">DataBase <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../database/">Contents</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">MySql</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../database/mysql/">Contents</a>
</li>
            
<li >
    <a href="../../../database/mysql/LearningMySQLandMariaDB/">Chapter Learning MySQL and MariaDB</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Java <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../java/">Contents</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">HFJ</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../java/hfj/">Contents</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch1/">Chapter 1: Dive in A Quick Dip</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch2/">Chapter 2: Classes and Objects</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch3/">Chapter 3: Primitives and References</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch4/">Chapter 4: Methods use Instance Variables</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch5/">Chapter 5: Writing a Program</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch6/">Chapter 6: Get to Know the Java API</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch7/">Chapter 7: Inheritance and Polymorphism</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch8/">Chapter 8: Interfaces and Abstract Classes</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch9/">Chapter 9: Constructors and Garbage Collection</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch10/">Chapter 10: Numbers and Statics</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch11/">Chapter 11: Exception Handling</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch12/">Chapter 12: Getting GUI</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch13/">Chapter 13: Using Swing</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch14/">Chapter 14: Serialization and File I/O</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch15/">Chapter 15: Networking and Threads</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch16/">Chapter 16: Collections and Generics</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch17/">Chapter 17: Packages, Jars and Deployment</a>
</li>
            
<li >
    <a href="../../../java/hfj/ch18/">Chapter 18: Remote deploy with RMI</a>
</li>
            
<li >
    <a href="../../../java/hfj/Appendix/">Appendix: The Top Ten Topics</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">HFDP</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../java/hfdp/">Contents</a>
</li>
            
<li >
    <a href="../../../java/hfdp/ch1/">Chapter 1: Strategy Pattern </a>
</li>
            
<li >
    <a href="../../../java/hfdp/ch2/">Chapter 2: Observer Pattern</a>
</li>
            
<li >
    <a href="../../../java/hfdp/ch3/">Chapter 3: Decorator Pattern </a>
</li>
            
<li >
    <a href="../../../java/hfdp/ch4/">Chapter 4: Factory Pattern</a>
</li>
            
<li >
    <a href="../../../java/hfdp/ch5/">Chapter 5: Singleton Pattern</a>
</li>
            
<li >
    <a href="../../../java/hfdp/ch6/">Chapter 6: Command Pattern</a>
</li>
            
<li >
    <a href="../../../java/hfdp/ch7/">Chapter 7: Adapter and Facade Patterns</a>
</li>
            
<li >
    <a href="../../../java/hfdp/ch8/">Chapter 8: Template Method Pattern</a>
</li>
            
<li >
    <a href="../../../java/hfdp/ch9/">Chapter 9: Iterator and Composite Patterns</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">TIJ</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../java/tij/">Contents</a>
</li>
            
<li >
    <a href="../../../java/tij/ch1/">Chapter 1: Introduction</a>
</li>
            
<li >
    <a href="../../../java/tij/ch2/">Chapter 2: Introduction to Objects</a>
</li>
            
<li >
    <a href="../../../java/tij/ch3/">Chapter 3: Everything is an Object</a>
</li>
            
<li >
    <a href="../../../java/tij/ch4/">Chapter 4: Opertors</a>
</li>
            
<li >
    <a href="../../../java/tij/ch5/">Chapter 5: Controlling Execution</a>
</li>
            
<li >
    <a href="../../../java/tij/ch6/">Chapter 6: Initialization & Cleanup</a>
</li>
            
<li >
    <a href="../../../java/tij/ch7/">Chapter 7: Access Control</a>
</li>
            
<li >
    <a href="../../../java/tij/ch8/">Chapter 8: Reusing Clases</a>
</li>
            
<li >
    <a href="../../../java/tij/ch9/">Chapter 9: Polymorphism</a>
</li>
            
<li >
    <a href="../../../java/tij/ch10/">Chapter 10: Interfaces</a>
</li>
            
<li >
    <a href="../../../java/tij/ch11/">Chapter 11: Inner Classes</a>
</li>
            
<li >
    <a href="../../../java/tij/ch12/">Chapter 12: Holding Your Objects</a>
</li>
            
<li >
    <a href="../../../java/tij/ch13/">Chapter 13: Error Handling with Exceptions</a>
</li>
            
<li >
    <a href="../../../java/tij/ch14/">Chapter 14: Strings</a>
</li>
            
<li >
    <a href="../../../java/tij/ch15/">Chapter 15: Type Information</a>
</li>
            
<li >
    <a href="../../../java/tij/ch16/">Chapter 16: Generics</a>
</li>
            
<li >
    <a href="../../../java/tij/ch17/">Chapter 17: Arrays</a>
</li>
            
<li >
    <a href="../../../java/tij/ch18/">Chapter 18: Containers in Depth</a>
</li>
            
<li >
    <a href="../../../java/tij/ch19/">Chapter 19: I/O</a>
</li>
            
<li >
    <a href="../../../java/tij/ch20/">Chapter 20: Enumerated Types</a>
</li>
            
<li >
    <a href="../../../java/tij/ch21/">Chapter 21: Annotations</a>
</li>
            
<li >
    <a href="../../../java/tij/ch22/">Chapter 22: Concurrency</a>
</li>
            
<li >
    <a href="../../../java/tij/ch23/">Chapter 23: Graphical User Interfaces</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">UJVM</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../java/ujvm/">Contents</a>
</li>
            
<li >
    <a href="../../../java/ujvm/ch1/">Chapter 1 : 走进Java</a>
</li>
            
<li >
    <a href="../../../java/ujvm/ch2/">Chapter 2 : Java内存区域与内存溢出正常</a>
</li>
            
<li >
    <a href="../../../java/ujvm/ch3/">Chapter 3 : 垃圾收集器与内存分配策略</a>
</li>
            
<li >
    <a href="../../../java/ujvm/ch4/">Chapter 4 : 虚拟机性能监控与故障处理工具</a>
</li>
            
<li >
    <a href="../../../java/ujvm/ch5/">Chapter 5 : 调优案例分析与实战</a>
</li>
            
<li >
    <a href="../../../java/ujvm/ch6/">Chapter 6 : 类文件结构</a>
</li>
            
<li >
    <a href="../../../java/ujvm/ch7/">Chapter 7 : 虚拟机类加载机制</a>
</li>
            
<li >
    <a href="../../../java/ujvm/ch8/">Chapter 8 : 虚拟机字节码执行引擎</a>
</li>
            
<li >
    <a href="../../../java/ujvm/ch9/">Chapter 9 : 类加载及执行子系统的案例与实战</a>
</li>
            
<li >
    <a href="../../../java/ujvm/ch10/">Chapter 10 : 早期(编译期)优化</a>
</li>
            
<li >
    <a href="../../../java/ujvm/ch11/">Chapter 11 : 晚期(运行期)优化</a>
</li>
            
<li >
    <a href="../../../java/ujvm/ch12/">Chapter 12 : Java内存模型与线程</a>
</li>
            
<li >
    <a href="../../../java/ujvm/ch13/">Chapter 13 : 线程安全与锁优化</a>
</li>
            
<li >
    <a href="../../../java/ujvm/AppendixC/">Appendix HotSpot虚拟机主要参数列表</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">BigData <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../bigdata/">Contents</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">HADOOP</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../bigdata/hadoop/">Contents</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch1/">Chapter 1: Meet Hadoop</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch2/">Chapter 2: MapReduce</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch3/">Chapter 3: The Hadoop Distributed FileSystem</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch4/">Chapter 4: YARN</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch5/">Chapter 5: Hadoop I/O</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch6/">Chapter 6: Developing a MapReduce Application</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch7/">Chapter 7: How MapReduce Works</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch8/">Chapter 8: MapReduce Types and Formats</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch9/">Chapter 9: MapReduce Features</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch10/">Chapter 10: Setting Up a Hadoop Cluster</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch11/">Chapter 11: Adminstering Hadoop</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch12/">Chapter 12: Avro</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch13/">Chapter 13: Parquet</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch14/">Chapter 14: Flume</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch15/">Chapter 15: Sqoop</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch16/">Chapter 16: Pig</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch17/">Chapter 17: Hive</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch18/">Chapter 18: Crunch</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch19/">Chapter 19: Spark</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch20/">Chapter 20: HBase</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch21/">Chapter 21: ZooKeeper</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch22/">Chapter 22: Composable Data at Center</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch23/">Chapter 23: Biological Data Science: Saving Lives with Software</a>
</li>
            
<li >
    <a href="../../../bigdata/hadoop/ch24/">Chapter 24: Cascading</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Spark</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../bigdata/spark/">Contents</a>
</li>
            
<li >
    <a href="../../../bigdata/spark/ch1/">Chapter 1: Introduction to Data Analysis with Spark</a>
</li>
            
<li >
    <a href="../../../bigdata/spark/ch2/">Chapter 2: Downloading Spark and Getting Started</a>
</li>
            
<li >
    <a href="../../../bigdata/spark/ch3/">Chapter 3: Programming with RDDs</a>
</li>
            
<li >
    <a href="../../../bigdata/spark/ch4/">Chapter 4: Working with Key/Value Pairs</a>
</li>
            
<li >
    <a href="../../../bigdata/spark/ch5/">Chapter 5: Loading and Saving Your Data</a>
</li>
            
<li >
    <a href="../../../bigdata/spark/ch6/">Chapter 6: Advanced Spark Programming</a>
</li>
            
<li >
    <a href="../../../bigdata/spark/ch7/">Chapter 7: Running on a Cluster</a>
</li>
            
<li >
    <a href="../../../bigdata/spark/ch8/">Chapter 8: Tuning and Debugging Spark</a>
</li>
            
<li >
    <a href="../../../bigdata/spark/ch9/">Chapter 9: Spark SQL</a>
</li>
            
<li >
    <a href="../../../bigdata/spark/ch10/">Chapter 10: Spark Streaming</a>
</li>
            
<li >
    <a href="../../../bigdata/spark/ch11/">Chapter 11: Machine Learning with MLlib</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">GDM</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../bigdata/gdm/">Contents</a>
</li>
            
<li >
    <a href="../../../bigdata/gdm/ch1/">Chapter 1: 推荐系统入门</a>
</li>
            
<li >
    <a href="../../../bigdata/gdm/ch2/">Chapter 2: 隐式评价和基于物品的过滤算法</a>
</li>
            
<li >
    <a href="../../../bigdata/gdm/ch3/">Chapter 3: 分类</a>
</li>
            
<li >
    <a href="../../../bigdata/gdm/ch4/">Chapter 4: 进一步探索分类</a>
</li>
            
<li >
    <a href="../../../bigdata/gdm/ch5/">Chapter 5: 概率和朴素贝叶斯</a>
</li>
            
<li >
    <a href="../../../bigdata/gdm/ch6/">Chapter 6: 朴素贝叶斯和文本数据</a>
</li>
            
<li >
    <a href="../../../bigdata/gdm/ch7/">Chapter 7: 聚类</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">MLIA</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../bigdata/mlia/">Contents</a>
</li>
            
<li >
    <a href="../../../bigdata/mlia/ch1/">Chapter 1: 机器学习基础</a>
</li>
            
<li >
    <a href="../../../bigdata/mlia/ch2/">Chapter 2: k-近邻算法</a>
</li>
            
<li >
    <a href="../../../bigdata/mlia/ch3/">Chapter 3: 决策树</a>
</li>
            
<li >
    <a href="../../../bigdata/mlia/ch4/">Chapter 4: 基于概率论的分类方法：朴素贝叶斯</a>
</li>
            
<li >
    <a href="../../../bigdata/mlia/ch5/">Chapter 5: Logistic回归</a>
</li>
            
<li >
    <a href="../../../bigdata/mlia/ch6/">Chapter 6: 支持向量机</a>
</li>
            
<li >
    <a href="../../../bigdata/mlia/ch7/">Chapter 7: 利用AdaBoost元算法提高分类性能</a>
</li>
            
<li >
    <a href="../../../bigdata/mlia/ch8/">Chapter 8: 预测数值型数据：回归</a>
</li>
            
<li >
    <a href="../../../bigdata/mlia/ch9/">Chapter 9: 树回归</a>
</li>
            
<li >
    <a href="../../../bigdata/mlia/ch10/">Chapter 10: 利用Ｋ-均值聚类算法对未标注数据分组</a>
</li>
            
<li >
    <a href="../../../bigdata/mlia/ch11/">Chapter 11: 使用Apriori算法进行关联分析</a>
</li>
            
<li >
    <a href="../../../bigdata/mlia/ch11/">Chapter 12: 使用FP-growth算法来高效发现频繁项集</a>
</li>
            
<li >
    <a href="../../../bigdata/mlia/ch13/">Chapter 13: 利用PCA来简化数据</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Crawler</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../bigdata/crawler/">Contents</a>
</li>
            
<li >
    <a href="../../../bigdata/crawler/ch1/">Chapter 1: 开发环境配置</a>
</li>
            
<li >
    <a href="../../../bigdata/crawler/ch2/">Chapter 2: 爬虫基础</a>
</li>
            
<li >
    <a href="../../../bigdata/crawler/ch3/">Chapter 3: 基本库的使用</a>
</li>
            
<li >
    <a href="../../../bigdata/crawler/ch4/">Chapter 4: 解析库的使用</a>
</li>
            
<li >
    <a href="../../../bigdata/crawler/ch5/">Chapter 5: 数据存储</a>
</li>
            
<li >
    <a href="../../../bigdata/crawler/ch7/">Chapter 7: 动态渲染页面爬取</a>
</li>
            
<li >
    <a href="../../../bigdata/crawler/ch13/">Chapter 13: Scrapy框架的使用</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Projects</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../bigdata/projects/">Contents</a>
</li>
            
<li >
    <a href="../../../bigdata/projects/SparkStreaming实时流处理项目/">SparkStreaming实时流处理</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li >
                                <a href="../../../books/">Books</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>

                     <!--
                            <li >
                                <a rel="next" href="../ch6/">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../ch8/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    -->
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#operating-system-concepts-7-synchronization-examples">Operating System Concepts 7 - Synchronization Examples</a></li>
        <li class="main "><a href="#1-classic-problems-of-synchronization">1 Classic Problems of Synchronization</a></li>
            <li><a href="#the-bounded-buffer-problem">The Bounded Buffer Problem</a></li>
            <li><a href="#the-readerswriters-problem">The Readers–Writers Problem</a></li>
            <li><a href="#the-dining-philosophers-problem">The Dining-Philosophers Problem</a></li>
        <li class="main "><a href="#2-synchronization-within-the-linux-kernel">2 Synchronization within the Linux Kernel</a></li>
            <li><a href="#atomic-integer">Atomic integer</a></li>
            <li><a href="#locks">Locks</a></li>
        <li class="main "><a href="#3-posix-synchronization">3 POSIX Synchronization</a></li>
            <li><a href="#posix-mutex-locks">POSIX Mutex Locks</a></li>
            <li><a href="#posix-spinlocks">POSIX Spinlocks</a></li>
            <li><a href="#posix-semaphores">POSIX Semaphores</a></li>
            <li><a href="#posix-condition-variables">POSIX Condition Variables</a></li>
        <li class="main "><a href="#4-synchronization-in-java">4 Synchronization in Java</a></li>
            <li><a href="#java-monitors">Java Monitors</a></li>
            <li><a href="#reentrant-locks">Reentrant Locks</a></li>
            <li><a href="#semaphores">Semaphores</a></li>
            <li><a href="#condition-variables">Condition Variables</a></li>
            <li><a href="#atomic-variables">Atomic Variables</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h3 id="operating-system-concepts-7-synchronization-examples"><strong>Operating System Concepts 7 - Synchronization Examples</strong><a class="headerlink" href="#operating-system-concepts-7-synchronization-examples" title="Permanent link">&para;</a></h3>
<h3 id="1-classic-problems-of-synchronization">1 Classic Problems of Synchronization<a class="headerlink" href="#1-classic-problems-of-synchronization" title="Permanent link">&para;</a></h3>
<h4 id="the-bounded-buffer-problem">The Bounded Buffer Problem<a class="headerlink" href="#the-bounded-buffer-problem" title="Permanent link">&para;</a></h4>
<p>We consider the producer-consumer problem with <a href="ch3/#5-ipc-in-shared-memory-system">bounded buffer</a>. The producer and consumer processes share the following data structures:</p>
<p> <div class=codehilite><pre><span class=kt>int</span> <span class=n>n</span><span class=p>;</span>
<span class=n>semaphore</span> <span class=n>mutex</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
<span class=n>semaphore</span> <span class=n>empty</span> <span class=o>=</span> <span class=n>n</span><span class=p>;</span>
<span class=n>semaphore</span> <span class=n>full</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</pre></div></p>
<ul>
<li>We assume that the pool consists of <span><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span> buffers, each capable of holding one item.</li>
<li>The <code class="codehilite">mutex</code> binary semaphore provides mutual exclusion for accesses to the buffer pool and is initialized to the value 1.</li>
<li>The <code class="codehilite">empty</code> and <code class="codehilite">full</code> semaphores count the number of empty and full buffers.</li>
</ul>
<p> <div class=codehilite><pre><span class=c1>// The code for the producer process:</span>
<span class=k>while</span> <span class=p>(</span><span class=nb>true</span><span class=p>)</span> <span class=p>{</span>
    <span class=p>.</span> <span class=p>.</span> <span class=p>.</span>
    <span class=cm>/* produce an item in next produced */</span> 
    <span class=p>.</span> <span class=p>.</span> <span class=p>.</span> 
    <span class=n>wait</span><span class=p>(</span><span class=n>empty</span><span class=p>);</span> 
    <span class=n>wait</span><span class=p>(</span><span class=n>mutex</span><span class=p>);</span> 
    <span class=p>.</span> <span class=p>.</span> <span class=p>.</span>
    <span class=cm>/* add next produced to the buffer */</span> 
    <span class=p>.</span> <span class=p>.</span> <span class=p>.</span> 
    <span class=n>signal</span><span class=p>(</span><span class=n>mutex</span><span class=p>);</span> 
    <span class=n>signal</span><span class=p>(</span><span class=n>full</span><span class=p>);</span>
<span class=p>}</span>


<span class=c1>//The code for the consumer process:</span>
<span class=k>while</span> <span class=p>(</span><span class=nb>true</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>wait</span><span class=p>(</span><span class=n>full</span><span class=p>);</span> 
    <span class=n>wait</span><span class=p>(</span><span class=n>mutex</span><span class=p>);</span>
    <span class=p>.</span> <span class=p>.</span> <span class=p>.</span>
    <span class=cm>/* remove an item from buffer to next consumed */</span>
    <span class=p>.</span> <span class=p>.</span> <span class=p>.</span> 
    <span class=n>signal</span><span class=p>(</span><span class=n>mutex</span><span class=p>);</span> 
    <span class=n>signal</span><span class=p>(</span><span class=n>empty</span><span class=p>);</span>
    <span class=p>.</span> <span class=p>.</span> <span class=p>.</span>
    <span class=cm>/* consume the item in next consumed */</span>
    <span class=p>.</span> <span class=p>.</span> <span class=p>.</span>
<span class=p>}</span>
</pre></div></p>
<h4 id="the-readerswriters-problem">The Readers–Writers Problem<a class="headerlink" href="#the-readerswriters-problem" title="Permanent link">&para;</a></h4>
<p>Suppose that a database is to be shared among several concurrent processes. </p>
<ul>
<li>Some of these processes may want only to read the database, whereas others may want to update(that is, read and write) the database.</li>
<li>If two readers access the shared data simultaneously, no adverse effects will result.</li>
<li>If a writer and some other processes (either a reader or a writer) access the database simultaneously, chaos may ensue.</li>
</ul>
<p>Three variables are used: <strong><code class="codehilite">mutex</code></strong>, <strong><code class="codehilite">rw_mutex</code></strong>, <strong><code class="codehilite">readcnt</code></strong> to implement solution.</p>
<p> <div class=codehilite><pre><span class=n>semaphore</span> <span class=n>rw_mutex</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span> 
<span class=n>semaphore</span> <span class=n>mutex</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span> 
<span class=kt>int</span> <span class=n>read</span> <span class=n>count</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</pre></div></p>
<ul>
<li>semaphore <strong><code class="codehilite">mutex</code></strong>:  used to ensure mutual exclusion when <code class="codehilite">readcnt</code> is updated i.e. when any reader enters or exit from the critical section.</li>
<li>semaphore <strong><code class="codehilite">rw_mutex</code></strong>: used by both readers and writers.</li>
<li>int <strong><code class="codehilite">readcnt</code></strong>: the number of processes performing read in the critical section, initially 0.</li>
</ul>
<p>Writer processes:</p>
<ol>
<li>Writer requests the entry to critical section.</li>
<li>If allowed i.e. <code class="codehilite">wait()</code> gives a true value, it enters and performs the write. If not allowed, it keeps on waiting.</li>
<li>It exits the critical section.</li>
</ol>
<p> <div class=codehilite><pre><span class=k>do</span> <span class=p>{</span>
    <span class=c1>// writer requests for critical section</span>
    <span class=n>wait</span><span class=p>(</span><span class=n>rw_mutex</span><span class=p>);</span>  

    <span class=c1>// performs the write</span>

    <span class=c1>// leaves the critical section</span>
    <span class=n>signal</span><span class=p>(</span><span class=n>rw_mutex</span><span class=p>);</span>

<span class=p>}</span> <span class=k>while</span><span class=p>(</span><span class=nb>true</span><span class=p>);</span>
</pre></div></p>
<p>Reader process:</p>
<ol>
<li>Reader requests the entry to critical section.</li>
<li>If allowed:<ul>
<li>It increments the count of number of readers inside the critical section. If this reader is the first reader entering, it locks the <code class="codehilite">rw_mutex</code> semaphore to restrict the entry of writers if any reader is inside.</li>
<li>It then, signals <code class="codehilite">mutex</code> as any other reader is allowed to enter while others are already reading.</li>
<li>After performing reading, it exits the critical section. When exiting, it checks if no more reader is inside, it signals the semaphore <code class="codehilite">rw_mutex</code> as now, writer can enter the critical section.</li>
</ul>
</li>
<li>If not allowed, it keeps on waiting.</li>
</ol>
<p> <div class=codehilite><pre><span class=k>do</span> <span class=p>{</span>
   <span class=c1>// Reader wants to enter the critical section</span>
   <span class=n>wait</span><span class=p>(</span><span class=n>mutex</span><span class=p>);</span>

   <span class=c1>// The number of readers has now increased by 1</span>
   <span class=n>readcnt</span><span class=o>++</span><span class=p>;</span>                          

   <span class=c1>// there is at least one reader in the critical section</span>
   <span class=c1>// this ensure no writer can enter if there is even one reader</span>
   <span class=c1>// thus we give preference to readers here</span>
   <span class=k>if</span> <span class=p>(</span><span class=n>readcnt</span><span class=o>==</span><span class=mi>1</span><span class=p>)</span>     
      <span class=n>wait</span><span class=p>(</span><span class=n>rw_mutex</span><span class=p>);</span>                    

   <span class=c1>// other readers can enter while this current reader is inside </span>

   <span class=c1>// the critical section</span>
   <span class=n>signal</span><span class=p>(</span><span class=n>mutex</span><span class=p>);</span>                   

        <span class=p>...</span>
   <span class=cm>/* current reader performs reading here */</span>
        <span class=p>...</span>

   <span class=n>wait</span><span class=p>(</span><span class=n>mutex</span><span class=p>);</span>   <span class=c1>// a reader wants to leave</span>

   <span class=n>readcnt</span><span class=o>--</span><span class=p>;</span>

   <span class=c1>// that is, no reader is left in the critical section,</span>
   <span class=k>if</span> <span class=p>(</span><span class=n>readcnt</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> 
       <span class=n>signal</span><span class=p>(</span><span class=n>rw_mutex</span><span class=p>);</span>         <span class=c1>// writers can enter</span>

   <span class=n>signal</span><span class=p>(</span><span class=n>mutex</span><span class=p>);</span> <span class=c1>// reader leaves</span>

<span class=p>}</span> <span class=k>while</span><span class=p>(</span><span class=nb>true</span><span class=p>);</span>
</pre></div></p>
<h4 id="the-dining-philosophers-problem">The Dining-Philosophers Problem<a class="headerlink" href="#the-dining-philosophers-problem" title="Permanent link">&para;</a></h4>
<p>The dining-philosophers problem is an example of a large class of concurrency-control problems. It is a simple representation of the need to allocate several resources among several processes in a deadlock-free and starvation-free manner.</p>
<p>Consider five philosophers who spend their lives thinking and eating. </p>
<ul>
<li>The philosophers share a circular table surrounded by five chairs, each belonging to one philosopher. </li>
<li>In the center of the table is a bowl of rice, and the table is laid with five single chopsticks.</li>
<li>When a philosopher thinks, she does not interact with her colleagues.</li>
<li>From time to time, a philosopher gets hungry and tries to pick up the two chopsticks that are closest to her (the chopsticks that are between her and her left and right neighbors). </li>
<li>A philosopher may pick up only one chopstick at a time. Obviously, she cannot pick up a chopstick that is already in the hand of a neighbor.</li>
<li>When a hungry philosopher has both her chopsticks at the same time, she eats without releasing the chopsticks. </li>
<li>When she is finished eating, she puts down both chopsticks and starts thinking again</li>
</ul>
<p><img alt="dining_philosophers" src="../figures/dining_philosophers.png" /></p>
<p><a href="../cpj/ch1.md/#dining-philosophers">Java solution of Dining Philosophers Problem</a></p>
<h3 id="2-synchronization-within-the-linux-kernel">2 Synchronization within the Linux Kernel<a class="headerlink" href="#2-synchronization-within-the-linux-kernel" title="Permanent link">&para;</a></h3>
<p>Linux provides several different mechanisms for synchronization in the kernel. </p>
<p>The synchronization methods discussed here to synchronization within the kernel and are therefore available only to kernel developers.</p>
<h4 id="atomic-integer">Atomic integer<a class="headerlink" href="#atomic-integer" title="Permanent link">&para;</a></h4>
<p>The simplest synchronization technique within the Linux kernel is an atomic integer, which is represented using the <em><a href="https://en.wikipedia.org/wiki/Opaque_data_type">opaque data type</a></em> <code class="codehilite">atomic_t</code>. All math operations using atomic integers are performed without interruption.</p>
<p>Atomic integers are particularly efficient in situations where an integer variable—such as a counter—needs to be updated, since atomic operations do not require the overhead of locking mechanisms:</p>
<p><img alt="various_atomic_operations" src="../figures/various_atomic_operations.png" /></p>
<h4 id="locks">Locks<a class="headerlink" href="#locks" title="Permanent link">&para;</a></h4>
<p>In situations where there are several variables contributing to a possible race condition, more sophisticated locking tools must be used. Mutex locks are available in Linux for protecting critical sections within the kernel. Here, a task must invoke the <code class="codehilite">mutex_lock()</code> function prior to entering a critical section and the<code class="codehilite">mutex_unlock()</code> function after exiting the critical section.</p>
<p>Linux also provides spinlocks and semaphores (as well as reader–writer versions of these two locks) for locking in the kernel. </p>
<p>Both spinlocks and mutex locks in the Linux kernel are <strong><em>nonrecursive</em></strong>, which means that if a thread has acquired one of these locks, it cannot acquire the same lock a second time without first releasing the lock. Otherwise, the second attempt at acquiring the lock will block.</p>
<p>Linux provides two simple system calls — <code class="codehilite">preempt_disable()</code> and <code class="codehilite">preempt_enable()</code> —for disabling and enabling kernel preemption.</p>
<h3 id="3-posix-synchronization">3 POSIX Synchronization<a class="headerlink" href="#3-posix-synchronization" title="Permanent link">&para;</a></h3>
<p>The POSIX API is available for programmers at the user level and is not part of any particular operating-system kernel.</p>
<h4 id="posix-mutex-locks">POSIX Mutex Locks<a class="headerlink" href="#posix-mutex-locks" title="Permanent link">&para;</a></h4>
<p>Pthreads uses the <code class="codehilite">pthread_mutex_t</code> data type for mutex locks.</p>
<ul>
<li>A mutex is created with the pthread <code class="codehilite">mutex_init()</code> function.</li>
<li>The mutex is acquired and released with the pthread <code class="codehilite">mutex_lock()</code> and pthread <code class="codehilite">mutex_unlock()</code> functions.</li>
</ul>
<p> <div class=codehilite><pre><span class=cp>#include</span> <span class=cpf>&lt;pthread.h&gt;</span><span class=cp></span>
<span class=n>pthread_mutex_t</span> <span class=n>mutex</span><span class=p>;</span> 

<span class=cm>/* create and initialize the mutex lock */</span> 
<span class=n>pthread_mutex_init</span><span class=p>(</span><span class=o>&amp;</span><span class=n>mutex</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>);</span>

<span class=cm>/* acquire the mutex lock */</span>
 <span class=n>pthread</span> <span class=nf>mutex_lock</span><span class=p>(</span><span class=o>&amp;</span><span class=n>mutex</span><span class=p>);</span> 

<span class=cm>/* critical section */</span> 

<span class=cm>/* release the mutex lock */</span> 
<span class=n>pthread</span> <span class=nf>mutex_unlock</span><span class=p>(</span><span class=o>&amp;</span><span class=n>mutex</span><span class=p>);</span>
</pre></div></p>
<h4 id="posix-spinlocks">POSIX Spinlocks<a class="headerlink" href="#posix-spinlocks" title="Permanent link">&para;</a></h4>
<p> <div class=codehilite><pre><span class=c1>// 初始化自旋锁： 用来申请使用自旋锁所需要的资源并且将它初始化为非锁定状态</span>
<span class=kt>int</span> <span class=nf>pthread_spin_init</span><span class=p>(</span><span class=n>pthread_spinlock_t</span> <span class=o>*</span><span class=p>,</span> <span class=kt>int</span><span class=p>);</span>
<span class=c1>// 获得一个自旋锁：如果该自旋锁当前没有被其它线程所持有，则调用该函数的线程获得该自旋锁.</span>
<span class=c1>// 否则该函数在获得自旋锁之前不会返回。</span>
<span class=kt>int</span> <span class=nf>pthread_spin_lock</span><span class=p>(</span><span class=n>pthread_spinlock_t</span> <span class=o>*</span><span class=p>);</span>
<span class=c1>//释放指定的自旋锁</span>
<span class=kt>int</span> <span class=nf>pthread_spin_unlock</span><span class=p>(</span><span class=n>pthread_spinlock_t</span> <span class=o>*</span><span class=p>);</span>
<span class=c1>// 销毁一个自旋锁</span>
<span class=kt>int</span> <span class=nf>pthread_spin_destroy</span><span class=p>(</span><span class=n>pthread_spinlock_t</span> <span class=o>*</span><span class=p>);</span>
</pre></div></p>
<h4 id="posix-semaphores">POSIX Semaphores<a class="headerlink" href="#posix-semaphores" title="Permanent link">&para;</a></h4>
<p>Semaphores are not part of the POSIX standard and instead belong to the POSIX SEM extension. POSIX specifies two types of semaphores - <strong>named</strong> and <strong>unnamed</strong> semaphores.</p>
<p>The advantage of named semaphores is that multiple unrelated processes can easily use a common semaphore as a synchronization mechanism by simply referring to the semaphore’s name.</p>
<p>Both Linux and macOS systems provide POSIX named semaphores.</p>
<p> <div class=codehilite><pre><span class=cp>#include</span> <span class=cpf>&lt;semaphore.h&gt;</span><span class=cp></span>
<span class=n>sem_t</span> <span class=o>*</span><span class=n>sem</span><span class=p>;</span>

<span class=cm>/* Create the semaphore and initialize it to 1 * Here, we are naming the semaphore SEM.</span>
<span class=cm>* The O_CREAT flag indicates that the semaphore will be created if it does not already exist.</span>
<span class=cm>* The parameter 0666 indicates that the semaphore has read/write access for other processes.</span>
<span class=cm>* The parameter 1 indicates that the semaphore is initialized to 1.</span>
<span class=cm>*/</span>

<span class=n>sem</span> <span class=o>=</span> <span class=n>sem_open</span><span class=p>(</span><span class=s>&quot;SEM&quot;</span><span class=p>,</span> <span class=n>O_CREAT</span><span class=p>,</span> <span class=mo>0666</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>

<span class=cm>/* acquire the semaphore */</span>
<span class=n>sem_wait</span><span class=p>(</span><span class=n>sem</span><span class=p>);</span>

<span class=cm>/* critical section */</span>

<span class=cm>/* release the semaphore */</span>
<span class=n>sem_post</span><span class=p>(</span><span class=n>sem</span><span class=p>);</span>
</pre></div></p>
<h4 id="posix-condition-variables">POSIX Condition Variables<a class="headerlink" href="#posix-condition-variables" title="Permanent link">&para;</a></h4>
<h3 id="4-synchronization-in-java">4 Synchronization in Java<a class="headerlink" href="#4-synchronization-in-java" title="Permanent link">&para;</a></h3>
<p>The Java language and its API have provided rich support for thread synchronization.</p>
<h4 id="java-monitors">Java Monitors<a class="headerlink" href="#java-monitors" title="Permanent link">&para;</a></h4>
<blockquote>
<p>Entities possessing both locks and wait sets are generally called <strong><em>monitors</em></strong> (although almost every language defines details somewhat differently). Since every <C>Object</C> in Java has a lock and a wait set that is manipulated only by methods wait, notify, notifyAll. Any  <C>Object</C> can be serve as a monitor. <small>[Concurrent Programming in Java 3.2.2 Monitor Mechanics]</small></p>
</blockquote>
<p>Every object in Java has associated it with a single lock. When a method is declared to be <C>synchronized</C>, calling the method requires owning the lock for the object.</p>
<ul>
<li>Invoking a <C>synchronized</C> method requires owning the lock on an object instance. </li>
<li>If the lock is already owned by another thread, the thread calling the <C>synchronized</C> method blocks and is placed in the <strong>entry set</strong> for the object's lock. </li>
<li>The entry set represents the set of threads waiting for the lock to become available.</li>
<li>If the lock is available when a <C>synchronized</C> method is called, the calling thread becomes the owner of the object's lock and can enter the method.</li>
<li>The lock is released when the thread exits the method.</li>
<li>If the entry set for the lock is not empty when the lock is released, the JVM arbitrarily selects a thread from this set to be the owner of the lock.</li>
</ul>
<p>In addition to having a lock, every object also has associated with it a <strong>wait set</strong> consisting of a set of threads.</p>
<ul>
<li>This wait set is initially empty. </li>
<li>When a thread enters a <C>synchronized</C> method, it owns the lock for the object.</li>
<li>However, this thread may determine that it is unable to continue because a certain condition has not been met. (e.g. if the producer calls the <C>insert()</C> method and the buffer is full)</li>
<li>The thread then will release the lock and wait until the condition that will allow it to continue is met.</li>
</ul>
<p>When a thread calls the <C>wait()</C> method, the following happens:</p>
<ol>
<li>The thread releases the lock for the object.</li>
<li>The state of the thread is set to blocked.</li>
<li>The thread is placed in the wait set for the object.</li>
</ol>
<p><img alt="entry-and-wait-set" src="../figures/entry-and-wait-set.png" /></p>
<h4 id="reentrant-locks">Reentrant Locks<a class="headerlink" href="#reentrant-locks" title="Permanent link">&para;</a></h4>
<p>Perhaps the simplest locking mechanism available in the API is the <C>ReentrantLock</C>. A <C>ReentrantLock</C> is owned by a single thread and is used to provide mutually exclusive access to a shared resource. It provides several additional features, such as setting a <em>fairness</em> parameter, which favors granting the lock to the longest-waiting thread.</p>
<p>A thread acquires a <C>ReentrantLock</C> lock by invoking its <C>lock()</C> method. If the lock is available - or if the thread invoking <C>lock()</C> already owns it, <C>lock()</C> assigns the invoking thread lock ownership and return control.</p>
<p> <div class=codehilite><pre><span class=n>Lock</span> <span class=n>key</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ReentrantLock</span><span class=o>();</span>
<span class=n>key</span><span class=o>.</span><span class=na>lock</span><span class=o>();</span> 
<span class=k>try</span> <span class=o>{</span>
    <span class=cm>/* critical section */</span> 
<span class=o>}</span> <span class=k>finally</span> <span class=o>{</span>
    <span class=n>key</span><span class=o>.</span><span class=na>unlock</span><span class=o>();</span> 
<span class=o>}</span>
</pre></div></p>
<h4 id="semaphores">Semaphores<a class="headerlink" href="#semaphores" title="Permanent link">&para;</a></h4>
<p>The Java API also provides a counting semaphore. The constructor for the semaphore appears as</p>
<p> <div class=codehilite><pre><span class=n>Semaphore</span><span class=o>(</span><span class=kt>int</span> <span class=n>value</span><span class=o>);</span>
</pre></div></p>
<p>where <C>value</C> specifies the initial value of the semaphore ( a negative value is allowed). The <C>acquire</C> method throws an <C>InterruptedException</C> if the acquiring thread is interrupted.</p>
<p>The following example illustrates using a semaphore for mutual exclusion:</p>
<p> <div class=codehilite><pre><span class=n>Semaphore</span> <span class=n>sem</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Semaphore</span><span class=o>(</span><span class=mi>1</span><span class=o>);</span>

<span class=k>try</span> <span class=o>{</span> 
    <span class=n>sem</span><span class=o>.</span><span class=na>acquire</span><span class=o>();</span>
     <span class=cm>/* critical section */</span> 
<span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>InterruptedException</span> <span class=n>ex</span><span class=o>)</span> <span class=o>{</span> 
<span class=o>}</span> <span class=k>finally</span> <span class=o>{</span>
    <span class=n>sem</span><span class=o>.</span><span class=na>release</span><span class=o>();</span> 
<span class=o>}</span>
</pre></div></p>
<blockquote>
<p>Class <C>Semaphore</C> is a counting semaphore. Conceptually, a semaphore maintains a set of permits. Each <i>acquire()</i> blocks if necessary until a permit is available, and then takes it. Each <i>release()</i> adds a permit, potentially releasing a blocking acquirer. However, no actual permit objects are used; the <C>Semaphore</C> just keeps a count of the number available and acts accordingly. <small><a href="http://docs.oracle.com/javase/9/docs/api/java/util/concurrent/Semaphore.html">Java DOC - Semaphore</a></small></p>
</blockquote>
<h4 id="condition-variables">Condition Variables<a class="headerlink" href="#condition-variables" title="Permanent link">&para;</a></h4>
<p><strong>Condition variables</strong> provide functionality similar to the <C>wait()</C> and <C>notify()</C> methods. To provide mutual exclusion, a condition variable must be associated with a <C>ReentrantLock</C>.</p>
<p>We create a condition variable by first creating a <C>ReentrantLock</C> and invoking its <C>newCondition()</C> method, which returns a <C>Condition</C> object representing the condition variable for the associated <C>ReentrantLock</C>.</p>
<p> <div class=codehilite><pre><span class=n>Lock</span> <span class=n>lock</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ReentrantLock</span><span class=o>();</span>
<span class=n>Condition</span> <span class=n>condVar</span> <span class=o>=</span> <span class=n>lock</span><span class=o>.</span><span class=na>newCondition</span><span class=o>();</span>
</pre></div></p>
<p>Once the condition variable has been obtained, we can invoke its <code class="codehilite">await()</code> and <code class="codehilite">signal()</code> methods.</p>
<p><strong>Java Solution of Buffered Buffer Using condition variables</strong></p>
<p><a href="http://docs.oracle.com/javase/9/docs/api/java/util/concurrent/locks/Condition.html">JAVA DOC - Interface Condition</a></p>
<p>Suppose we have a bounded buffer which supports <C>put</C> and <C>take</C> methods. If a <C>take</C> is attempted on an empty buffer, then the thread will block until an item becomes available; if a <C>put</C> is attempted on a full buffer, then the thread will block until a space becomes available. We would like to keep waiting <C>put</C> threads and <C>take</C> threads in separate wait-sets so that we can use the optimization of only notifying a single thread at a time when items or spaces become available in the buffer. This can be achieved using two Condition instances.</p>
<p> <div class=codehilite><pre><span class=kd>class</span> <span class=nc>BoundedBuffer</span> <span class=o>{</span>
   <span class=kd>final</span> <span class=n>Lock</span> <span class=n>lock</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ReentrantLock</span><span class=o>();</span>
   <span class=kd>final</span> <span class=n>Condition</span> <span class=n>notFull</span>  <span class=o>=</span> <span class=n>lock</span><span class=o>.</span><span class=na>newCondition</span><span class=o>();</span> 
   <span class=kd>final</span> <span class=n>Condition</span> <span class=n>notEmpty</span> <span class=o>=</span> <span class=n>lock</span><span class=o>.</span><span class=na>newCondition</span><span class=o>();</span> 

   <span class=kd>final</span> <span class=n>Object</span><span class=o>[]</span> <span class=n>items</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Object</span><span class=o>[</span><span class=mi>100</span><span class=o>];</span>
   <span class=kt>int</span> <span class=n>putptr</span><span class=o>,</span> <span class=n>takeptr</span><span class=o>,</span> <span class=n>count</span><span class=o>;</span>

   <span class=kd>public</span> <span class=kt>void</span> <span class=nf>put</span><span class=o>(</span><span class=n>Object</span> <span class=n>x</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>InterruptedException</span> <span class=o>{</span>
     <span class=n>lock</span><span class=o>.</span><span class=na>lock</span><span class=o>();</span>
     <span class=k>try</span> <span class=o>{</span>
       <span class=k>while</span> <span class=o>(</span><span class=n>count</span> <span class=o>==</span> <span class=n>items</span><span class=o>.</span><span class=na>length</span><span class=o>)</span>
         <span class=n>notFull</span><span class=o>.</span><span class=na>await</span><span class=o>();</span>
       <span class=n>items</span><span class=o>[</span><span class=n>putptr</span><span class=o>]</span> <span class=o>=</span> <span class=n>x</span><span class=o>;</span>
       <span class=k>if</span> <span class=o>(++</span><span class=n>putptr</span> <span class=o>==</span> <span class=n>items</span><span class=o>.</span><span class=na>length</span><span class=o>)</span> <span class=n>putptr</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
       <span class=o>++</span><span class=n>count</span><span class=o>;</span>
       <span class=n>notEmpty</span><span class=o>.</span><span class=na>signal</span><span class=o>();</span>
     <span class=o>}</span> <span class=k>finally</span> <span class=o>{</span>
       <span class=n>lock</span><span class=o>.</span><span class=na>unlock</span><span class=o>();</span>
     <span class=o>}</span>
   <span class=o>}</span>

   <span class=kd>public</span> <span class=n>Object</span> <span class=nf>take</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>InterruptedException</span> <span class=o>{</span>
     <span class=n>lock</span><span class=o>.</span><span class=na>lock</span><span class=o>();</span>
     <span class=k>try</span> <span class=o>{</span>
       <span class=k>while</span> <span class=o>(</span><span class=n>count</span> <span class=o>==</span> <span class=mi>0</span><span class=o>)</span>
         <span class=n>notEmpty</span><span class=o>.</span><span class=na>await</span><span class=o>();</span>
       <span class=n>Object</span> <span class=n>x</span> <span class=o>=</span> <span class=n>items</span><span class=o>[</span><span class=n>takeptr</span><span class=o>];</span>
       <span class=k>if</span> <span class=o>(++</span><span class=n>takeptr</span> <span class=o>==</span> <span class=n>items</span><span class=o>.</span><span class=na>length</span><span class=o>)</span> <span class=n>takeptr</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
       <span class=o>--</span><span class=n>count</span><span class=o>;</span>
       <span class=n>notFull</span><span class=o>.</span><span class=na>signal</span><span class=o>();</span>
       <span class=k>return</span> <span class=n>x</span><span class=o>;</span>
     <span class=o>}</span> <span class=k>finally</span> <span class=o>{</span>
       <span class=n>lock</span><span class=o>.</span><span class=na>unlock</span><span class=o>();</span>
     <span class=o>}</span>
   <span class=o>}</span>
<span class=o>}</span>
</pre></div></p>
<h4 id="atomic-variables">Atomic Variables<a class="headerlink" href="#atomic-variables" title="Permanent link">&para;</a></h4>
<p><a href="https://docs.oracle.com/javase/tutorial/essential/concurrency/atomicvars.html">Java Tutorial - Atomic Variables</a></p>
<p>The <C>java.util.concurrent.atomic</C> package defines classes that support atomic operations on single variables:</p>
<ul>
<li><C>AtomicBoolean</C>: A <C>boolean</C> value that may be updated atomically.</li>
<li><C>AtomicInteger</C>: An <C>int</C> value that may be updated atomically</li>
<li><C>AtomicReference</C>: An object reference that may be updated atomically.</li>
</ul>
<p>All classes have <C>get</C> and <C>set</C> methods that works like reads and writes on <C>volatile</C> variables. That is, a <C>set</C> has a happens-before relationship with any subsequent <C>get</C> on the same variable. The atomic <C>compareAndSet</C> method also has these memory consistency features, as do the simple atomic arithmetic methods that apply to integer atomic variables.</p>
<p>Suppose we have a <C>Counter</C> class:</p>
<p> <div class=codehilite><pre><span class=kd>class</span> <span class=nc>Counter</span> <span class=o>{</span>
    <span class=kd>private</span> <span class=kt>int</span> <span class=n>c</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>increment</span><span class=o>()</span> <span class=o>{</span>
        <span class=n>c</span><span class=o>++;</span>
    <span class=o>}</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>decrement</span><span class=o>()</span> <span class=o>{</span>
        <span class=n>c</span><span class=o>--;</span>
    <span class=o>}</span>
    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>value</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>return</span> <span class=n>c</span><span class=o>;</span>
    <span class=o>}</span>
<span class=o>}</span>
</pre></div></p>
<p>One way to keep <C>Counter</C> free from race condition, is to make its methods as <C>synchronized<C> methods. Another way is to replace the <C>int</C> filed with an <C>AtomicInteger</C>:</p>
<p> <div class=codehilite><pre><span class=kn>import</span> <span class=nn>import</span> <span class=nn>java.util.concurrent.atomic.AtomicInteger</span><span class=p>;</span>

<span class=k>class</span> <span class=nc>AtomicCounter</span> <span class=p>{</span>
    <span class=n>private</span> <span class=n>AtomicInteger</span> <span class=n>c</span> <span class=o>=</span> <span class=n>new</span> <span class=n>AtomicInteger</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>

    <span class=n>public</span> <span class=n>void</span> <span class=n>increment</span><span class=p>()</span> <span class=p>{</span>
        <span class=n>c</span><span class=o>.</span><span class=n>incrementAndGet</span><span class=p>();</span>
    <span class=p>}</span>

    <span class=n>public</span> <span class=n>void</span> <span class=n>decrement</span><span class=p>()</span> <span class=p>{</span>
        <span class=n>c</span><span class=o>.</span><span class=n>decrementAndGet</span><span class=p>();</span>
    <span class=p>}</span>

    <span class=n>public</span> <span class=nb>int</span> <span class=n>value</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>c</span><span class=o>.</span><span class=n>get</span><span class=p>();</span>
    <span class=p>}</span>
<span class=p>}</span>
</pre></div></p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../../..",
                shortcuts = {"search": 83, "next": 78, "help": 191, "previous": 80};
        </script>
        <script src="../../../js/base.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
        <script src="../../../extra_javascript/tabhack.js" defer></script>
        <script src="../../../extra_javascript/baidu.js" defer></script>
        <script src="../../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
