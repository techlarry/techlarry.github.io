<!doctype html>
<html class="no-js" lang="en">
  <head>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  Operating System Concepts 4 - Threads & Concurrency - techlarry
  
  </title>
  
  
  <link href="atom.xml" rel="alternate" title="techlarry" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />
    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
  <script src="asset/highlightjs/highlight.pack.js"></script>
  <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script>hljs.initHighlightingOnLoad();</script>
<script type="text/javascript">
  function before_search(){
    var searchVal = 'site:larryim.cc ' + document.getElementById('search_input').value;
    document.getElementById('search_q').value = searchVal;
    return true;
  }
</script>
  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?fdc936c9f5a3b72177541183cdeb8cb3";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
  </script>
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>


  <section class="top-bar-section">
  <div class="row">
      <div style="position: relative;width:100%;"><div style="position: absolute; width:100%;">
        <ul id="main-menu" class="left">
        
        <li id=""><a target="_self" href="index.html">HomePage</a></li>
        
        <li id=""><a target="_self" href="archives.html">Archives</a></li>
        
        <li id=""><a target="_blank" href="wiki">WIKI</a></li>
        
        <li id=""><a target="_self" href="notebook.html">NOTEBOOK</a></li>
        
        <li id=""><a target="_self" href="about.html">About</a></li>
        
        <li id=""><a target="_blank" href="note-os">NOTE-OS</a></li>
        
        </ul>

        <ul class="right" id="search-wrap">
          <li>
<form target="_blank" onsubmit="return before_search();" action="http://google.com/search" method="get">
    <input type="hidden" id="search_q" name="q" value="" />
    <input tabindex="1" type="search" id="search_input"  placeholder="Search"/>
</form>
</li>
          </ul>
      </div></div>
  </div>
  </section>

</nav>

        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; techlarry</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
        
        <li><a target="_self" href="index.html">HomePage</a></li>
        
        <li><a target="_self" href="archives.html">Archives</a></li>
        
        <li><a target="_blank" href="wiki">WIKI</a></li>
        
        <li><a target="_self" href="notebook.html">NOTEBOOK</a></li>
        
        <li><a target="_self" href="about.html">About</a></li>
        
        <li><a target="_blank" href="note-os">NOTE-OS</a></li>
        

    <li><label>Categories</label></li>

        
            <li><a href="Leetcode.html">Leetcode</a></li>
        
            <li><a href="programming_language.html">编程语言</a></li>
        
            <li><a href="data_structure_and_algorithm.html">数据结构和算法</a></li>
        
            <li><a href="Python%E7%89%B9%E6%80%A7.html">Python特性</a></li>
        
            <li><a href="%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0.html">机器学习</a></li>
        
            <li><a href="English.html">English</a></li>
        
            <li><a href="Computer%20System.html">Computer System</a></li>
        
            <li><a href="Deep%20Learning.html">Deep Learning</a></li>
        
            <li><a href="Linux%20%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B.html">Linux 系统编程</a></li>
        
            <li><a href="%E6%95%B0%E6%8D%AE%E5%BA%93.html">数据库</a></li>
        
            <li><a href="Tensorflow.html">Tensorflow</a></li>
        
            <li><a href="Big%20Data.html">Big Data</a></li>
        
            <li><a href="%E6%96%87%E7%8C%AE%E9%98%85%E8%AF%BB.html">文献阅读</a></li>
        
            <li><a href="Tools.html">Tools</a></li>
         

      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>


        <section id="main-content" role="main" class="scroll-container">
        
       

 <script type="text/javascript">
  $(function(){
    $('#menu_item_index').addClass('is_active');
  });
</script>
<div class="row">
  <div class="large-8 medium-8 columns">
      <div class="markdown-body article-wrap">
       <div class="article">
          
          <h1>Operating System Concepts 4 - Threads & Concurrency</h1>
     
        <div class="read-more clearfix">
          <span class="date">2018/2/19</span>

          <span>posted in&nbsp;</span> 
          
              <span class="posted-in"><a href='Computer%20System.html'>Computer System</a></span>
           
         
          <span class="comments">
            

            
          </span>

        </div>
      </div><!-- article -->

      <div class="article-content">
      <ul>
<li>
<a href="#toc_0">1 Overview</a>
<ul>
<li>
<a href="#toc_1">1.1 Motivation</a>
</li>
<li>
<a href="#toc_2">1.2 Benefits</a>
</li>
</ul>
</li>
<li>
<a href="#toc_3">2 Multicore Programming</a>
<ul>
<li>
<a href="#toc_4">2.1 Programming Challenges</a>
</li>
<li>
<a href="#toc_5">2.2 Types of Parallelism</a>
</li>
</ul>
</li>
<li>
<a href="#toc_6">3 Multithreading Models</a>
<ul>
<li>
<a href="#toc_7">3.1 Many-to-One Model</a>
</li>
<li>
<a href="#toc_8">3.2 One-to-One Model</a>
</li>
<li>
<a href="#toc_9">3.3 Many-to-Many Model</a>
</li>
<li>
<a href="#toc_10">3.4 User/Kernel-Level threads</a>
</li>
</ul>
</li>
<li>
<a href="#toc_11">4 Thread Libraries</a>
</li>
<li>
<a href="#toc_12">5 Implicit threading</a>
<ul>
<li>
<a href="#toc_13">5.1 Thread Pools</a>
</li>
<li>
<a href="#toc_14">5.4 Grand Central Dispatch</a>
</li>
</ul>
</li>
<li>
<a href="#toc_15">6 Threading Issues</a>
<ul>
<li>
<a href="#toc_16">6.1 Light Weight Process</a>
</li>
<li>
<a href="#toc_17">6.2 Scheduler activation</a>
</li>
</ul>
</li>
</ul>


<h2 id="toc_0">1 Overview</h2>

<p>A <strong>thread</strong> is a basic unit of CPU utilization; it comprises a thread ID, a program counter, a register set, and a stack.</p>

<p>线程是一个CPU利用的基本单元，它由线程ID，程序计数器、寄存器集合和栈组成。</p>

<p>A traditional process has a single thread of control. If a process has <strong>multiple threads of control</strong>, it can perform more than one task at a time. <br/>
一个传统的进程只有单个控制线程，如果进程有多个控制线程，那么它能一次处理多个任务。</p>

<p>The figure below illustrates the difference between a traditional <strong>single-threaded</strong> process and a <strong>multithreaded</strong> process.</p>

<p><img src="media/15319932561412/single%20threaded%20and%20multithreaded%20processes.png" alt="single threaded and multithreaded processes"/></p>

<h3 id="toc_1">1.1 Motivation</h3>

<p>Process creation is <strong>time consuming</strong> and <strong>resource intensive</strong>. It is generally more efficient to use one process that contains multiple threads.</p>

<h3 id="toc_2">1.2 Benefits</h3>

<p>The benefits of  multithreaded programming can be broken down into four major categories:</p>

<ol>
<li><p><strong>Responsiveness</strong></p>
<ul>
<li>It allows a program to continue running even if part of it is blocked or is performing a lengthy operation, thereby increasing responsiveness to the user.</li>
<li>响应度高：即使程序部分阻塞或执行较冗长操作，该程序仍能继续执行，从而增加了对用户的相应程度。</li>
</ul></li>
<li><p><strong>Resource sharing</strong></p>
<ul>
<li>Processes can share resources only through techniques such as shared memory and message. Such techniques must be explicitly arranged by the programmer.</li>
<li>Threads share the memory and the resources of the process to which they belong by default.</li>
<li>资源共享：线程默认共享它们所属进程的内存和资源。代码和数据共享的优点是它允许一个应用程序在同一地址空间有多个不同的活动线程。</li>
</ul></li>
<li><p><strong>Economy</strong></p>
<ul>
<li>Allocating memory and resources for process creation is costly. Because threads share the resources of the process to which they belong, it is more economical to create and context-switch threads.</li>
<li>经济：进程创建所需要的内存和资源的分配比较昂贵。由于线程能共享它们所属进程的资源，所以创建和切换线程会更为经济。</li>
</ul></li>
<li><p><strong>Scalability</strong></p>
<ul>
<li>The benefits of multithreading can be even greater in a multiprocessor architecture, where threads may be running in parallel on different processing cores.</li>
<li>可扩展性: 多线程的优点之一是能充分使用多处理器体系结构。以便每个进程能并行运行在不同的处理器上。</li>
</ul></li>
</ol>

<h2 id="toc_3">2 Multicore Programming</h2>

<p>On a system with a <strong>single</strong> computing core, concurrency merely means that the execution of the threads will be <strong>interleaved</strong> over time, because the processing core is capable of executing only one thread at a time.</p>

<p>On a system with <strong>multiple</strong> cores, however, concurrency means that some threads can run in <strong>parallel</strong>, because the system can assign a separate thread to each core.</p>

<p><img src="media/15319932561412/concurrency%20of%20single%20and%20multiple%20core.png" alt="concurrency of single and multiple core"/></p>

<p>Note: <strong><em>Concurrency</em></strong> v.s. <strong><em>Parallelism</em></strong></p>

<ul>
<li>Concurrency: supports more than one task by allowing all the tasks to make progress.</li>
<li>Parallelism: perform more than one task simultaneously.</li>
</ul>

<h3 id="toc_4">2.1 Programming Challenges</h3>

<ol>
<li><strong>Identifying tasks</strong>. This involves examining applications to find areas that can be divided into separate, concurrent tasks.</li>
<li><strong>Balance</strong>. Programmer must ensure that the tasks perform equal work of equal value.</li>
<li><strong>Data splitting</strong>. The data accessed and manipulated by the tasks must be divided to run on separate cores.</li>
<li><strong>Data dependency</strong>. The data accessed by the tasks must be examined for dependencies between two or more tasks.</li>
<li><strong>Testing and debugging</strong>. Testing and debugging such concurrent programs is inherently more difficult than testing and debugging single-threaded applications.</li>
</ol>

<h3 id="toc_5">2.2 Types of Parallelism</h3>

<p>In general, there are two types of parallelism: data parallelism and task parallelism.</p>

<ul>
<li><strong>Data parallelism</strong> focuses on distributing subsets of the same data across multiple computing cores and performing the same operation on each core. </li>
<li><strong>Task parallelism</strong> involves distributing not data but tasks (threads) across multiple computing cores.</li>
<li>However, data and task parallelism are not mutually exclusive, and an application may in fact use a hybrid of these two strategies.</li>
</ul>

<p>Data and task parallelism<br/>
<img src="media/15319932561412/data%20and%20task%20parallellism.png" alt="data and task parallelism"/></p>

<h2 id="toc_6">3 Multithreading Models</h2>

<p>Support for threads may be provided either at the user level, for <strong><em>user threads</em></strong>, or by the kernel, for <strong><em>kernel threads</em></strong>. </p>

<ul>
<li>User threads are supported above the kernel and are managed without kernel support.</li>
<li>Kernel threads are supported and managed directly by the operating system.</li>
</ul>

<p>有两种不同的方法来提供线程支持：用户层的用户级线程和内核层的内核级线程。用户级线程受内核支持，而无需内核管理；而内核级线程由操作系统直接支持和管理。事实上所有当代操作系统都支持内核级线程。</p>

<p>Ultimately, a relationship must exist between user threads and kernel threads. There are three common ways of establishing such a relationship: the many-to-one model, the one-to-one model, and the many-to-many model.<br/>
在用户级线程和内核级线程之间必然存在一种关系。有三种普遍建立这种关系的方法：多对一模型、一对一模型、多对多模型。</p>

<h3 id="toc_7">3.1 Many-to-One Model</h3>

<p>The <strong><u>many-to-one model</u></strong> maps many user-level threads to one kernel thread. 多对一模型将许多用户级线程映射到一个内核线程。</p>

<ul>
<li>Thread management is done by the thread library in user space, so it is efficient. 线程管理由线程库在用户空间进行的，因而效率比较高。</li>
<li>Also, because only one thread can access the kernel at a time, multiple threads are unable to run in parallel on multicore systems. 因为任意时刻只能有一个线程能够访问内核，多个线程不能并行运行在多处理器上。</li>
</ul>

<p><img src="media/15319932561412/many_to_one_model.png" alt="many_to_one_mode"/></p>

<h3 id="toc_8">3.2 One-to-One Model</h3>

<p>The <strong>one-to-one model</strong> maps each user thread to a kernel thread. 一对一模型每个用户线程映射到一个内核线程。</p>

<ul>
<li>It provides more concurrency by allowing another thread to run when a thread makes a blocking system call. 该模型在一个线程执行阻塞系统调用时，能允许另一个线程继续执行，提供了更高的并发性。</li>
<li>It also allows multiple threads to run in parallel on multiprocessors. 它也允许多个线程能并行运行在多处理器系统上。</li>
<li>The only drawback to this model is that creating a user thread requires creating the corresponding kernel thread, and a large number of kernel threads may burden the performance of a system. 这种模型的唯一缺点是每创建一个用户线程就会创建一个相应的内核线程, 大量内核线程会影响系统性能。</li>
</ul>

<p><img src="media/15319932561412/one_to_one_model.png" alt="one_to_one_mode"/></p>

<h3 id="toc_9">3.3 Many-to-Many Model</h3>

<p>The <strong>many-to-many model</strong> multiplexes many user-level threads to a smaller or equal number of kernel threads. 多对多模型多路复用了许多用户线程到同样数量或更小数量的内核线程上。</p>

<ul>
<li>Developers can create as many user threads as necessary. 开发人员可创建任意多的用户线程。</li>
<li>The corresponding kernel threads can run in parallel on a multiprocessor. 相应内核线程能在多处理器系统上并发执行。</li>
<li>Also, when a thread performs a blocking system call, the kernel can schedule another thread for execution. 而且当一个线程执行阻塞系统调用时，内核能调度另一个线程来执行。</li>
<li>In practice it is <strong>difficult to implement</strong>. 实际上难以实施。</li>
</ul>

<p><img src="media/15319932561412/many_to_many_model.png" alt="many_to_many_mode"/></p>

<p><u><strong><em>Most operating systems now use the one-to-one model.</em></strong></u></p>

<h3 id="toc_10">3.4 User/Kernel-Level threads</h3>

<p><a href="https://cs.nyu.edu/rgrimm/teaching/sp07-os/activations.pdf">ref: Scheduler Activations</a></p>

<p>(1) <strong>User-Level Threads</strong>(用户级线程)</p>

<p>Advantages</p>

<ul>
<li>Common operations can be implemented <strong>efficiently</strong> </li>
<li>Interface can be tailored to application needs</li>
</ul>

<p>Issues:</p>

<ul>
<li>A blocking system call blocks all user-level threads. 阻塞系统调用能够阻塞所有用户级线程。</li>
<li>Asynchronous system calls can provide partial work-around. 非同步系统调用能提供部分work-around. <a href="https://en.wikipedia.org/wiki/Workaround">view the definition of work-around here</a></li>
<li>A page fault blocks all user-level threads. 缺页异常阻塞所有用户级线程。</li>
<li>Matching threads to CPUs in a multiprocessor is hard：
<ul>
<li>No knowledge about the numbers of CPUs available to address space </li>
<li>No knowledge when a thread blocks</li>
</ul></li>
</ul>

<p>(2) <strong>Kernel-Level Threads</strong> (内核级线程)</p>

<p>Primary advantage</p>

<ul>
<li>Blocking system calls and page faults handled correctly</li>
</ul>

<p>Issues</p>

<ul>
<li>Cost of performing thread operations</li>
<li>Create, exit, lock, signal, wait all require user/kernel crossings</li>
</ul>

<p><strong>NOTE</strong>: The term <strong><u>virtual processor</u></strong> is often used instead of kernel thread.</p>

<h2 id="toc_11">4 Thread Libraries</h2>

<p>A thread library provides the programmer with an API for creating and managing threads. 线程库为程序员提供了创建和管理线程的API。</p>

<p><strong>Pthreads</strong>, the threads extension of the POSIX standard, may be provided as either a user-level or a kernel-level library. Pthread作为POSIX标准扩展，可以提供用户级或内核级的库。</p>

<ul>
<li><code>pthread_t tid</code>: declares the identifier for the thread</li>
<li><code>pthread attr_t attr</code>: declares the attributes for the thread</li>
<li><code>pthread_attr_init(&amp;attr)</code>: initialize thread attributes object</li>
<li><code>pthread_create()</code>: create a new thread</li>
<li><code>pthread_join()</code>:  join with a terminated thread<br/></li>
<li><code>pthread_exit()</code>:  terminate calling thread<br/></li>
</ul>

<p>Note: Compile and link with <code>-pthread</code>.</p>

<p><code>pthread</code>详细用法和实例, 见<a href="https://www.cs.cmu.edu/afs/cs/academic/class/15492-f07/www/pthreads.html">POSIX thread (pthread) libraries</a></p>

<h2 id="toc_12">5 Implicit threading</h2>

<p><strong>Implicit threading</strong>(隐式线程): Transfers the creation and management of threading from application developers to compilers and run-time libraries.</p>

<ul>
<li>One way to address difficulties and better support the design of concurrent and parallel applications</li>
<li>The advantage of this approach is that developers <strong><em><u>only need to identify parallel tasks</u></em></strong>, and the libraries determine the specific details of thread creation and management.</li>
</ul>

<p>In this section, we explore four alternative approaches to designing applications that can take advantage of multicore processors through implicit threading:</p>

<ul>
<li>Thread Pools</li>
<li>Fork Join</li>
<li>OpemMP</li>
<li>Grand Central Dispatch</li>
</ul>

<h3 id="toc_13">5.1 Thread Pools</h3>

<p>Two main issues exist:</p>

<ul>
<li>The thread will be <strong>discarded</strong> once it has completed its work. 线程在完成工作之后就要被丢弃</li>
<li><strong>Unlimited</strong> threads could exhaust system resources. 无限制的线程会耗尽系统资源</li>
</ul>

<p>Solution -&gt; <strong>thread pool</strong>(线程池)</p>

<ul>
<li>It creates a number of threads at start-up, and places them into a pool, where they sit and wait for work.</li>
<li>When a server receives a request, it submits the request to the thread pool and resumes waiting for additional requests.</li>
<li>If there is an available thread in the pool, it is awakened, and the request is serviced immediately. </li>
<li>If the pool contains no available thread, the task is queued until one becomes free. </li>
</ul>

<p>线程池的思想是在进程开始时创建一定数量的线程，并放入到池中以等待工作。当服务器收到请求时，它会唤醒线程池中的一个线程，并将要处理的请求传递给它，一旦线程完成了服务，它会返回到池中在等待工作。如果池中没有可用的线程，那么服务器会一直等待直到有空线程为止。</p>

<p>Thread pools offer these benefits:</p>

<ol>
<li>Servicing a request with an existing thread is often <strong>faster</strong> than waiting to create a thread. 通常用现有线程处理请求要比等待创建新的线程要快.</li>
<li>A thread pool <strong>limits</strong> the number of threads that exist at any one point.  线程池限制了在任何时候可用线程的数量.</li>
<li>Separating the task to be performed from the mechanics of creating the task allows us to use different strategies for running the task.</li>
</ol>

<p>Java线程库的一个例子：</p>

<pre><code class="language-java">import java.util.concurrent.*; 
public class ThreadPoolExample 
{ 
    public static void main(String[] args) {
        int numTasks = Integer.parseInt(args[0].trim()); 
        
        /* Create the thread pool */ 
        ExecutorService pool = Executors.newCachedThreadPool(); 
        /* Run each task using a thread in the pool */ 
        for (int i = 0; i &lt; numTasks; i++) 
            pool.execute(new Task()); 
        
         /* Shut down the pool once all threads have completed */            
        pool.shutdown();
}
</code></pre>

<h3 id="toc_14">5.4 Grand Central Dispatch</h3>

<p><strong>Grand Central Dispatch</strong> (GCD) is a technology for Apple&#39;s Mac OS X and iOS operating systems. It is a combination of extensions to the C languages, an API, and a run-time library that allows application developers identify sections of code to run in parallel.</p>

<ul>
<li>GCD identifies two types of dispatch queues: serial and concurrent.</li>
</ul>

<h2 id="toc_15">6 Threading Issues</h2>

<h3 id="toc_16">6.1 Light Weight Process</h3>

<p>Many systems implementing either the many-to-many or the two-level model place an <em>intermediate</em> data structure between the user and kernel threads. This data structure—typically known as a <strong><u><em>lightweight process</em></u></strong>（轻量级进程）, or <strong>LWP</strong>.</p>

<ul>
<li>To the user-thread library, the LWP appears to be a <strong>virtual</strong> processor on which the application can schedule a user thread to run.</li>
<li>Each LWP is attached to a kernel thread.</li>
<li>If a kernel thread blocks, the LWP blocks as well. Up the chain, the user-level thread attached to the LWP also blocks.</li>
</ul>

<p><img src="media/15319932561412/light-weight%20process.png" alt="light-weight process"/></p>

<p><img src="media/15319932561412/15320591793590.jpg" alt=""/></p>

<p>where K denotes kernel threads and  P denotes Process.</p>

<p>下面是一个测试LINUX中LWP的C程序</p>

<pre><code class="language-c">/* filename: test_LWP.c */
#include &lt;stdlib.h&gt;
#include &lt;pthread.h&gt;
#include &lt;stdio.h&gt;
#include &lt;unistd.h&gt;

int* thread(void* arg)
{
    pthread_t tid; // the ID of a thread
    tid = pthread_self();//get the current thread&#39;s id
 
    printf(&quot;The ID of new thread is =%lu\n&quot;, tid);
    sleep(500); //sleep for 500 seconds
    return NULL; 
}
  
int main()
{
    pthread_t tid;
    printf(&quot;The ID of main thread is %lu\n&quot;, pthread_self()); //get the main thread&#39;s id
  if (pthread_create(&amp;tid, NULL, (void *) thread, NULL) !=0) 
    {
       printf(&quot;Thread creation failed\n&quot;);
        exit(1);
    }
      
    printf(&quot;my Id is %lu, new thread ID is %lu\n&quot;, pthread_self(), tid);
    sleep(1000);
    return 0;
}
</code></pre>

<p>运行<code>ps -efL</code> 可以看到, <code>test_LWP</code>进程(PID=1953)有两个LWP，即NLWP(number of light weight process)=2。</p>

<pre><code class="language-text">UID        PID  PPID   LWP  C NLWP STIME TTY          TIME CMD
vagrant   1953  1644  1953  0    2 04:16 pts/0    00:00:00 ./test_LWP
vagrant   1953  1644  1954  0    2 04:16 pts/0    00:00:00 ./test_LWP
vagrant   2028  1839  2028  0    1 04:18 pts/1    00:00:00 ps -efL
</code></pre>

<h3 id="toc_17">6.2 Scheduler activation</h3>

<p><strong>Problems</strong>:<br/>
内核线程在各方面都比较灵活，但是性能不高，经常会出现请求在用户空间和内核空间的传递。那么如何在拥有内核空间线程的灵活性的同时又提高性能呢?</p>

<p><strong>Solution</strong>:</p>

<p><strong>Scheduler activation</strong>（调度器激活）are a threading mechanism that, when implemented in an operating system&#39;s process scheduler, provide <em><u>kernel-level</u></em> thread functionality with <u><em>user-level</em></u> thread flexibility and performance [<a href="https://en.wikipedia.org/wiki/Scheduler_activations">ref</a>]. </p>

<p>It works as follows: </p>

<ul>
<li>The kernel provides an application with a set of virtual processors (LWPs), and the application can <strong>schedule</strong> user threads onto an available virtual processor. </li>
<li>Furthermore, the kernel must inform an application about certain events. This procedure is known as an <strong>upcall</strong>(向上调用). </li>
<li>Upcalls are handled by the thread library with an upcall handler, and upcall handlers must run on a virtual processor.</li>
<li>While the user threading library will schedule user threads, the kernel will schedule the underlying LWPs.</li>
</ul>

<p><strong>Example</strong> [<a href="http://www.it.uu.se/education/course/homepage/os/vt18/module-4/implementing-threads/">ref</a>]: </p>

<p>Let’s study an example of how scheduler activations can be used. The kernel has allocated one kernel thread (1) to a process with three user-level threads (2). The three user level threads take turn executing on the single kernel-level thread.</p>

<p><img src="media/15319932561412/scheduler-activations-1-2.png" alt="scheduler-activations-1-2"/></p>

<ul>
<li>(3) The executing thread makes a <strong>blocking system call</strong>.</li>
<li>(4) And the the kernel blocks the calling user-level thread and the kernel-level thread used to execute the user-level thread .</li>
<li>(5) Scheduler activation: the kernel decides to allocate a new kernel-level thread to the process . </li>
<li>(6) Upcall: the kernel notifies the user-level thread manager which user-level thread that is now blocked and that a new kernel-level thread is available. </li>
<li>(7) The user-level thread manager move the other threads to the new kernel thread and resumes one of the ready threads.</li>
</ul>

<p><img src="media/15319932561412/scheduler-activations-3-7.png" alt="scheduler-activations-3-7"/></p>


    

      </div>

      <div class="row">
        <div class="large-6 columns">
        <p class="text-left" style="padding:15px 0px;">
      
          <a href="15323640524161.html" 
          title="Previous Post: Machine Learning with large datasets">&laquo; Machine Learning with large datasets</a>
      
        </p>
        </div>
        <div class="large-6 columns">
      <p class="text-right" style="padding:15px 0px;">
      
          <a  href="cpp_by_diessection.html" 
          title="Next Post: [NOTE] C++ By Dissection">[NOTE] C++ By Dissection &raquo;</a>
      
      </p>
        </div>
      </div>
      <div class="comments-wrap">
        <div class="share-comments">
          <div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://techlarry-1.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                                

          

          
        </div>
      </div>
    </div><!-- article-wrap -->
  </div><!-- large 8 -->




 <div class="large-4 medium-4 columns">
  <div class="hide-for-small">
    <div id="sidebar" class="sidebar">
          <div id="site-info" class="site-info">
            
                <div class="site-a-logo"><img src="http://or9a8nskt.bkt.clouddn.com/figure.jpeg" /></div>
            
                <h1>techlarry</h1>
                <div class="site-des">他山之石，可以攻玉</div>
                <div class="social">









<a target="_blank" class="github" target="_blank" href="https://github.com/techlarry" title="GitHub">GitHub</a>
<a target="_blank" class="email" href="mailto:wang.zhen.hua.larry@gmail.com" title="Email">Email</a>
  <a target="_blank" class="rss" href="atom.xml" title="RSS">RSS</a>
                
              	 </div>
          	</div>

             

              <div id="site-categories" class="side-item ">
                <div class="side-header">
                  <h2>Categories</h2>
                </div>
                <div class="side-content">

      	<p class="cat-list">
        
            <a href="Leetcode.html"><strong>Leetcode</strong></a>
        
            <a href="programming_language.html"><strong>编程语言</strong></a>
        
            <a href="data_structure_and_algorithm.html"><strong>数据结构和算法</strong></a>
        
            <a href="Python%E7%89%B9%E6%80%A7.html"><strong>Python特性</strong></a>
        
            <a href="%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0.html"><strong>机器学习</strong></a>
        
            <a href="English.html"><strong>English</strong></a>
        
            <a href="Computer%20System.html"><strong>Computer System</strong></a>
        
            <a href="Deep%20Learning.html"><strong>Deep Learning</strong></a>
        
            <a href="Linux%20%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B.html"><strong>Linux 系统编程</strong></a>
        
            <a href="%E6%95%B0%E6%8D%AE%E5%BA%93.html"><strong>数据库</strong></a>
        
            <a href="Tensorflow.html"><strong>Tensorflow</strong></a>
        
            <a href="Big%20Data.html"><strong>Big Data</strong></a>
        
            <a href="%E6%96%87%E7%8C%AE%E9%98%85%E8%AF%BB.html"><strong>文献阅读</strong></a>
        
            <a href="Tools.html"><strong>Tools</strong></a>
         
        </p>


                </div>
              </div>

              <div id="site-categories" class="side-item">
                <div class="side-header">
                  <h2>Recent Posts</h2>
                </div>
                <div class="side-content">
                <ul class="posts-list">
	      
		      
			      <li class="post">
			        <a href="15400989593148.html">Scrapy爬取MovieLens</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="scrapy_top100.html">Scrapy爬取猫眼TOP100榜</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15046649572570.html">Pandas</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="exceptional_control_flow.html">CSAPP - 异常控制流</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="introduction_to_computer_system_CMU.html">CMU 15-213 Introduction to Computer Systems</a>
			      </li>
		     
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		   
		  		</ul>
                </div>
              </div>
        </div><!-- sidebar -->
      </div><!-- hide for small -->
</div><!-- large 4 -->

</div><!-- row -->

 <div class="page-bottom clearfix">
  <div class="row">
   <p class="copyright">Copyright &copy; 2015
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
</div>

        </section>
      </div>
    </div>

  
    

    <script src="asset/js/foundation.min.js"></script>
    <script>
      $(document).foundation();
      function fixSidebarHeight(){
        var w1 = $('.markdown-body').height();
          var w2 = $('#sidebar').height();
          if (w1 > w2) { $('#sidebar').height(w1); };
      }
      $(function(){
        fixSidebarHeight();
      })
      $(window).load(function(){
          fixSidebarHeight();
      });
     
    </script>

    
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({TeX: { equationNumbers: { autoNumber: "AMS" } }});</script>


  </body>
</html>
