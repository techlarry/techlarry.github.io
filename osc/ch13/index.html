<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Zhenhua Wang">
        <link rel="canonical" href="http://larryim.cc/note/osc/ch13/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Chapter 13: File-System Interfaces - Zhenhua's Notes</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../extra_css/custom.css" rel="stylesheet">
        <link href="../../extra_css/custom.js" rel="stylesheet">
        <link href="../../extra_css/friendly.css" rel="stylesheet">
        <link href="../../extra_css/theme.css" rel="stylesheet">
        <link href="../../extra_css/mkdocs/js/lunr-0.5.7.min.js" rel="stylesheet">
        <link href="../../extra_css/mkdocs/js/mustache.min.js" rel="stylesheet">
        <link href="../../extra_css/mkdocs/js/require.js" rel="stylesheet">
        <link href="../../extra_css/mkdocs/js/search.js" rel="stylesheet">
        <link href="../../extra_css/mkdocs/js/text.js" rel="stylesheet">
        <link href="../../extra_css/code-tab.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../..">Zhenhua's Notes</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="../..">Home</a>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">OSC <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../">Contents</a>
</li>
                            
<li >
    <a href="../ch1/">Chapter 1: Introduction </a>
</li>
                            
<li >
    <a href="../ch2/">Chapter 2: Operating System structures</a>
</li>
                            
<li >
    <a href="../ch3/">Chapter 3: Processes</a>
</li>
                            
<li >
    <a href="../ch4/">Chapter 4: Threads and Concurrency</a>
</li>
                            
<li >
    <a href="../ch5/">Chapter 5: CPU Scheduling</a>
</li>
                            
<li >
    <a href="../ch6/">Chapter 6: Synchronization Tools</a>
</li>
                            
<li >
    <a href="../ch7/">Chapter 7: Synchronization Examples</a>
</li>
                            
<li >
    <a href="../ch8/">Chapter 8: Deadlocks</a>
</li>
                            
<li >
    <a href="../ch9/">Chapter 9: Main Memory</a>
</li>
                            
<li >
    <a href="../ch10/">Chapter 10: Virtual Memory</a>
</li>
                            
<li >
    <a href="../ch11/">Chapter 11: Mass-Storage Structure</a>
</li>
                            
<li class="active">
    <a href="./">Chapter 13: File-System Interfaces</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">CSAPP <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../csapp/">Contents</a>
</li>
                            
<li >
    <a href="../../csapp/ch1/">Chapter 1: 计算机系统漫游</a>
</li>
                            
<li >
    <a href="../../csapp/ch2/">Chapter 2: 信息的表示和处理</a>
</li>
                            
<li >
    <a href="../../csapp/ch3/">Chapter 3: 程序的机器级表示</a>
</li>
                            
<li >
    <a href="../../csapp/ch4/">Chapter 4: 处理器体系结构</a>
</li>
                            
<li >
    <a href="../../csapp/ch5/">Chapter 5: 优化程序性能</a>
</li>
                            
<li >
    <a href="../../csapp/ch6/">Chapter 6: 存储器层次结构</a>
</li>
                            
<li >
    <a href="../../csapp/ch7/">Chapter 7: 链接</a>
</li>
                            
<li >
    <a href="../../csapp/ch8/">Chapter 8: 异常控制流</a>
</li>
                            
<li >
    <a href="../../csapp/ch9/">Chapter 9: 虚拟内存</a>
</li>
                            
<li >
    <a href="../../csapp/ch10/">Chapter 10: 系统级I/O</a>
</li>
                            
<li >
    <a href="../../csapp/ch11/">Chapter 11: 网络编程</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">HFJ <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../hfj/">Contents</a>
</li>
                            
<li >
    <a href="../../hfj/ch1/">Chapter 1: Dive in A Quick Dip</a>
</li>
                            
<li >
    <a href="../../hfj/ch2/">Chapter 2: Classes and Objects</a>
</li>
                            
<li >
    <a href="../../hfj/ch3/">Chapter 3: Primitives and References</a>
</li>
                            
<li >
    <a href="../../hfj/ch4/">Chapter 4: Methods use Instance Variables</a>
</li>
                            
<li >
    <a href="../../hfj/ch5/">Chapter 5: Writing a Program</a>
</li>
                            
<li >
    <a href="../../hfj/ch6/">Chapter 6: Get to Know the Java API</a>
</li>
                            
<li >
    <a href="../../hfj/ch7/">Chapter 7: Inheritance and Polymorphism</a>
</li>
                            
<li >
    <a href="../../hfj/ch8/">Chapter 8: Interfaces and Abstract Classes</a>
</li>
                            
<li >
    <a href="../../hfj/ch9/">Chapter 9: Constructors and Garbage Collection</a>
</li>
                            
<li >
    <a href="../../hfj/ch10/">Chapter 10: Numbers and Statics</a>
</li>
                            
<li >
    <a href="../../hfj/ch11/">Chapter 11: Exception Handling</a>
</li>
                            
<li >
    <a href="../../hfj/ch12/">Chapter 12: Getting GUI</a>
</li>
                            
<li >
    <a href="../../hfj/ch13/">Chapter 13: Using Swing</a>
</li>
                            
<li >
    <a href="../../hfj/ch14/">Chapter 14: Serialization and File I/O</a>
</li>
                            
<li >
    <a href="../../hfj/ch15/">Chapter 15: Networking and Threads</a>
</li>
                            
<li >
    <a href="../../hfj/ch16/">Chapter 16: Collections and Generics</a>
</li>
                            
<li >
    <a href="../../hfj/ch17/">Chapter 17: Packages, Jars and Deployment</a>
</li>
                            
<li >
    <a href="../../hfj/ch18/">Chapter 18: Remote deploy with RMI</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">CPJ <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../cpj/">Contents</a>
</li>
                            
<li >
    <a href="../../cpj/ch1/">Concurrent Programming in Java 1: Threads and Locks</a>
</li>
                            
<li >
    <a href="../../cpj/ch2/">Concurrent Programming in Java 2: Critical Sections and Isolation</a>
</li>
                            
<li >
    <a href="../../cpj/ch3/">Concurrent Programming in Java 3: Actors</a>
</li>
                            
<li >
    <a href="../../cpj/ch4/">Concurrent Programming in Java 4: Concurrent Data Structures</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">HADOOP <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../cpj/">Contents</a>
</li>
                            
<li >
    <a href="../../hadoop/ch1/">Chapter 1: Meet Hadoop</a>
</li>
                            
<li >
    <a href="../../hadoop/ch2/">Chapter 2: MapReduce</a>
</li>
                            
<li >
    <a href="../../hadoop/ch3/">Chapter 3: The Hadoop Distributed FileSystem</a>
</li>
                            
<li >
    <a href="../../hadoop/ch4/">Chapter 4: YARN</a>
</li>
                            
<li >
    <a href="../../hadoop/ch5/">Chapter 5: Hadoop I/O</a>
</li>
                            
<li >
    <a href="../../hadoop/ch6/">Chapter 6: Developing a MapReduce Application</a>
</li>
                            
<li >
    <a href="../../hadoop/ch7/">Chapter 7: How MapReduce Works</a>
</li>
                            
<li >
    <a href="../../hadoop/ch8/">Chapter 8: MapReduce Types and Formats</a>
</li>
                            
<li >
    <a href="../../hadoop/ch9/">Chapter 9: MapReduce Features</a>
</li>
                            
<li >
    <a href="../../hadoop/ch10/">Chapter 10: Setting Up a Hadoop Cluster</a>
</li>
                            
<li >
    <a href="../../hadoop/ch11/">Chapter 11: Adminstering Hadoop</a>
</li>
                            
<li >
    <a href="../../hadoop/ch12/">Chapter 12: Avro</a>
</li>
                            
<li >
    <a href="../../hadoop/ch13/">Chapter 13: Parquet</a>
</li>
                            
<li >
    <a href="../../hadoop/ch14/">Chapter 14: Flume</a>
</li>
                            
<li >
    <a href="../../hadoop/ch15/">Chapter 15: Sqoop</a>
</li>
                            
<li >
    <a href="../../hadoop/ch16/">Chapter 16: Pig</a>
</li>
                            
<li >
    <a href="../../hadoop/ch17/">Chapter 17: Hive</a>
</li>
                            
<li >
    <a href="../../hadoop/ch18/">Chapter 18: Crunch</a>
</li>
                            
<li >
    <a href="../../hadoop/ch19/">Chapter 19: Spark</a>
</li>
                            
<li >
    <a href="../../hadoop/ch20/">Chapter 20: HBase</a>
</li>
                            
<li >
    <a href="../../hadoop/ch21/">Chapter 21: ZooKeeper</a>
</li>
                            
<li >
    <a href="../../hadoop/ch22/">Chapter 22: Composable Data at Center</a>
</li>
                            
<li >
    <a href="../../hadoop/ch23/">Chapter 23: Biological Data Science: Saving Lives with Software</a>
</li>
                            
<li >
    <a href="../../hadoop/ch24/">Chapter 24: Cascading</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">UJVM <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../ujvm/">Contents</a>
</li>
                            
<li >
    <a href="../../ujvm/ch1/">Chapter 1 : 走进Java</a>
</li>
                            
<li >
    <a href="../../ujvm/ch2/">Chapter 2 : Java内存区域与内存溢出正常</a>
</li>
                            
<li >
    <a href="../../ujvm/ch3/">Chapter 3 : 垃圾收集器与内存分配策略</a>
</li>
                            
<li >
    <a href="../../ujvm/ch4/">Chapter 4 : 虚拟机性能监控与故障处理工具</a>
</li>
                            
<li >
    <a href="../../ujvm/ch5/">Chapter 5 : 调优案例分析与实战</a>
</li>
                            
<li >
    <a href="../../ujvm/ch6/">Chapter 6 : 类文件结构</a>
</li>
                            
<li >
    <a href="../../ujvm/ch7/">Chapter 7 : 虚拟机类加载机制</a>
</li>
                            
<li >
    <a href="../../ujvm/ch8/">Chapter 8 : 虚拟机字节码执行引擎</a>
</li>
                            
<li >
    <a href="../../ujvm/ch9/">Chapter 9 : 类加载及执行子系统的案例与实战</a>
</li>
                            
<li >
    <a href="../../ujvm/ch10/">Chapter 10 : 早期(编译期)优化</a>
</li>
                            
<li >
    <a href="../../ujvm/ch11/">Chapter 11 : 晚期(运行期)优化</a>
</li>
                            
<li >
    <a href="../../ujvm/ch12/">Chapter 12 : Java内存模型与线程</a>
</li>
                            
<li >
    <a href="../../ujvm/ch13/">Chapter 13 : 线程安全与锁优化</a>
</li>
                            
<li >
    <a href="../../ujvm/AppendixC/">Appendix HotSpot虚拟机主要参数列表</a>
</li>
                        </ul>
                    </li>
                    <li >
                        <a href="../../books/">Books</a>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="../ch11/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../../csapp/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#operating-system-concepts-13-file-system-interface">Operating System Concepts 13 - File System Interface</a></li>
        <li class="main "><a href="#1-file-concept">1 File Concept</a></li>
            <li><a href="#file-attributes">File Attributes</a></li>
            <li><a href="#file-operations">File Operations</a></li>
            <li><a href="#file-types">File Types</a></li>
            <li><a href="#file-structure">File Structure</a></li>
            <li><a href="#internal-file-structure">Internal File Structure</a></li>
        <li class="main "><a href="#2-access-methods">2 Access Methods</a></li>
            <li><a href="#sequential-access">Sequential Access</a></li>
            <li><a href="#direct-access">Direct Access</a></li>
            <li><a href="#other-access-methods">Other Access Methods</a></li>
        <li class="main "><a href="#3-directory-structure">3 Directory Structure</a></li>
        <li class="main "><a href="#4-protection">4 Protection</a></li>
            <li><a href="#types-of-access">Types of Access</a></li>
            <li><a href="#access-control">Access Control</a></li>
            <li><a href="#other-protection-approaches">Other Protection Approaches</a></li>
            <li><a href="#permissions-in-unix">Permissions in UNIX</a></li>
        <li class="main "><a href="#5-memory-mapped-files">5 Memory-Mapped Files</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h3 id="operating-system-concepts-13-file-system-interface"><strong>Operating System Concepts 13 - File System Interface</strong><a class="headerlink" href="#operating-system-concepts-13-file-system-interface" title="Permanent link">&para;</a></h3>
<p>The file system consists of two distinct parts: a collection of <strong>files</strong>, each storing related data, and a <strong>directory</strong> structure, which organizes and provides information about all the files in the system.</p>
<h3 id="1-file-concept">1 File Concept<a class="headerlink" href="#1-file-concept" title="Permanent link">&para;</a></h3>
<p>A <strong>file</strong> is named collection of related information that is recorded on secondary storage.(文件是记录在外存上的相关信息的具有名称的集合)。</p>
<p>A file has a certain defined structure, which depends on its type.</p>
<ul>
<li>A text file is a sequence of characters organized into lines.</li>
<li>An executable file is a series of code sections.</li>
</ul>
<h4 id="file-attributes">File Attributes<a class="headerlink" href="#file-attributes" title="Permanent link">&para;</a></h4>
<p>A file's attributes vary from one operating system to another but typically consist of these:</p>
<ul>
<li><strong>Name</strong>. The symbolic file name is the only information kept in human-readable form.</li>
<li><strong>Identifier</strong>. This unique tag, usually a number, Identifier the file within the file system; it is the non-human-readable name for the file.</li>
<li><strong>Type</strong>. This information is needed for systems that support different types of files.</li>
<li><strong>Location</strong>. This information is a pointer to a device and to the location of the file on that device.</li>
<li><strong>Size</strong>. The current size of the file (in bytes, words, or blocks) and possibly the maximum allowed size are included in this attribute.</li>
<li><strong>Protection</strong>. Access-control information determines who can do reading, writing, executing, and so on.</li>
<li><strong>Timestamps and user identification</strong>. This information may be kept for creation, last modification, and last use. These data can be useful for protection, security, and usage monitoring.</li>
</ul>
<h4 id="file-operations">File Operations<a class="headerlink" href="#file-operations" title="Permanent link">&para;</a></h4>
<p>The operating system must do to perform each of these seven basic file operations.</p>
<ul>
<li><strong>Creating a file</strong>. First, space must be allocated for the file. Second, an entry for the new file must be made in a directory.</li>
<li><strong>Opening a file</strong>. Check access permissions, and if successful, the open call returns a file handle that is used as an argument in the other calls.</li>
<li><strong>Writing a file</strong>: The system keeps a <em>write pointer</em> to the location in the file where the next write is to take place if it is sequential.</li>
<li><strong>Repositioning within a file</strong>: The <em>current-file-position pointer</em> of the open file is repositioned to a given value.</li>
<li><strong>Deleting a file</strong>: Release all file space.</li>
<li><strong>Truncating a file</strong>: The length of a file can be reset to zero, and its file space be released with all  other attributes remain unchanged.</li>
</ul>
<p>These seven basic operations comprise the minimal set of required file operations. These primitive operations can then be combined to perform other file operations.</p>
<p>The operating system keeps a table, called the <strong>open-file-table</strong>, containing information about all open files.</p>
<ul>
<li>When a file operation is requested, the file is specified via an index into this table.</li>
<li>When the file is no longer being actively used, it is closed by the process, and the operating system removes its entry from the open-file table, potentially releasing locks.</li>
</ul>
<p>ISSUES: Several different applications open the same file at the same time.</p>
<p>SOLUTION: The operating system uses two levels of internal tables: a per-process table and a system-wide table.</p>
<ul>
<li>The per-process table tracks all files that a process has open.<ul>
<li>It Stores information regarding the process's use of the file (e.g. the current file pointer for each file, access rights to the file and accounting information)</li>
</ul>
</li>
<li>Each entry in the per-process table in turn points to a system-wide open-file table. <ul>
<li>It contains process-independent information(e.g. the location of the file on disk, access dates, and file size).</li>
<li>Once a file has been opened by one process, it includes an entry for the file.</li>
<li>It also has an <strong>open count</strong> associated with each file to indicate how many processes have the file open.</li>
</ul>
</li>
</ul>
<p><font color="red"><b>File locks</b></font>(文件锁) are useful for files that are shared by several processes. For example, a system log file that can be accessed and modified by a number of processes in the system.</p>
<p>File locks provide functionality similar to reader-writer locks in <a href="osc/ch7.md">Chapter 7</a>. A <strong>shared lock</strong>(共享锁) is akin to a reader lock in that several processes can acquire the lock concurrently. An <strong>exclusive lock</strong>(排斥锁) is akin to a writer lock in that only one process at a time can acquire such a lock.</p>
<p>Furthermore, operating systems(e.g. Linux) may provide either <strong>mandatory</strong>  or <strong>advisory</strong> file-locking mechanisms.</p>
<ul>
<li>With mandatory locking, once a process acquires an exclusive lock, the operating system will prevent any other process from accessing the locked file.</li>
<li>with advisory locking, the operating system will not prevent other process from accessing to the locked file.</li>
<li>For advisory locking, it is up to software developers to ensure that locks are appropriately acquired and released.</li>
</ul>
<p>The simple program in Java as follows demonstrating file locking. The program acquires an exclusive lock on the first half of the file and a shared lock on the second half.</p>
<p> <div class=codehilite><pre><span class=kn>import</span> <span class=nn>java.io.*</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.nio.channels.*</span><span class=o>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>LockingExample</span> <span class=o>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kd>final</span> <span class=kt>boolean</span> <span class=n>EXCLUSIVE</span> <span class=o>=</span> <span class=kc>false</span><span class=o>;</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kd>final</span> <span class=kt>boolean</span> <span class=n>SHARED</span> <span class=o>=</span> <span class=kc>true</span><span class=o>;</span>

   <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span> <span class=n>args</span><span class=o>[])</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=o>{</span>
        <span class=k>if</span> <span class=o>(</span><span class=n>args</span><span class=o>.</span><span class=na>length</span> <span class=o>!=</span> <span class=mi>1</span><span class=o>)</span> <span class=o>{</span>
            <span class=n>System</span><span class=o>.</span><span class=na>err</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&quot;Usage: java LockingExample &lt;input file&gt;&quot;</span><span class=o>);</span>
            <span class=n>System</span><span class=o>.</span><span class=na>exit</span><span class=o>(</span><span class=mi>0</span><span class=o>);</span>
       <span class=o>}</span>

    <span class=n>FileLock</span> <span class=n>sharedLock</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
    <span class=n>FileLock</span> <span class=n>exclusiveLock</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>

    <span class=k>try</span> <span class=o>{</span>
       <span class=n>RandomAccessFile</span> <span class=n>raf</span> <span class=o>=</span> <span class=k>new</span> <span class=n>RandomAccessFile</span><span class=o>(</span><span class=n>args</span><span class=o>[</span><span class=mi>0</span><span class=o>],</span> <span class=s>&quot;rw&quot;</span><span class=o>);</span> 

        <span class=c1>// get the channel for the file</span>
        <span class=n>FileChannel</span> <span class=n>channel</span> <span class=o>=</span> <span class=n>raf</span><span class=o>.</span><span class=na>getChannel</span><span class=o>();</span>

        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&quot;trying to acquire lock ...&quot;</span><span class=o>);</span>
        <span class=c1>// this locks the first half of the file - exclusive</span>
        <span class=n>exclusiveLock</span> <span class=o>=</span> <span class=n>channel</span><span class=o>.</span><span class=na>lock</span><span class=o>(</span><span class=mi>0</span><span class=o>,</span> <span class=n>raf</span><span class=o>.</span><span class=na>length</span><span class=o>()/</span><span class=mi>2</span><span class=o>,</span> <span class=n>EXCLUSIVE</span><span class=o>);</span>
        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&quot;lock acquired ...&quot;</span><span class=o>);</span>

        <span class=cm>/**</span>
<span class=cm>         * Now modify the data  . . .</span>
<span class=cm>         */</span>

        <span class=k>try</span> <span class=o>{</span>
            <span class=c1>// sleep for 10 seconds</span>
            <span class=n>Thread</span><span class=o>.</span><span class=na>sleep</span><span class=o>(</span><span class=mi>10000</span><span class=o>);</span>
        <span class=o>}</span>
        <span class=k>catch</span> <span class=o>(</span><span class=n>InterruptedException</span> <span class=n>ie</span><span class=o>)</span> <span class=o>{</span> <span class=o>}</span>

        <span class=c1>// release the lock</span>
        <span class=n>exclusiveLock</span><span class=o>.</span><span class=na>release</span><span class=o>();</span>
        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&quot;lock released ...&quot;</span><span class=o>);</span>

        <span class=c1>// this locks the second half of the file - shared </span>
        <span class=n>sharedLock</span> <span class=o>=</span> <span class=n>channel</span><span class=o>.</span><span class=na>lock</span><span class=o>(</span><span class=n>raf</span><span class=o>.</span><span class=na>length</span><span class=o>()/</span><span class=mi>2</span> <span class=o>+</span> <span class=mi>1</span><span class=o>,</span> <span class=n>raf</span><span class=o>.</span><span class=na>length</span><span class=o>(),</span> <span class=n>SHARED</span><span class=o>);</span>

        <span class=cm>/**</span>
<span class=cm>         * Now read the data  . . .</span>
<span class=cm>         */</span>

        <span class=c1>// release the lock</span>
        <span class=n>exclusiveLock</span><span class=o>.</span><span class=na>release</span><span class=o>();</span>
    <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>java</span><span class=o>.</span><span class=na>io</span><span class=o>.</span><span class=na>IOException</span> <span class=n>ioe</span><span class=o>)</span> <span class=o>{</span>
        <span class=n>System</span><span class=o>.</span><span class=na>err</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>ioe</span><span class=o>);</span>
    <span class=o>}</span>
        <span class=k>finally</span> <span class=o>{</span>
        <span class=k>if</span> <span class=o>(</span><span class=n>exclusiveLock</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span>
                <span class=n>exclusiveLock</span><span class=o>.</span><span class=na>release</span><span class=o>();</span>
        <span class=k>if</span> <span class=o>(</span><span class=n>sharedLock</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span>
                <span class=n>sharedLock</span><span class=o>.</span><span class=na>release</span><span class=o>();</span>
        <span class=o>}</span>
   <span class=o>}</span>
<span class=o>}</span>
</pre></div></p>
<h4 id="file-types">File Types<a class="headerlink" href="#file-types" title="Permanent link">&para;</a></h4>
<p>A common technique for implementing file types is to include the type as part of the file name. </p>
<ul>
<li>The name is split into two parts—a <em>name</em> and an <em>extension</em>, usually separated by a period. </li>
<li>The system uses the extension to indicate the type of the file and the type of operations that can be done on that file</li>
<li>The UNIX system uses a <strong>magic number</strong>[<a href="https://en.wikipedia.org/wiki/Magic_number_(programming)">Wikipedia</a>] stored at the beginning of some binary files to indicate the type of data in the file (for example, the format of an image file). Not all files have magic numbers.</li>
</ul>
<h4 id="file-structure">File Structure<a class="headerlink" href="#file-structure" title="Permanent link">&para;</a></h4>
<p>Certain files must conform to a required structure that is understood by the operating system. </p>
<ul>
<li>For example, the operating system requires that an executable file have a specific structure so that it can determine where in memory to load the file and what the location of the first instruction is.</li>
<li>One of the disadvantage of having the operating system support multiple file structures: it makes the operating system large and cumbersome.</li>
<li>Some operating systems(UNIX, Windows) impose (and support) a minimal number of file structures.</li>
<li>However, all operating systems must support at least one structure —that of an executable file — so that the system is able to load and run programs.</li>
</ul>
<h4 id="internal-file-structure">Internal File Structure<a class="headerlink" href="#internal-file-structure" title="Permanent link">&para;</a></h4>
<p>ISSUE: All disk I/O is performed in units of one block (physical record), and all blocks are the same size. It is unlikely that the physical record size will exactly match the length of the desired logical record.</p>
<p>SOLUTION:<strong>Packing a number of logical records into physical blocks</strong>.</p>
<p>EXAMPLE: The UNIX operating system defines all files to be simply streams of bytes. Each byte is individually addressable by its offset from the beginning (or end) of the file. In this case, the logical record size is 1 byte. The file system automatically packs and unpacks bytes into physical disk blocks - say, 512 bytes per block — as necessary.</p>
<h3 id="2-access-methods">2 Access Methods<a class="headerlink" href="#2-access-methods" title="Permanent link">&para;</a></h3>
<p>Files store information. The information in the file can be accessed in several ways.</p>
<h4 id="sequential-access">Sequential Access<a class="headerlink" href="#sequential-access" title="Permanent link">&para;</a></h4>
<p>The simplest access method is <strong>sequential access</strong>(顺序访问). </p>
<ul>
<li>Information in the file is processed in order, one record after the other.</li>
<li>It is by far the most common access method.</li>
</ul>
<p><img alt="sequential access" src="../figures/sequential%20access.png" /></p>
<h4 id="direct-access">Direct Access<a class="headerlink" href="#direct-access" title="Permanent link">&para;</a></h4>
<p>For <strong>direct access</strong>(直接访问) or <strong>relative access</strong>(相对访问), a file is made up of fixed-length logical records that allow programs to read and write records rapidly in no particular order.</p>
<ul>
<li>The file is viewed as a <em>numbered</em> sequence of blocks or records.</li>
<li>Direct-access files are of great use for immediate access to large amounts of information. (e.g. databases, we compute which block contains the answer and then read that block directly when querying)</li>
<li>A <strong>relative block number</strong> is provided by the user to the operating system. It is an index relative to the beginning of the file.</li>
</ul>
<h4 id="other-access-methods">Other Access Methods<a class="headerlink" href="#other-access-methods" title="Permanent link">&para;</a></h4>
<p>Other access methods generally involve the construction of an index for the file. The <strong>index</strong> contains pointers to the various blocks. To find a record in the file, we first search the index and then use the pointer to access the file directly and to find the desired record.</p>
<h3 id="3-directory-structure">3 Directory Structure<a class="headerlink" href="#3-directory-structure" title="Permanent link">&para;</a></h3>
<p>The directory can be viewed as a symbol table that translates file names into their file control blocks.</p>
<p>The directory can be <strong>single-level</strong>(单层), <strong>two-level</strong>(双层), and <strong>tree-structured</strong>(树状).</p>
<p><img alt="3_directory_structure" src="../figures/3_directory_structure.png" /></p>
<p>Within a file system, it is useful to create directories to allow files to be organized. </p>
<ul>
<li>A <strong>single-level directory</strong> in a multiuser system causes naming problems, since each file must have a unique name. </li>
<li>A <strong>two-level directory </strong>solves this problem by creating a separate directory for each user’s files. The directory lists the files by name and includes the file’s location on the disk, length, type, owner, time of creation, time of last use, and so on.</li>
<li>The natural generalization of a two-level directory is a <strong>tree-structured directory</strong>. A tree-structured directory allows a user to create subdirectories to organize files. </li>
<li><strong>Acyclic-graph directory</strong> structures enable users to share subdirectories and files but complicate searching and deletion.</li>
<li><strong>A general graph</strong> structure allows complete flexibility in the sharing of files and directories but sometimes requires garbage collection to recover unused disk space.</li>
</ul>
<h3 id="4-protection">4 Protection<a class="headerlink" href="#4-protection" title="Permanent link">&para;</a></h3>
<p>When information is stored in a computer system, we want to keep it safe from physical damage (the issue of <strong>reliability</strong>) and improper access (the issue of <strong>protection</strong>).</p>
<h4 id="types-of-access">Types of Access<a class="headerlink" href="#types-of-access" title="Permanent link">&para;</a></h4>
<p>Protection mechanisms provide <em><em>controlled access</em></em> by limiting the <em><em>types of file</em></em> access that can be made. Access is permitted or denied depending on several factors, one of which is the type of access requested. Several different types of operations may be controlled:</p>
<ul>
<li><strong>Read</strong>. Read from the file.</li>
<li><strong>Write</strong>. Write or rewrite the file.</li>
<li><strong>Execute</strong>. Load the file into memory and execute it.</li>
<li><strong>Append</strong>. Write new information at the end of the file.</li>
<li><strong>Delete</strong>. Delete the file and free its space for possible reuse.</li>
<li><strong>List</strong>. List the name and attributes of the file.</li>
<li><strong>Attribute change</strong>. Changing the attributes of the file.</li>
</ul>
<p>Many protection mechanism have been proposed and we have a more detailed description in <a href="../ch7/#the-readerswriters-problem">Chapter 17</a>.</p>
<h4 id="access-control">Access Control<a class="headerlink" href="#access-control" title="Permanent link">&para;</a></h4>
<p>The most common approach to the protection problem is to make access dependent on the identity of the user. </p>
<ul>
<li>Different users may need different types of access to a file or directory. </li>
</ul>
<p>The most general scheme to implement identity dependent access is to associate with each file and directory an <strong>access-control list</strong>(ACL, 访问控制列表) specifying user names and the types of access allowed for each user.</p>
<ul>
<li>If a user is listed for the requested access, the access is allowed.</li>
<li>Otherwise, a protection violation occurs, and the user job is denied access to the file.</li>
</ul>
<p>ISSUES: If we want to allow everyone to read a file, we must list all users with read accesses.</p>
<p>SOLUTION: A condensed version of the access list, many system recognize three classifications of users in connection with each file:</p>
<ul>
<li>Owner. The user who created the file is the owner.</li>
<li>Group. A set of users who are sharing the file and need similar access is a group, or work group</li>
<li>Other. All other users in the system.</li>
</ul>
<h4 id="other-protection-approaches">Other Protection Approaches<a class="headerlink" href="#other-protection-approaches" title="Permanent link">&para;</a></h4>
<p>Another approach to the protection problem, is to associate a password with each file.</p>
<h4 id="permissions-in-unix">Permissions in UNIX<a class="headerlink" href="#permissions-in-unix" title="Permanent link">&para;</a></h4>
<p>In the UNIX system, directory protection and file protection are handled similarly. Associated with each file and directory are three fields - owner, group, and universe -- each consisting of the three bits <strong>rwx</strong>, where <strong>r</strong> controls read access, <strong>w</strong> controls write access, and <strong>x</strong> controls execution.</p>
<p>A sample directory listing from a UNIX environment is shown in below:</p>
<p><img alt="permissions_in_a_unix_syste" src="../figures/permissions_in_a_unix_system.png" /></p>
<h3 id="5-memory-mapped-files">5 Memory-Mapped Files<a class="headerlink" href="#5-memory-mapped-files" title="Permanent link">&para;</a></h3>
<p><strong>Memory mapping</strong>(内存映射) a file is accomplished by mapping a disk block to a page in memory.</p>
<ul>
<li>Initial access to the file, results in a page fault.</li>
<li>A page-sized portion of the file is read from the file system into a physical page.</li>
<li>Subsequent reads and writes to the file are handled as routine memory accesses.</li>
</ul>
<p>Advantage</p>
<ul>
<li>Manipulating files through memory rather than incurring the overhead of using <code class="codehilite">read()</code> and <code class="codehilite">write()</code> system calls simplifies and speeds up file access and usuage.</li>
</ul>
<p>Multiple processes may be allowed to map the same file concurrently, to allow sharing of data. The virtual memory map of each sharing process points to the same page of physical memory. The memory-mapping system calls can also support <strong>copy-on-write</strong> functionality, allowing processes to share a file in read-only mode but to have their own copies of any data they modify.</p>
<p>Quite often, shared memory is in fact implemented by memory mapping files. Under this scenario, processes can communicate using shared memory by having the communicating processes memory-map the same file into their virtual address spaces(e.g. <a href="../ch3/#posix-shared-memory">POSIX shared memory</a>). </p>
<p><img alt="Shared_memory_using_memory-mapped_IO" src="../figures/Shared_memory_using_memory-mapped_IO.png" /></p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '../..';</script>
        <script src="../../js/base.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
        <script src="../../extra_javascript/tabhack.js"></script>
        <script src="../../search/require.js"></script>
        <script src="../../search/search.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td><kbd>&larr;</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td><kbd>&rarr;</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>


    </body>
</html>
