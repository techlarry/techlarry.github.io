<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Zhenhua Wang">
        <link rel="canonical" href="http://larryim.cc/note/hadoop/ch5/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Chapter 5: Hadoop I/O - Zhenhua's Notes</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../extra_css/custom.css" rel="stylesheet">
        <link href="../../extra_css/custom.js" rel="stylesheet">
        <link href="../../extra_css/friendly.css" rel="stylesheet">
        <link href="../../extra_css/theme.css" rel="stylesheet">
        <link href="../../extra_css/mkdocs/js/lunr-0.5.7.min.js" rel="stylesheet">
        <link href="../../extra_css/mkdocs/js/mustache.min.js" rel="stylesheet">
        <link href="../../extra_css/mkdocs/js/require.js" rel="stylesheet">
        <link href="../../extra_css/mkdocs/js/search.js" rel="stylesheet">
        <link href="../../extra_css/mkdocs/js/text.js" rel="stylesheet">
        <link href="../../extra_css/code-tab.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../..">Zhenhua's Notes</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="../..">Home</a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">OSC <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../osc/">Contents</a>
</li>
                            
<li >
    <a href="../../osc/ch1/">Chapter 1: Introduction </a>
</li>
                            
<li >
    <a href="../../osc/ch2/">Chapter 2: Operating System structures</a>
</li>
                            
<li >
    <a href="../../osc/ch3/">Chapter 3: Processes</a>
</li>
                            
<li >
    <a href="../../osc/ch4/">Chapter 4: Threads and Concurrency</a>
</li>
                            
<li >
    <a href="../../osc/ch5/">Chapter 5: CPU Scheduling</a>
</li>
                            
<li >
    <a href="../../osc/ch6/">Chapter 6: Synchronization Tools</a>
</li>
                            
<li >
    <a href="../../osc/ch7/">Chapter 7: Synchronization Examples</a>
</li>
                            
<li >
    <a href="../../osc/ch8/">Chapter 8: Deadlocks</a>
</li>
                            
<li >
    <a href="../../osc/ch9/">Chapter 9: Main Memory</a>
</li>
                            
<li >
    <a href="../../osc/ch10/">Chapter 10: Virtual Memory</a>
</li>
                            
<li >
    <a href="../../osc/ch11/">Chapter 11: Mass-Storage Structure</a>
</li>
                            
<li >
    <a href="../../osc/ch13/">Chapter 13: File-System Interfaces</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">CSAPP <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../csapp/">Contents</a>
</li>
                            
<li >
    <a href="../../csapp/ch1/">Chapter 1: 计算机系统漫游</a>
</li>
                            
<li >
    <a href="../../csapp/ch2/">Chapter 2: 信息的表示和处理</a>
</li>
                            
<li >
    <a href="../../csapp/ch3/">Chapter 3: 程序的机器级表示</a>
</li>
                            
<li >
    <a href="../../csapp/ch4/">Chapter 4: 处理器体系结构</a>
</li>
                            
<li >
    <a href="../../csapp/ch5/">Chapter 5: 优化程序性能</a>
</li>
                            
<li >
    <a href="../../csapp/ch6/">Chapter 6: 存储器层次结构</a>
</li>
                            
<li >
    <a href="../../csapp/ch7/">Chapter 7: 链接</a>
</li>
                            
<li >
    <a href="../../csapp/ch8/">Chapter 8: 异常控制流</a>
</li>
                            
<li >
    <a href="../../csapp/ch9/">Chapter 9: 虚拟内存</a>
</li>
                            
<li >
    <a href="../../csapp/ch10/">Chapter 10: 系统级I/O</a>
</li>
                            
<li >
    <a href="../../csapp/ch11/">Chapter 11: 网络编程</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">HFJ <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../hfj/">Contents</a>
</li>
                            
<li >
    <a href="../../hfj/ch1/">Chapter 1: Dive in A Quick Dip</a>
</li>
                            
<li >
    <a href="../../hfj/ch2/">Chapter 2: Classes and Objects</a>
</li>
                            
<li >
    <a href="../../hfj/ch3/">Chapter 3: Primitives and References</a>
</li>
                            
<li >
    <a href="../../hfj/ch4/">Chapter 4: Methods use Instance Variables</a>
</li>
                            
<li >
    <a href="../../hfj/ch5/">Chapter 5: Writing a Program</a>
</li>
                            
<li >
    <a href="../../hfj/ch6/">Chapter 6: Get to Know the Java API</a>
</li>
                            
<li >
    <a href="../../hfj/ch7/">Chapter 7: Inheritance and Polymorphism</a>
</li>
                            
<li >
    <a href="../../hfj/ch8/">Chapter 8: Interfaces and Abstract Classes</a>
</li>
                            
<li >
    <a href="../../hfj/ch9/">Chapter 9: Constructors and Garbage Collection</a>
</li>
                            
<li >
    <a href="../../hfj/ch10/">Chapter 10: Numbers and Statics</a>
</li>
                            
<li >
    <a href="../../hfj/ch11/">Chapter 11: Exception Handling</a>
</li>
                            
<li >
    <a href="../../hfj/ch12/">Chapter 12: Getting GUI</a>
</li>
                            
<li >
    <a href="../../hfj/ch13/">Chapter 13: Using Swing</a>
</li>
                            
<li >
    <a href="../../hfj/ch14/">Chapter 14: Serialization and File I/O</a>
</li>
                            
<li >
    <a href="../../hfj/ch15/">Chapter 15: Networking and Threads</a>
</li>
                            
<li >
    <a href="../../hfj/ch16/">Chapter 16: Collections and Generics</a>
</li>
                            
<li >
    <a href="../../hfj/ch17/">Chapter 17: Packages, Jars and Deployment</a>
</li>
                            
<li >
    <a href="../../hfj/ch18/">Chapter 18: Remote deploy with RMI</a>
</li>
                            
<li >
    <a href="../../hfj/Appendix/">Appendix: The Top Ten Topics</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">HFDP <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../hfdp/">Contents</a>
</li>
                            
<li >
    <a href="../../hfdp/ch1/">Chapter 1: Strategy Pattern </a>
</li>
                            
<li >
    <a href="../../hfdp/ch2/">Chapter 2: Observer Pattern</a>
</li>
                            
<li >
    <a href="../../hfdp/ch3/">Chapter 3: Decorator Pattern </a>
</li>
                            
<li >
    <a href="../../hfdp/ch4/">Chapter 4: Factory Pattern</a>
</li>
                            
<li >
    <a href="../../hfdp/ch5/">Chapter 5: Singleton Pattern</a>
</li>
                            
<li >
    <a href="../../hfdp/ch6/">Chapter 6: Command Pattern</a>
</li>
                            
<li >
    <a href="../../hfdp/ch7/">Chapter 7: Adapter and Facade Patterns</a>
</li>
                            
<li >
    <a href="../../hfdp/ch8/">Chapter 8: Template Method Pattern</a>
</li>
                            
<li >
    <a href="../../hfdp/ch9/">Chapter 9: Iterator and Composite Patterns</a>
</li>
                            
<li >
    <a href="../../hfdp/ch10/">Chapter 10: State Pattern</a>
</li>
                            
<li >
    <a href="../../hfdp/ch11/">Chapter 11: Proxy Pattern</a>
</li>
                            
<li >
    <a href="../../hfdp/ch12/">Chapter 12: Compound Pattern</a>
</li>
                            
<li >
    <a href="../../hfdp/ch13/">Chapter 13: Better Living with Patterns</a>
</li>
                            
<li >
    <a href="../../hfdp/Appendix/">Appendix: Design Pattern in Java Library</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">TIJ <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../tij/">Contents</a>
</li>
                            
<li >
    <a href="../../tij/ch1/">Chapter 1: Introduction</a>
</li>
                            
<li >
    <a href="../../tij/ch2/">Chapter 2: Introduction to Objects</a>
</li>
                            
<li >
    <a href="../../tij/ch3/">Chapter 3: Everything is an Object</a>
</li>
                            
<li >
    <a href="../../tij/ch4/">Chapter 4: Opertors</a>
</li>
                            
<li >
    <a href="../../tij/ch5/">Chapter 5: Controlling Execution</a>
</li>
                            
<li >
    <a href="../../tij/ch6/">Chapter 6: Initialization & Cleanup</a>
</li>
                            
<li >
    <a href="../../tij/ch7/">Chapter 7: Access Control</a>
</li>
                            
<li >
    <a href="../../tij/ch8/">Chapter 8: Reusing Clases</a>
</li>
                            
<li >
    <a href="../../tij/ch9/">Chapter 9: Polymorphism</a>
</li>
                            
<li >
    <a href="../../tij/ch10/">Chapter 10: Interfaces</a>
</li>
                            
<li >
    <a href="../../tij/ch11/">Chapter 11: Inner Classes</a>
</li>
                            
<li >
    <a href="../../tij/ch12/">Chapter 12: Holding Your Objects</a>
</li>
                            
<li >
    <a href="../../tij/ch13/">Chapter 13: Error Handling with Exceptions</a>
</li>
                            
<li >
    <a href="../../tij/ch14/">Chapter 14: Strings</a>
</li>
                            
<li >
    <a href="../../tij/ch15/">Chapter 15: Type Information</a>
</li>
                            
<li >
    <a href="../../tij/ch16/">Chapter 16: Generics</a>
</li>
                            
<li >
    <a href="../../tij/ch17/">Chapter 17: Arrays</a>
</li>
                            
<li >
    <a href="../../tij/ch18/">Chapter 18: Containers in Depth</a>
</li>
                            
<li >
    <a href="../../tij/ch19/">Chapter 19: I/O</a>
</li>
                            
<li >
    <a href="../../tij/ch20/">Chapter 20: Enumerated Types</a>
</li>
                            
<li >
    <a href="../../tij/ch21/">Chapter 21: Annotations</a>
</li>
                            
<li >
    <a href="../../tij/ch22/">Chapter 22: Concurrency</a>
</li>
                            
<li >
    <a href="../../tij/ch23/">Chapter 23: Graphical User Interfaces</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">CPJ <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../cpj/">Contents</a>
</li>
                            
<li >
    <a href="../../cpj/ch1/">Concurrent Programming in Java 1: Threads and Locks</a>
</li>
                            
<li >
    <a href="../../cpj/ch2/">Concurrent Programming in Java 2: Critical Sections and Isolation</a>
</li>
                            
<li >
    <a href="../../cpj/ch3/">Concurrent Programming in Java 3: Actors</a>
</li>
                            
<li >
    <a href="../../cpj/ch4/">Concurrent Programming in Java 4: Concurrent Data Structures</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">HADOOP <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../">Contents</a>
</li>
                            
<li >
    <a href="../ch1/">Chapter 1: Meet Hadoop</a>
</li>
                            
<li >
    <a href="../ch2/">Chapter 2: MapReduce</a>
</li>
                            
<li >
    <a href="../ch3/">Chapter 3: The Hadoop Distributed FileSystem</a>
</li>
                            
<li >
    <a href="../ch4/">Chapter 4: YARN</a>
</li>
                            
<li class="active">
    <a href="./">Chapter 5: Hadoop I/O</a>
</li>
                            
<li >
    <a href="../ch6/">Chapter 6: Developing a MapReduce Application</a>
</li>
                            
<li >
    <a href="../ch7/">Chapter 7: How MapReduce Works</a>
</li>
                            
<li >
    <a href="../ch8/">Chapter 8: MapReduce Types and Formats</a>
</li>
                            
<li >
    <a href="../ch9/">Chapter 9: MapReduce Features</a>
</li>
                            
<li >
    <a href="../ch10/">Chapter 10: Setting Up a Hadoop Cluster</a>
</li>
                            
<li >
    <a href="../ch11/">Chapter 11: Adminstering Hadoop</a>
</li>
                            
<li >
    <a href="../ch12/">Chapter 12: Avro</a>
</li>
                            
<li >
    <a href="../ch13/">Chapter 13: Parquet</a>
</li>
                            
<li >
    <a href="../ch14/">Chapter 14: Flume</a>
</li>
                            
<li >
    <a href="../ch15/">Chapter 15: Sqoop</a>
</li>
                            
<li >
    <a href="../ch16/">Chapter 16: Pig</a>
</li>
                            
<li >
    <a href="../ch17/">Chapter 17: Hive</a>
</li>
                            
<li >
    <a href="../ch18/">Chapter 18: Crunch</a>
</li>
                            
<li >
    <a href="../ch19/">Chapter 19: Spark</a>
</li>
                            
<li >
    <a href="../ch20/">Chapter 20: HBase</a>
</li>
                            
<li >
    <a href="../ch21/">Chapter 21: ZooKeeper</a>
</li>
                            
<li >
    <a href="../ch22/">Chapter 22: Composable Data at Center</a>
</li>
                            
<li >
    <a href="../ch23/">Chapter 23: Biological Data Science: Saving Lives with Software</a>
</li>
                            
<li >
    <a href="../ch24/">Chapter 24: Cascading</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">UJVM <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../ujvm/">Contents</a>
</li>
                            
<li >
    <a href="../../ujvm/ch1/">Chapter 1 : 走进Java</a>
</li>
                            
<li >
    <a href="../../ujvm/ch2/">Chapter 2 : Java内存区域与内存溢出正常</a>
</li>
                            
<li >
    <a href="../../ujvm/ch3/">Chapter 3 : 垃圾收集器与内存分配策略</a>
</li>
                            
<li >
    <a href="../../ujvm/ch4/">Chapter 4 : 虚拟机性能监控与故障处理工具</a>
</li>
                            
<li >
    <a href="../../ujvm/ch5/">Chapter 5 : 调优案例分析与实战</a>
</li>
                            
<li >
    <a href="../../ujvm/ch6/">Chapter 6 : 类文件结构</a>
</li>
                            
<li >
    <a href="../../ujvm/ch7/">Chapter 7 : 虚拟机类加载机制</a>
</li>
                            
<li >
    <a href="../../ujvm/ch8/">Chapter 8 : 虚拟机字节码执行引擎</a>
</li>
                            
<li >
    <a href="../../ujvm/ch9/">Chapter 9 : 类加载及执行子系统的案例与实战</a>
</li>
                            
<li >
    <a href="../../ujvm/ch10/">Chapter 10 : 早期(编译期)优化</a>
</li>
                            
<li >
    <a href="../../ujvm/ch11/">Chapter 11 : 晚期(运行期)优化</a>
</li>
                            
<li >
    <a href="../../ujvm/ch12/">Chapter 12 : Java内存模型与线程</a>
</li>
                            
<li >
    <a href="../../ujvm/ch13/">Chapter 13 : 线程安全与锁优化</a>
</li>
                            
<li >
    <a href="../../ujvm/AppendixC/">Appendix HotSpot虚拟机主要参数列表</a>
</li>
                        </ul>
                    </li>
                    <li >
                        <a href="../../books/">Books</a>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="../ch4/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../ch6/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#hadoop-the-definitive-guide-5-hadoop-io">Hadoop: The Definitive Guide 5 - Hadoop I/O</a></li>
        <li class="main "><a href="#1-data-integrity">1 Data Integrity</a></li>
            <li><a href="#data-integrity-in-hdfs">Data Integrity in HDFS</a></li>
            <li><a href="#localfilesystem">LocalFileSystem</a></li>
            <li><a href="#checksumfilesystem">ChecksumFileSystem</a></li>
        <li class="main "><a href="#2-compression">2 Compression</a></li>
            <li><a href="#codecs">Codecs</a></li>
            <li><a href="#compression-and-input-splits">Compression and Input Splits</a></li>
            <li><a href="#using-compression-in-mapreduce">Using Compression in MapReduce</a></li>
        <li class="main "><a href="#3-serialization">3 Serialization</a></li>
            <li><a href="#the-writable-interface">The Writable Interface</a></li>
            <li><a href="#writable-classes">Writable Classes</a></li>
            <li><a href="#implementing-a-custom-writable">Implementing a Custom Writable</a></li>
            <li><a href="#serialization-frameworks">Serialization Frameworks</a></li>
        <li class="main "><a href="#4-file-based-data-structures">4 File-Based Data Structures</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h3 id="hadoop-the-definitive-guide-5-hadoop-io"><strong>Hadoop: The Definitive Guide 5 - Hadoop I/O</strong><a class="headerlink" href="#hadoop-the-definitive-guide-5-hadoop-io" title="Permanent link">&para;</a></h3>
<h3 id="1-data-integrity">1 Data Integrity<a class="headerlink" href="#1-data-integrity" title="Permanent link">&para;</a></h3>
<p>The usual way of detecting corrupted data is by computing a <em>checksum</em>(校验和) for the data when it first enters the system, and again whenever it is transmitted across a channel that is unreliable and hence capable of corrupting the data.</p>
<p>A commonly used error-detecting code is CRC-32 (32-bit cyclic redundancy check), which computes a 32-bit integer checksum for input of any size. CRC32 is used for checksumming in Hadoop's <C>checksumFileSystem</C>, while HDFS uses a more efficient variant called CRC-32C.</p>
<h4 id="data-integrity-in-hdfs">Data Integrity in HDFS<a class="headerlink" href="#data-integrity-in-hdfs" title="Permanent link">&para;</a></h4>
<p>HDFS transparently checksums all data written to it and by default verifies checksums when reading data. A separate checksum is created for every <C>ChecksumFileSystem.bytesPerChecksum</C>(default 512) bytes of data.</p>
<p>Datanodes are responsible for verifying the data they receive before storing the data and its checksum. When clients read data from datanodes, they verify checksums as well.</p>
<p>In addition to block verification on client reads, each datanode runs a <C>DataBlockScanner</C> in a background thread that <em>periodically</em> verifies all the blocks stored on the datanode.</p>
<p>You can find a file’s checksum with <C>hadoop fs -checksum</C>.</p>
<h4 id="localfilesystem">LocalFileSystem<a class="headerlink" href="#localfilesystem" title="Permanent link">&para;</a></h4>
<p>The Hadoop <C>LocalFileSystem</C> performs client-side checksumming. It is possible to disable checksums, by using <C>RawLocalFileSystem</C> in place of <C>LocalFileSystem</C>.</p>
<h4 id="checksumfilesystem">ChecksumFileSystem<a class="headerlink" href="#checksumfilesystem" title="Permanent link">&para;</a></h4>
<p><C>LocalFileSystem</C> extends <C>ChecksumFileSystem</C>, and <C>ChecksumFileSystem</C> is also a wrapper around <C>FileSystem</C> (uses <a href="../../hfdp/ch3/">decorator pattern</a> here). The general idiom is as follows:</p>
<p> <div class=codehilite><pre><span class=n>FileSystem</span> <span class=n>rawFs</span> <span class=o>=</span> <span class=o>...</span>
<span class=n>FileSystem</span> <span class=n>checksummedFs</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ChecksumFileSystem</span><span class=o>(</span><span class=n>rawFs</span><span class=o>);</span>
</pre></div></p>
<p><img alt="LocalFileSystemUML" src="../figures/LocalFileSystemUML.png" /></p>
<h3 id="2-compression">2 Compression<a class="headerlink" href="#2-compression" title="Permanent link">&para;</a></h3>
<p>File compression brings two major benefits: it <strong>reduces the space</strong> needed to store files, and it <strong>speeds up data transfer</strong> across the network or to or from disk. When dealing with large volumes of data, both of these savings can be significant.</p>
<p>A summary of compression formats:</p>
<table>
<thead>
<tr>
<th>Compression format</th>
<th>Tools</th>
<th>Algorithm</th>
<th>File Extension</th>
<th>CompressionCodec</th>
<th>Splittable?</th>
</tr>
</thead>
<tbody>
<tr>
<td>DEFLATE</td>
<td>N/A</td>
<td>DEFLATE</td>
<td>.deflate</td>
<td>DefaultCodec</td>
<td>No</td>
</tr>
<tr>
<td>gzip</td>
<td>gzip</td>
<td>DEFLATE</td>
<td>.gz</td>
<td>GzipCodec</td>
<td>No</td>
</tr>
<tr>
<td>bzip2</td>
<td>bzip2</td>
<td>bzip2</td>
<td>.bz2</td>
<td>BZip2Codec</td>
<td>Yes</td>
</tr>
<tr>
<td>LZO</td>
<td>lzop</td>
<td>LZO</td>
<td>.lzo</td>
<td>LzoCodec</td>
<td>No</td>
</tr>
<tr>
<td>Snappy</td>
<td>N/A</td>
<td>Snappy</td>
<td>.snappy</td>
<td>SnappyCodec</td>
<td>No</td>
</tr>
</tbody>
</table>
<p>All compression algorithm exhibit a space/time trade-off. Splittable compression formats are especially suitable for MapReduce.</p>
<h4 id="codecs">Codecs<a class="headerlink" href="#codecs" title="Permanent link">&para;</a></h4>
<p>A <em>codec</em> is the implementation of a compression-decompression algorithm. In Hadoop, a codec is represented by an implementation of the <C>CompressionCodec</C> interface. So, for example, <C>GzipCodec</C> encapsulates the compression and decompression algorithm for gzip.</p>
<p><hh>Compressing and decompressing streams with CompressionCodec</hh></p>
<p><C>Interface CompressionCodec <C> has two methods that allow you to easily compress or decompress data. </p>
<ul>
<li>To compress data being written to an output stream, use the <C>createOutputStream(OutputStream out)</C> method to create a <C>CompressionOutputStream</C></li>
<li>Conversely, to decompress data being read from an input stream, call <C>createInputStream(InputStream in)</C> to obtain a <C>CompressionInputStream</C>.</li>
</ul>
<p>The code below illustrates how to use the API to compress data read from standard input and write it to standard output.</p>
<p> <div class=codehilite><pre><span class=kn>import</span> <span class=nn>org.apache.hadoop.conf.Configuration</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.apache.hadoop.io.IOUtils</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.apache.hadoop.io.compress.CompressionCodec</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.apache.hadoop.io.compress.CompressionOutputStream</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>org.apache.hadoop.util.ReflectionUtils</span><span class=o>;</span>

<span class=c1>// vv StreamCompressor</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>StreamCompressor</span> <span class=o>{</span>

    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
        <span class=n>String</span> <span class=n>codecClassname</span> <span class=o>=</span> <span class=n>args</span><span class=o>[</span><span class=mi>0</span><span class=o>];</span>
        <span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>codecClass</span> <span class=o>=</span> <span class=n>Class</span><span class=o>.</span><span class=na>forName</span><span class=o>(</span><span class=n>codecClassname</span><span class=o>);</span>
        <span class=n>Configuration</span> <span class=n>conf</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Configuration</span><span class=o>();</span>
        <span class=n>CompressionCodec</span> <span class=n>codec</span> <span class=o>=</span> <span class=o>(</span><span class=n>CompressionCodec</span><span class=o>)</span>
                <span class=n>ReflectionUtils</span><span class=o>.</span><span class=na>newInstance</span><span class=o>(</span><span class=n>codecClass</span><span class=o>,</span> <span class=n>conf</span><span class=o>);</span>

        <span class=n>CompressionOutputStream</span> <span class=n>out</span> <span class=o>=</span> <span class=n>codec</span><span class=o>.</span><span class=na>createOutputStream</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>);</span>
        <span class=n>IOUtils</span><span class=o>.</span><span class=na>copyBytes</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>in</span><span class=o>,</span> <span class=n>out</span><span class=o>,</span> <span class=mi>4096</span><span class=o>,</span> <span class=kc>false</span><span class=o>);</span>
        <span class=n>out</span><span class=o>.</span><span class=na>finish</span><span class=o>();</span>
    <span class=o>}</span>
<span class=o>}</span>
</pre></div></p>
<p>We can try it out with the following command line, which compresses the string “Text” using the <C>StreamCompressor</C> program with the <C>GzipCodec</C>, then decompresses it from standard input using <C>gunzip</C>:</p>
<p> <div class=codehilite><pre><span class=nb>export</span> <span class=nv>HADOOP_CLASSPATH</span><span class=o>=</span>/Users/larry/JavaProject/out/artifacts/StreamCompressor/StreamCompressor.jar
<span class=nb>echo</span> <span class=s2>&quot;Text&quot;</span> <span class=p>|</span> hadoop com.definitivehadoop.compression.StreamCompressor org.apache.hadoop.io.compress.GzipCodec <span class=p>|</span> gunzip 
</pre></div></p>
<p><hh>Inferring CompressionCodecs using CompressionCodecFactory</hh></p>
<p><C>CompressionCodecFactory</C> provides a way of mapping a filename extension to a <C>CompressionCodec</C> using its <C>getCodec()</C> method,</p>
<p><C>CodecPool</C></p>
<p>If you are using a native library and you are doing a lot of compression or decompression in your application, consider using <C>CodecPool</C>, which allows you to reuse compressors and decompressors, thereby amortizing the cost of creating these objects.</p>
<h4 id="compression-and-input-splits">Compression and Input Splits<a class="headerlink" href="#compression-and-input-splits" title="Permanent link">&para;</a></h4>
<p>If a compressed file using a format that does not support splitting, say gzip format, MapReduce will not try to split the gzipped file, at the expense of locality: a single map will process all blocks containing the file, most of which will not be local to the map.</p>
<p>For an LZO file, in spite of not supporting splitting, it is possible to preprocess LZO files using an indexer tool that comes with the Hadoop LZO libraries. </p>
<h4 id="using-compression-in-mapreduce">Using Compression in MapReduce<a class="headerlink" href="#using-compression-in-mapreduce" title="Permanent link">&para;</a></h4>
<p>In order to compress the output of a MapReduce, job you can use the static convenience methods on <C>FileOutputFormat</C> to set properties.</p>
<p>Application to run the maximum temperature job producing compressed output:</p>
<div class=md-fenced-code-tabs id=tab-tab-group-3><input name=tab-group-3 type=radio id=tab-group-3-0_Java checked=checked class=code-tab data-lang=Java aria-controls=tab-group-3-0_Java-panel role=tab><label for=tab-group-3-0_Java class=code-tab-label data-lang=Java id=tab-group-3-0_Java-label>Maxtemperaturewithcompression</label><div class=code-tabpanel role=tabpanel data-lang=Java id=tab-group-3-0_Java-panel aria-labelledby=tab-group-3-0_Java-label><div class=codehilite><pre><span class=kd>public</span> <span class=kd>class</span> <span class=nc>MaxTemperatureWithCompression</span> <span class=o>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
        <span class=k>if</span> <span class=o>(</span><span class=n>args</span><span class=o>.</span><span class=na>length</span> <span class=o>!=</span> <span class=mi>2</span><span class=o>)</span> <span class=o>{</span>
            <span class=n>System</span><span class=o>.</span><span class=na>err</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&quot;Usage: MaxTemperatureWithCompression &lt;input path&gt; &quot;</span> <span class=o>+</span>
                    <span class=s>&quot;&lt;output path&gt;&quot;</span><span class=o>);</span>
            <span class=n>System</span><span class=o>.</span><span class=na>exit</span><span class=o>(-</span><span class=mi>1</span><span class=o>);</span>
        <span class=o>}</span>

        <span class=n>Job</span> <span class=n>job</span> <span class=o>=</span>  <span class=n>Job</span><span class=o>.</span><span class=na>getInstance</span><span class=o>();</span>
        <span class=n>job</span><span class=o>.</span><span class=na>setJarByClass</span><span class=o>(</span><span class=n>com</span><span class=o>.</span><span class=na>definitivehadoop</span><span class=o>.</span><span class=na>weatherdata</span><span class=o>.</span><span class=na>MaxTemperature</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>

        <span class=n>FileInputFormat</span><span class=o>.</span><span class=na>addInputPath</span><span class=o>(</span><span class=n>job</span><span class=o>,</span> <span class=k>new</span> <span class=n>Path</span><span class=o>(</span><span class=n>args</span><span class=o>[</span><span class=mi>0</span><span class=o>]));</span>
        <span class=n>FileOutputFormat</span><span class=o>.</span><span class=na>setOutputPath</span><span class=o>(</span><span class=n>job</span><span class=o>,</span> <span class=k>new</span> <span class=n>Path</span><span class=o>(</span><span class=n>args</span><span class=o>[</span><span class=mi>1</span><span class=o>]));</span>

        <span class=n>job</span><span class=o>.</span><span class=na>setOutputKeyClass</span><span class=o>(</span><span class=n>Text</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
        <span class=n>job</span><span class=o>.</span><span class=na>setOutputValueClass</span><span class=o>(</span><span class=n>IntWritable</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>

        <span class=cm>/*[*/</span>
        <span class=n>FileOutputFormat</span><span class=o>.</span><span class=na>setCompressOutput</span><span class=o>(</span><span class=n>job</span><span class=o>,</span> <span class=kc>true</span><span class=o>);</span>
        <span class=n>FileOutputFormat</span><span class=o>.</span><span class=na>setOutputCompressorClass</span><span class=o>(</span><span class=n>job</span><span class=o>,</span> <span class=n>GzipCodec</span><span class=o>.</span><span class=na>class</span><span class=o>);</span><span class=cm>/*]*/</span>

<span class=n>job</span><span class=o>.</span><span class=na>setMapperClass</span><span class=o>(</span><span class=n>com</span><span class=o>.</span><span class=na>definitivehadoop</span><span class=o>.</span><span class=na>weatherdata</span><span class=o>.</span><span class=na>MaxTemperatureMapper</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
<span class=n>job</span><span class=o>.</span><span class=na>setCombinerClass</span><span class=o>(</span><span class=n>com</span><span class=o>.</span><span class=na>definitivehadoop</span><span class=o>.</span><span class=na>weatherdata</span><span class=o>.</span><span class=na>MaxTemperatureReducer</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
<span class=n>job</span><span class=o>.</span><span class=na>setReducerClass</span><span class=o>(</span><span class=n>com</span><span class=o>.</span><span class=na>definitivehadoop</span><span class=o>.</span><span class=na>weatherdata</span><span class=o>.</span><span class=na>MaxTemperatureReducer</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>

        <span class=n>System</span><span class=o>.</span><span class=na>exit</span><span class=o>(</span><span class=n>job</span><span class=o>.</span><span class=na>waitForCompletion</span><span class=o>(</span><span class=kc>true</span><span class=o>)</span> <span class=o>?</span> <span class=mi>0</span> <span class=o>:</span> <span class=mi>1</span><span class=o>);</span>
    <span class=o>}</span>
<span class=o>}</span>
<span class=c1>//^^ MaxTemperatureWithCompression</span>
</pre></div></div><input name=tab-group-3 type=radio id=tab-group-3-1_bash class=code-tab data-lang=bash aria-controls=tab-group-3-1_bash-panel role=tab><label for=tab-group-3-1_bash class=code-tab-label data-lang=bash id=tab-group-3-1_bash-label>Usage</label><div class=code-tabpanel role=tabpanel data-lang=bash id=tab-group-3-1_bash-panel aria-labelledby=tab-group-3-1_bash-label><div class=codehilite><pre>$ <span class=nb>export</span> <span class=nv>HADOOP_CLASSPATH</span><span class=o>=</span>/Users/larry/JavaProject/out/artifacts/MaxTemperatureWithCompression/MaxTemperatureWithCompression.jar
$ hadoop com.definitivehadoop.compression.MaxTemperatureWithCompression /Users/larry/JavaProject/resources/HadoopBook/ncdc/sample.txt output
</pre></div></div></div>

<h3 id="3-serialization">3 Serialization<a class="headerlink" href="#3-serialization" title="Permanent link">&para;</a></h3>
<p>See concepts of serialization and deserialization in Head First Java <a href="../../hfj/ch14/">Chapter 14</a>.</p>
<p>Serialization is used in two quite distinct areas of distributed data processing: for interprocess communication and for persistent storage.</p>
<p>In Hadoop, interprocess communication between nodes in the system is implemented using remote procedure calls (RPCs). The RPC protocol uses serialization to render the message into a binary stream to be sent to the remote node, which then deserializes the binary stream into the original message. In general, four desirable properties are crucial for  an RPC serialization and persistent storage:</p>
<table>
<thead>
<tr>
<th>Properties</th>
<th>PRC Serialization</th>
<th>Persistent Storage</th>
</tr>
</thead>
<tbody>
<tr>
<td>Compact</td>
<td>makes the best use of network bandwidth</td>
<td>make efficient use of storage space</td>
</tr>
<tr>
<td>Fast</td>
<td>little performance overhead</td>
<td>little overhead in reading or writing</td>
</tr>
<tr>
<td>Extensible</td>
<td>meet new requirements</td>
<td>transparently read data of older formats</td>
</tr>
<tr>
<td>Interoperable</td>
<td>support clients written in different languages</td>
<td>read/write using different languages</td>
</tr>
</tbody>
</table>
<p>Hadoop uses its own serialization format, <C>Writables</C>, which is certainly compact and fast, but not so easy to extend or use from languages other than Java. Avro, a serialization system that was designed to overcome some of the limitations of <C>Writables</C>, is covered in <a href="../ch12/">Chapter 12</a>.</p>
<h4 id="the-writable-interface">The Writable Interface<a class="headerlink" href="#the-writable-interface" title="Permanent link">&para;</a></h4>
<h4 id="writable-classes">Writable Classes<a class="headerlink" href="#writable-classes" title="Permanent link">&para;</a></h4>
<p><img alt="" src="../figures/WritableClassHierarchy.jpg" /></p>
<h4 id="implementing-a-custom-writable">Implementing a Custom Writable<a class="headerlink" href="#implementing-a-custom-writable" title="Permanent link">&para;</a></h4>
<h4 id="serialization-frameworks">Serialization Frameworks<a class="headerlink" href="#serialization-frameworks" title="Permanent link">&para;</a></h4>
<h3 id="4-file-based-data-structures">4 File-Based Data Structures<a class="headerlink" href="#4-file-based-data-structures" title="Permanent link">&para;</a></h3></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '../..';</script>
        <script src="../../js/base.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
        <script src="../../extra_javascript/tabhack.js"></script>
        <script src="../../search/require.js"></script>
        <script src="../../search/search.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td><kbd>&larr;</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td><kbd>&rarr;</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>


    </body>
</html>
